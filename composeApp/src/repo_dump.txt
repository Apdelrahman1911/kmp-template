ğŸ“ Repository Structure
â”œâ”€â”€ androidMain
â”‚   â”œâ”€â”€ kotlin
â”‚   â”‚   â””â”€â”€ me
â”‚   â”‚       â””â”€â”€ onvo
â”‚   â”‚           â””â”€â”€ onvo
â”‚   â”‚               â”œâ”€â”€ core
â”‚   â”‚               â”‚   â”œâ”€â”€ datastore
â”‚   â”‚               â”‚   â”‚   â””â”€â”€ DataStoreFactory.android.kt
â”‚   â”‚               â”‚   â”œâ”€â”€ device
â”‚   â”‚               â”‚   â”‚   â””â”€â”€ DeviceInfoProvider.android.kt
â”‚   â”‚               â”‚   â”œâ”€â”€ network
â”‚   â”‚               â”‚   â”‚   â””â”€â”€ HttpClientFactory.android.kt
â”‚   â”‚               â”‚   â””â”€â”€ util
â”‚   â”‚               â”‚       â””â”€â”€ CryptoUtil.android.kt
â”‚   â”‚               â”œâ”€â”€ di
â”‚   â”‚               â”‚   â”œâ”€â”€ initKoinAndroid.kt
â”‚   â”‚               â”‚   â””â”€â”€ platformModule.android.kt
â”‚   â”‚               â”œâ”€â”€ theme
â”‚   â”‚               â”‚   â””â”€â”€ splash_screen
â”‚   â”‚               â”‚       â””â”€â”€ shouldShowSplash.android.kt
â”‚   â”‚               â”œâ”€â”€ MainActivity.kt
â”‚   â”‚               â”œâ”€â”€ OnvoApp.kt
â”‚   â”‚               â””â”€â”€ Platform.android.kt
â”‚   â”œâ”€â”€ res
â”‚   â”‚   â”œâ”€â”€ drawable
â”‚   â”‚   â”‚   â””â”€â”€ ic_launcher_background.xml
â”‚   â”‚   â”œâ”€â”€ drawable-v24
â”‚   â”‚   â”‚   â””â”€â”€ ic_launcher_foreground.xml
â”‚   â”‚   â”œâ”€â”€ mipmap-anydpi-v26
â”‚   â”‚   â”‚   â”œâ”€â”€ ic_launcher.xml
â”‚   â”‚   â”‚   â””â”€â”€ ic_launcher_round.xml
â”‚   â”‚   â”œâ”€â”€ mipmap-hdpi
â”‚   â”‚   â”œâ”€â”€ mipmap-mdpi
â”‚   â”‚   â”œâ”€â”€ mipmap-xhdpi
â”‚   â”‚   â”œâ”€â”€ mipmap-xxhdpi
â”‚   â”‚   â”œâ”€â”€ mipmap-xxxhdpi
â”‚   â”‚   â””â”€â”€ values
â”‚   â”‚       â”œâ”€â”€ colors.xml
â”‚   â”‚       â”œâ”€â”€ strings.xml
â”‚   â”‚       â””â”€â”€ themes.xml
â”‚   â””â”€â”€ AndroidManifest.xml
â”œâ”€â”€ appleMain
â”‚   â””â”€â”€ kotlin
â”‚       â””â”€â”€ me
â”‚           â””â”€â”€ onvo
â”‚               â””â”€â”€ onvo
â”‚                   â”œâ”€â”€ core
â”‚                   â”‚   â””â”€â”€ network
â”‚                   â””â”€â”€ theme
â”‚                       â””â”€â”€ splash_screen
â”œâ”€â”€ commonMain
â”‚   â”œâ”€â”€ composeResources
â”‚   â”‚   â””â”€â”€ drawable
â”‚   â”‚       â””â”€â”€ compose-multiplatform.xml
â”‚   â””â”€â”€ kotlin
â”‚       â””â”€â”€ me
â”‚           â””â”€â”€ onvo
â”‚               â””â”€â”€ onvo
â”‚                   â”œâ”€â”€ core
â”‚                   â”‚   â”œâ”€â”€ config
â”‚                   â”‚   â”‚   â””â”€â”€ AppConfig.kt
â”‚                   â”‚   â”œâ”€â”€ datastore
â”‚                   â”‚   â”‚   â”œâ”€â”€ DataStoreFactory.kt
â”‚                   â”‚   â”‚   â””â”€â”€ PreferencesManager.kt
â”‚                   â”‚   â”œâ”€â”€ device
â”‚                   â”‚   â”‚   â””â”€â”€ DeviceInfoProvider.kt
â”‚                   â”‚   â”œâ”€â”€ network
â”‚                   â”‚   â”‚   â”œâ”€â”€ HttpClientFactory.kt
â”‚                   â”‚   â”‚   â””â”€â”€ NetworkConstants.kt
â”‚                   â”‚   â”œâ”€â”€ util
â”‚                   â”‚   â”‚   â”œâ”€â”€ CryptoUtil.kt
â”‚                   â”‚   â”‚   â””â”€â”€ State.kt
â”‚                   â”‚   â””â”€â”€ zxzx.kt
â”‚                   â”œâ”€â”€ data
â”‚                   â”‚   â”œâ”€â”€ mapper
â”‚                   â”‚   â”œâ”€â”€ network
â”‚                   â”‚   â”‚   â”œâ”€â”€ profile
â”‚                   â”‚   â”‚   â”œâ”€â”€ ApiService.kt
â”‚                   â”‚   â”‚   â”œâ”€â”€ ApiServiceImpl.kt
â”‚                   â”‚   â”‚   â”œâ”€â”€ AuthApiService.kt
â”‚                   â”‚   â”‚   â”œâ”€â”€ AuthApiServiceImpl.kt
â”‚                   â”‚   â”‚   â”œâ”€â”€ PasswordResetApiService.kt
â”‚                   â”‚   â”‚   â”œâ”€â”€ PasswordResetApiServiceImpl.kt
â”‚                   â”‚   â”‚   â”œâ”€â”€ ProfileApiService.kt
â”‚                   â”‚   â”‚   â””â”€â”€ ProfileApiServiceImpl.kt
â”‚                   â”‚   â”œâ”€â”€ repository
â”‚                   â”‚   â”‚   â”œâ”€â”€ AuthRepositoryImpl.kt
â”‚                   â”‚   â”‚   â”œâ”€â”€ ItemsRepositoryImpl.kt
â”‚                   â”‚   â”‚   â”œâ”€â”€ PasswordResetRepositoryImpl.kt
â”‚                   â”‚   â”‚   â””â”€â”€ ProfileRepositoryImpl.kt
â”‚                   â”‚   â””â”€â”€ zxczxc.kt
â”‚                   â”œâ”€â”€ di
â”‚                   â”‚   â”œâ”€â”€ AppComponent.kt
â”‚                   â”‚   â”œâ”€â”€ appModule.kt
â”‚                   â”‚   â”œâ”€â”€ authModule.kt
â”‚                   â”‚   â”œâ”€â”€ dataStoreModule.kt
â”‚                   â”‚   â”œâ”€â”€ initKoin.kt
â”‚                   â”‚   â”œâ”€â”€ networkModule.kt
â”‚                   â”‚   â”œâ”€â”€ platformModule.kt
â”‚                   â”‚   â”œâ”€â”€ profileModule.kt
â”‚                   â”‚   â”œâ”€â”€ RepositoryModule.kt
â”‚                   â”‚   â”œâ”€â”€ UseCaseModule.kt
â”‚                   â”‚   â””â”€â”€ ViewModelModule.kt
â”‚                   â”œâ”€â”€ domain
â”‚                   â”‚   â”œâ”€â”€ model
â”‚                   â”‚   â”‚   â”œâ”€â”€ auth.kt
â”‚                   â”‚   â”‚   â”œâ”€â”€ PasswordReset.kt
â”‚                   â”‚   â”‚   â”œâ”€â”€ Profile.kt
â”‚                   â”‚   â”‚   â”œâ”€â”€ Source.kt
â”‚                   â”‚   â”‚   â””â”€â”€ SourceState.kt
â”‚                   â”‚   â”œâ”€â”€ repository
â”‚                   â”‚   â”‚   â”œâ”€â”€ AuthRepository.kt
â”‚                   â”‚   â”‚   â”œâ”€â”€ ItemsRepository.kt
â”‚                   â”‚   â”‚   â”œâ”€â”€ PasswordResetRepository.kt
â”‚                   â”‚   â”‚   â””â”€â”€ ProfileRepository.kt
â”‚                   â”‚   â”œâ”€â”€ usecase
â”‚                   â”‚   â”‚   â”œâ”€â”€ auth
â”‚                   â”‚   â”‚   â”‚   â”œâ”€â”€ CheckInputUseCase.kt
â”‚                   â”‚   â”‚   â”‚   â”œâ”€â”€ GetTokenUseCase.kt
â”‚                   â”‚   â”‚   â”‚   â”œâ”€â”€ GetUserSessionUseCase.kt
â”‚                   â”‚   â”‚   â”‚   â”œâ”€â”€ LoginUseCase.kt
â”‚                   â”‚   â”‚   â”‚   â””â”€â”€ LogoutUseCase.kt
â”‚                   â”‚   â”‚   â”œâ”€â”€ passwordreset
â”‚                   â”‚   â”‚   â”‚   â”œâ”€â”€ ChangePasswordUseCase.kt
â”‚                   â”‚   â”‚   â”‚   â”œâ”€â”€ RequestResetCodeUseCase.kt
â”‚                   â”‚   â”‚   â”‚   â””â”€â”€ SubmitResetCodeUseCase.kt
â”‚                   â”‚   â”‚   â”œâ”€â”€ profile
â”‚                   â”‚   â”‚   â”‚   â”œâ”€â”€ GetCurrentUserStatusUseCase.kt
â”‚                   â”‚   â”‚   â”‚   â””â”€â”€ GetUserProfileUseCase.kt
â”‚                   â”‚   â”‚   â””â”€â”€ GetSourcesUseCase.kt
â”‚                   â”‚   â””â”€â”€ assadsa.kt
â”‚                   â”œâ”€â”€ navigation
â”‚                   â”‚   â”œâ”€â”€ AppNavigation.kt
â”‚                   â”‚   â””â”€â”€ Screen.kt
â”‚                   â”œâ”€â”€ presentation
â”‚                   â”‚   â”œâ”€â”€ ui
â”‚                   â”‚   â”‚   â”œâ”€â”€ LoginScreen.kt
â”‚                   â”‚   â”‚   â”œâ”€â”€ PasswordResetScreen.kt
â”‚                   â”‚   â”‚   â”œâ”€â”€ ProfileScreen.kt
â”‚                   â”‚   â”‚   â””â”€â”€ SourcesScreen.kt
â”‚                   â”‚   â”œâ”€â”€ viewmodel
â”‚                   â”‚   â”‚   â”œâ”€â”€ AuthViewModel.kt
â”‚                   â”‚   â”‚   â”œâ”€â”€ PasswordResetViewModel.kt
â”‚                   â”‚   â”‚   â”œâ”€â”€ ProfileViewModel.kt
â”‚                   â”‚   â”‚   â””â”€â”€ SourcesViewModel.kt
â”‚                   â”‚   â”œâ”€â”€ asdas.kt
â”‚                   â”‚   â””â”€â”€ AuthUiState.kt
â”‚                   â”œâ”€â”€ test
â”‚                   â”‚   â”œâ”€â”€ screens.kt
â”‚                   â”‚   â””â”€â”€ SettingsScreen.kt
â”‚                   â”œâ”€â”€ theme
â”‚                   â”‚   â”œâ”€â”€ splash_screen
â”‚                   â”‚   â”‚   â”œâ”€â”€ shouldShowSplash.kt
â”‚                   â”‚   â”‚   â””â”€â”€ SplashScreen.kt
â”‚                   â”‚   â”œâ”€â”€ ThemeManager.kt
â”‚                   â”‚   â”œâ”€â”€ Themes.kt
â”‚                   â”‚   â””â”€â”€ ThemeViewModel.kt
â”‚                   â”œâ”€â”€ App.kt
â”‚                   â”œâ”€â”€ Greeting.kt
â”‚                   â””â”€â”€ Platform.kt
â”œâ”€â”€ iosMain
â”‚   â””â”€â”€ kotlin
â”‚       â””â”€â”€ me
â”‚           â””â”€â”€ onvo
â”‚               â””â”€â”€ onvo
â”‚                   â”œâ”€â”€ core
â”‚                   â”‚   â”œâ”€â”€ device
â”‚                   â”‚   â”‚   â””â”€â”€ DeviceInfoProvider.ios.kt
â”‚                   â”‚   â””â”€â”€ util
â”‚                   â”‚       â””â”€â”€ CryptoUtil.ios.kt
â”‚                   â”œâ”€â”€ di
â”‚                   â”‚   â””â”€â”€ platformModule.ios.kt
â”‚                   â”œâ”€â”€ theme
â”‚                   â”‚   â””â”€â”€ splash_screen
â”‚                   â”‚       â””â”€â”€ shouldShowSplash.ios.kt
â”‚                   â”œâ”€â”€ MainViewController.kt
â”‚                   â””â”€â”€ Platform.ios.kt
â”œâ”€â”€ jvmMain
â”‚   â””â”€â”€ kotlin
â”‚       â””â”€â”€ me
â”‚           â””â”€â”€ onvo
â”‚               â””â”€â”€ onvo
â”‚                   â”œâ”€â”€ core
â”‚                   â”‚   â”œâ”€â”€ datastore
â”‚                   â”‚   â”‚   â””â”€â”€ DataStoreFactory.jvm.kt
â”‚                   â”‚   â”œâ”€â”€ device
â”‚                   â”‚   â”‚   â””â”€â”€ DeviceInfoProvider.jvm.kt
â”‚                   â”‚   â”œâ”€â”€ network
â”‚                   â”‚   â”‚   â””â”€â”€ HttpClientFactory.jvm.kt
â”‚                   â”‚   â””â”€â”€ util
â”‚                   â”‚       â””â”€â”€ CryptoUtil.jvm.kt
â”‚                   â”œâ”€â”€ di
â”‚                   â”‚   â””â”€â”€ platformModule.jvm.kt
â”‚                   â”œâ”€â”€ theme
â”‚                   â”‚   â””â”€â”€ splash_screen
â”‚                   â”‚       â””â”€â”€ shouldShowSplash.jvm.kt
â”‚                   â”œâ”€â”€ main.kt
â”‚                   â””â”€â”€ Platform.jvm.kt
â”œâ”€â”€ nativeMain
â”‚   â””â”€â”€ kotlin
â”‚       â””â”€â”€ me
â”‚           â””â”€â”€ onvo
â”‚               â””â”€â”€ onvo
â”‚                   â””â”€â”€ core
â”‚                       â”œâ”€â”€ datastore
â”‚                       â”‚   â””â”€â”€ DataStoreFactory.native.kt
â”‚                       â””â”€â”€ network
â”‚                           â””â”€â”€ HttpClientFactory.native.kt
â””â”€â”€ repo_viewer.py

ğŸ“„ Code Contents

==== androidMain\AndroidManifest.xml ====
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
    <uses-permission android:name="android.permission.READ_PHONE_STATE" />

    <application
        android:allowBackup="true"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:supportsRtl="true"
        android:name=".OnvoApp"
        android:theme="@style/AppTheme">

        <activity
            android:exported="true"
            android:name=".MainActivity"
            android:theme="@style/SplashTheme">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
    </application>

</manifest>


==== androidMain\kotlin\me\onvo\onvo\core\datastore\DataStoreFactory.android.kt ====
package me.onvo.onvo.core.datastore

import androidx.datastore.core.DataStore
import androidx.datastore.preferences.core.Preferences
import android.content.Context

private lateinit var applicationContext: Context

fun initPreferencesDataStore(appContext: Context) {
    applicationContext = appContext
}


fun getPreferencesDataStorePath(appContext: Context): String =
    appContext.filesDir.resolve(dataStoreFileName).absolutePath

actual fun createPreferencesDataStore(): DataStore<Preferences> {
    val path = getPreferencesDataStorePath(applicationContext)
    return getPreferencesDataStore(path)
}


==== androidMain\kotlin\me\onvo\onvo\core\device\DeviceInfoProvider.android.kt ====
package me.onvo.onvo.core.device

import android.annotation.SuppressLint
import android.content.Context
import android.content.pm.PackageManager
import android.os.Build
import android.provider.Settings
import android.telephony.TelephonyManager
import me.onvo.onvo.domain.model.DeviceInfo
import java.util.*

actual class DeviceInfoProvider(private val context: Context) {

    @SuppressLint("HardwareIds")
    actual fun getDeviceInfo(): DeviceInfo {
        val deviceId = try {
            Settings.Secure.getString(context.contentResolver, Settings.Secure.ANDROID_ID)
        } catch (e: Exception) {
            null
        }

        return DeviceInfo(
            deviceId = deviceId ?: "Unknown",
            brand = Build.BRAND ?: "Unknown",
            model = Build.MODEL ?: "Unknown",
            systemName = "Android",
            systemVersion = Build.VERSION.RELEASE ?: "Unknown",
            appVersion = getAppVersion(),
            buildNumber = getAppBuildNumber(),
            uniqueId = deviceId ?: "Unknown",
            deviceName = Build.DEVICE ?: "Unknown",
            isTablet = isTablet(),
            carrier = getCarrier(),
            timezone = TimeZone.getDefault().id ?: "Unknown"
        )
    }

    private fun getAppVersion(): String {
        return try {
            val pInfo = context.packageManager.getPackageInfo(context.packageName, 0)
            pInfo.versionName ?: "1.0.0"
        } catch (e: PackageManager.NameNotFoundException) {
            "1.0.0"
        }
    }

    private fun getAppBuildNumber(): String {
        return try {
            val pInfo = context.packageManager.getPackageInfo(context.packageName, 0)
            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P)
                pInfo.longVersionCode.toString()
            else
                @Suppress("DEPRECATION") pInfo.versionCode.toString()
        } catch (e: Exception) {
            "1"
        }
    }

    private fun isTablet(): Boolean {
        val configuration = context.resources.configuration
        return (configuration.screenLayout and
                android.content.res.Configuration.SCREENLAYOUT_SIZE_MASK) >=
                android.content.res.Configuration.SCREENLAYOUT_SIZE_LARGE
    }

    private fun getCarrier(): String {
        return try {
            val tm = context.getSystemService(Context.TELEPHONY_SERVICE) as TelephonyManager
            tm.networkOperatorName.takeIf { it.isNotEmpty() } ?: "Unknown"
        } catch (e: Exception) {
            "Unknown"
        }
    }
}



==== androidMain\kotlin\me\onvo\onvo\core\network\HttpClientFactory.android.kt ====
package me.onvo.onvo.core.network

import io.ktor.client.HttpClient

import io.ktor.client.*
import io.ktor.client.engine.okhttp.*
import io.ktor.client.plugins.HttpTimeout
import io.ktor.client.plugins.contentnegotiation.ContentNegotiation
import io.ktor.serialization.kotlinx.json.*
import kotlinx.serialization.json.Json
import io.ktor.client.plugins.logging.*

actual class HttpClientFactory {
    actual fun create(): HttpClient = HttpClient(OkHttp) {
        install(ContentNegotiation) {
            json(Json { ignoreUnknownKeys = true })
        }
        install(Logging) { logger = Logger.SIMPLE; level = LogLevel.INFO }
        install(HttpTimeout) { requestTimeoutMillis = 15000 }
        engine {
            // optional: configure OkHttpClient via preconfigured if you want cert pinning, interceptors, etc.
        }
    }
}



==== androidMain\kotlin\me\onvo\onvo\core\util\CryptoUtil.android.kt ====
package me.onvo.onvo.core.util

import java.security.MessageDigest


actual object CryptoUtil {
    actual fun md5(input: String): String {
        val md = MessageDigest.getInstance("MD5")
        val digest = md.digest(input.toByteArray())
        return digest.joinToString("") { "%02x".format(it) }
    }
}


==== androidMain\kotlin\me\onvo\onvo\di\initKoinAndroid.kt ====
package me.onvo.onvo.di

import android.app.Application
import org.koin.android.ext.koin.androidContext
import org.koin.core.context.startKoin

fun initKoinAndroid(app: Application) {
    startKoin {
        androidContext(app)
        modules(
            networkModule,
            repositoryModule,
            useCaseModule,
            appModule,
            dataStoreModule,
            viewModelModule,
            authModule,
            platformModule,
            profileModule,
        )
    }
}



==== androidMain\kotlin\me\onvo\onvo\di\platformModule.android.kt ====
package me.onvo.onvo.di

import org.koin.core.module.Module

import me.onvo.onvo.core.device.DeviceInfoProvider
import org.koin.android.ext.koin.androidContext
import org.koin.dsl.module

actual val platformModule = module {
    single { DeviceInfoProvider(androidContext()) }
}



==== androidMain\kotlin\me\onvo\onvo\MainActivity.kt ====
package me.onvo.onvo

import android.os.Bundle
import android.util.Log
import androidx.activity.ComponentActivity
import androidx.activity.compose.setContent
import androidx.activity.enableEdgeToEdge
import androidx.compose.foundation.Image
import androidx.compose.runtime.Composable
import androidx.compose.ui.tooling.preview.Preview
import androidx.core.splashscreen.SplashScreen.Companion.installSplashScreen
import me.onvo.onvo.core.datastore.initPreferencesDataStore
import onvo.composeapp.generated.resources.Res
import onvo.composeapp.generated.resources.compose_multiplatform
import org.jetbrains.compose.resources.painterResource

class MainActivity : ComponentActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        initPreferencesDataStore(applicationContext)

        val splashScreen = installSplashScreen()
        var keepSplashScreen = true
        splashScreen.setKeepOnScreenCondition { keepSplashScreen }

        super.onCreate(savedInstanceState)
        enableEdgeToEdge()

        setContent {
            Log.d("MainActivityasdasdasd", "setContent")
            App()
        }

        window.decorView.post {
            keepSplashScreen = false
        }
    }
}
//@Preview
//@Composable
//fun AppAndroidPreview() {
//    App()
//}


==== androidMain\kotlin\me\onvo\onvo\OnvoApp.kt ====
package me.onvo.onvo

import android.app.Application
import android.util.Log
import me.onvo.onvo.di.initKoin
import me.onvo.onvo.di.initKoinAndroid
import me.onvo.onvo.di.networkModule
import org.koin.android.ext.koin.androidContext
import org.koin.core.context.startKoin

class OnvoApp : Application() {
    override fun onCreate() {
        super.onCreate()


        initKoinAndroid(this)
    }
}


==== androidMain\kotlin\me\onvo\onvo\Platform.android.kt ====
package me.onvo.onvo

import android.os.Build

class AndroidPlatform : Platform {
    override val name: String = "Android ${Build.VERSION.SDK_INT}"
}

actual fun getPlatform(): Platform = AndroidPlatform()


==== androidMain\kotlin\me\onvo\onvo\theme\splash_screen\shouldShowSplash.android.kt ====
package me.onvo.onvo.theme.splash_screen

actual val shouldShowSplash: Boolean
    get() = false


==== androidMain\res\drawable\ic_launcher_background.xml ====
<?xml version="1.0" encoding="utf-8"?>
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="108dp"
    android:height="108dp"
    android:viewportWidth="108"
    android:viewportHeight="108">
    <path
        android:fillColor="#3DDC84"
        android:pathData="M0,0h108v108h-108z" />
    <path
        android:fillColor="#00000000"
        android:pathData="M9,0L9,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,0L19,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M29,0L29,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M39,0L39,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M49,0L49,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M59,0L59,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M69,0L69,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M79,0L79,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M89,0L89,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M99,0L99,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,9L108,9"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,19L108,19"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,29L108,29"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,39L108,39"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,49L108,49"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,59L108,59"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,69L108,69"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,79L108,79"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,89L108,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,99L108,99"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,29L89,29"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,39L89,39"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,49L89,49"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,59L89,59"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,69L89,69"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,79L89,79"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M29,19L29,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M39,19L39,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M49,19L49,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M59,19L59,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M69,19L69,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M79,19L79,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
</vector>


==== androidMain\res\drawable-v24\ic_launcher_foreground.xml ====
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:aapt="http://schemas.android.com/aapt"
    android:width="108dp"
    android:height="108dp"
    android:viewportWidth="108"
    android:viewportHeight="108">
    <path android:pathData="M31,63.928c0,0 6.4,-11 12.1,-13.1c7.2,-2.6 26,-1.4 26,-1.4l38.1,38.1L107,108.928l-32,-1L31,63.928z">
        <aapt:attr name="android:fillColor">
            <gradient
                android:endX="85.84757"
                android:endY="92.4963"
                android:startX="42.9492"
                android:startY="49.59793"
                android:type="linear">
                <item
                    android:color="#44000000"
                    android:offset="0.0" />
                <item
                    android:color="#00000000"
                    android:offset="1.0" />
            </gradient>
        </aapt:attr>
    </path>
    <path
        android:fillColor="#FFFFFF"
        android:fillType="nonZero"
        android:pathData="M65.3,45.828l3.8,-6.6c0.2,-0.4 0.1,-0.9 -0.3,-1.1c-0.4,-0.2 -0.9,-0.1 -1.1,0.3l-3.9,6.7c-6.3,-2.8 -13.4,-2.8 -19.7,0l-3.9,-6.7c-0.2,-0.4 -0.7,-0.5 -1.1,-0.3C38.8,38.328 38.7,38.828 38.9,39.228l3.8,6.6C36.2,49.428 31.7,56.028 31,63.928h46C76.3,56.028 71.8,49.428 65.3,45.828zM43.4,57.328c-0.8,0 -1.5,-0.5 -1.8,-1.2c-0.3,-0.7 -0.1,-1.5 0.4,-2.1c0.5,-0.5 1.4,-0.7 2.1,-0.4c0.7,0.3 1.2,1 1.2,1.8C45.3,56.528 44.5,57.328 43.4,57.328L43.4,57.328zM64.6,57.328c-0.8,0 -1.5,-0.5 -1.8,-1.2s-0.1,-1.5 0.4,-2.1c0.5,-0.5 1.4,-0.7 2.1,-0.4c0.7,0.3 1.2,1 1.2,1.8C66.5,56.528 65.6,57.328 64.6,57.328L64.6,57.328z"
        android:strokeWidth="1"
        android:strokeColor="#00000000" />
</vector>


==== androidMain\res\mipmap-anydpi-v26\ic_launcher.xml ====
<?xml version="1.0" encoding="utf-8"?>
<adaptive-icon xmlns:android="http://schemas.android.com/apk/res/android">
    <background android:drawable="@drawable/ic_launcher_background" />
    <foreground android:drawable="@drawable/ic_launcher_foreground" />
</adaptive-icon>


==== androidMain\res\mipmap-anydpi-v26\ic_launcher_round.xml ====
<?xml version="1.0" encoding="utf-8"?>
<adaptive-icon xmlns:android="http://schemas.android.com/apk/res/android">
    <background android:drawable="@drawable/ic_launcher_background" />
    <foreground android:drawable="@drawable/ic_launcher_foreground" />
</adaptive-icon>


==== androidMain\res\values\colors.xml ====
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <color name="splash_background">#6200EE</color>
    <color name="primary">#6200EE</color>
    <color name="primary_dark">#3700B3</color>
    <color name="accent">#03DAC6</color>
</resources>


==== androidMain\res\values\strings.xml ====
<resources>
    <string name="app_name">ONVO</string>
</resources>


==== androidMain\res\values\themes.xml ====
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <!-- Base application theme -->
    <style name="AppTheme" parent="android:Theme.Material.Light.NoActionBar">
        <item name="android:statusBarColor">@android:color/transparent</item>
        <item name="android:windowLightStatusBar">true</item>
    </style>

    <!-- Splash Screen Theme -->
    <style name="SplashTheme" parent="AppTheme">
        <item name="android:windowBackground">@color/splash_background</item>
        <item name="android:statusBarColor">@color/splash_background</item>
    </style>
</resources>


==== commonMain\composeResources\drawable\compose-multiplatform.xml ====
<vector
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:aapt="http://schemas.android.com/aapt"
    android:width="450dp"
    android:height="450dp"
    android:viewportWidth="64"
    android:viewportHeight="64">
  <path
      android:pathData="M56.25,18V46L32,60 7.75,46V18L32,4Z"
      android:fillColor="#6075f2"/>
  <path
      android:pathData="m41.5,26.5v11L32,43V60L56.25,46V18Z"
      android:fillColor="#6b57ff"/>
  <path
      android:pathData="m32,43 l-9.5,-5.5v-11L7.75,18V46L32,60Z">
    <aapt:attr name="android:fillColor">
      <gradient
          android:centerX="23.131"
          android:centerY="18.441"
          android:gradientRadius="42.132"
          android:type="radial">
        <item android:offset="0" android:color="#FF5383EC"/>
        <item android:offset="0.867" android:color="#FF7F52FF"/>
      </gradient>
    </aapt:attr>
  </path>
  <path
      android:pathData="M22.5,26.5 L32,21 41.5,26.5 56.25,18 32,4 7.75,18Z">
    <aapt:attr name="android:fillColor">
      <gradient
          android:startX="44.172"
          android:startY="4.377"
          android:endX="17.973"
          android:endY="34.035"
          android:type="linear">
        <item android:offset="0" android:color="#FF33C3FF"/>
        <item android:offset="0.878" android:color="#FF5383EC"/>
      </gradient>
    </aapt:attr>
  </path>
  <path
      android:pathData="m32,21 l9.526,5.5v11L32,43 22.474,37.5v-11z"
      android:fillColor="#000000"/>
</vector>


==== commonMain\kotlin\me\onvo\onvo\App.kt ====
package me.onvo.onvo


import androidx.compose.material3.MaterialTheme
import androidx.compose.runtime.*
import me.onvo.onvo.navigation.AppNavigation
import me.onvo.onvo.presentation.ui.SourcesScreen
import me.onvo.onvo.presentation.viewmodel.AuthViewModel
import me.onvo.onvo.presentation.viewmodel.SourcesViewModel
import org.koin.compose.koinInject
import androidx.compose.foundation.isSystemInDarkTheme
import androidx.compose.material3.darkColorScheme
import androidx.compose.material3.lightColorScheme
import me.onvo.onvo.theme.AppTheme
import me.onvo.onvo.theme.ThemeManager
import me.onvo.onvo.theme.ThemeMode
import me.onvo.onvo.theme.ThemeViewModel
import me.onvo.onvo.theme.splash_screen.SplashScreen
import me.onvo.onvo.theme.splash_screen.shouldShowSplash


@Composable
fun App() {


    var showSplash by remember { mutableStateOf(shouldShowSplash) }


    val themeViewModel: ThemeViewModel = koinInject()
    val themeMode by themeViewModel.themeMode.collectAsState()
    val isDarkMode by themeViewModel.isDarkMode.collectAsState()
    val systemInDarkTheme = isSystemInDarkTheme()

    // Determine if dark theme should be used
    val useDarkTheme = when (themeMode) {
        ThemeMode.LIGHT -> false
        ThemeMode.DARK -> true
        ThemeMode.SYSTEM -> systemInDarkTheme
    }

    MaterialTheme(
        colorScheme = if (useDarkTheme) darkColorScheme() else lightColorScheme()
    ) {
        if (showSplash) {
            SplashScreen(
                onSplashFinished = { showSplash = false }
            )
        } else {
            AppNavigation(themeViewModel = themeViewModel)
        }
    }
}
//@Composable
//fun App() {
//    MaterialTheme {
//        val viewModel: SourcesViewModel = koinInject()
//        SourcesScreen(viewModel = viewModel)
//    }
//}
//









==== commonMain\kotlin\me\onvo\onvo\core\config\AppConfig.kt ====
package me.onvo.onvo.core.config


object AppConfig {
    const val   BASE_URL = "https://api.onvo.me/"
    const val TIMEOUT_MILLIS = 15000L
    const val ENABLE_LOGGING = true

    object Database {
        const val NAME = "app_database.db"
        const val VERSION = 1
    }
}


==== commonMain\kotlin\me\onvo\onvo\core\datastore\DataStoreFactory.kt ====
package me.onvo.onvo.core.datastore

import androidx.datastore.core.DataStore
import androidx.datastore.preferences.core.PreferenceDataStoreFactory
import androidx.datastore.preferences.core.Preferences
import okio.Path.Companion.toPath

internal const val dataStoreFileName = "onvo.preferences_pb"

fun getPreferencesDataStore(path: String) = PreferenceDataStoreFactory.createWithPath {
    path.toPath()
}

expect fun createPreferencesDataStore(): DataStore<Preferences>


==== commonMain\kotlin\me\onvo\onvo\core\datastore\PreferencesManager.kt ====
// File: commonMain/kotlin/me/onvo/onvo/core/datastore/PreferencesManager.kt
// Complete updated PreferencesManager with auth methods
package me.onvo.onvo.core.datastore

import androidx.datastore.core.DataStore
import androidx.datastore.preferences.core.Preferences
import androidx.datastore.preferences.core.booleanPreferencesKey
import androidx.datastore.preferences.core.edit
import androidx.datastore.preferences.core.stringPreferencesKey
import kotlinx.coroutines.flow.Flow
import kotlinx.coroutines.flow.first
import kotlinx.coroutines.flow.map
import me.onvo.onvo.theme.ThemeMode

class PreferencesManager(private val dataStore: DataStore<Preferences>) {

    companion object {
        // Theme preferences
        private val IS_DARK_MODE = booleanPreferencesKey("is_dark_mode")
        private val THEME_MODE = stringPreferencesKey("theme_mode")

        // Drawable/Image preferences
        private val SELECTED_AVATAR = stringPreferencesKey("selected_avatar")
        private val CUSTOM_BACKGROUND = stringPreferencesKey("custom_background")

        // Auth preferences
        private val AUTH_TOKEN = stringPreferencesKey("auth_token")
        private val USER_ID = stringPreferencesKey("user_id")
        private val USER_NAME = stringPreferencesKey("user_name")

        // Other preferences
        private val IS_FIRST_LAUNCH = booleanPreferencesKey("is_first_launch")
    }

    // ========== Theme Functions ==========

    suspend fun setDarkMode(isDark: Boolean) {
        dataStore.edit { preferences ->
            preferences[IS_DARK_MODE] = isDark
        }
    }

    fun isDarkMode(): Flow<Boolean> {
        return dataStore.data.map { preferences ->
            preferences[IS_DARK_MODE] ?: false
        }
    }

    suspend fun setThemeMode(mode: ThemeMode) {
        dataStore.edit { preferences ->
            preferences[THEME_MODE] = mode.name
        }
    }

    fun getThemeMode(): Flow<ThemeMode> {
        return dataStore.data.map { preferences ->
            val modeName = preferences[THEME_MODE] ?: ThemeMode.SYSTEM.name
            ThemeMode.valueOf(modeName)
        }
    }

    // ========== Drawable/Image Functions ==========

    suspend fun setSelectedAvatar(avatarPath: String) {
        dataStore.edit { preferences ->
            preferences[SELECTED_AVATAR] = avatarPath
        }
    }

    fun getSelectedAvatar(): Flow<String?> {
        return dataStore.data.map { preferences ->
            preferences[SELECTED_AVATAR]
        }
    }

    suspend fun setCustomBackground(backgroundPath: String) {
        dataStore.edit { preferences ->
            preferences[CUSTOM_BACKGROUND] = backgroundPath
        }
    }

    fun getCustomBackground(): Flow<String?> {
        return dataStore.data.map { preferences ->
            preferences[CUSTOM_BACKGROUND]
        }
    }

    // ========== Auth Functions ==========

    suspend fun saveAuthToken(token: String) {
        dataStore.edit { preferences ->
            preferences[AUTH_TOKEN] = token
        }
    }

    suspend fun getAuthToken(): String? {
        return dataStore.data.map { preferences ->
            preferences[AUTH_TOKEN]
        }.first()
    }

    suspend fun clearAuthToken() {
        dataStore.edit { preferences ->
            preferences.remove(AUTH_TOKEN)
        }
    }

    suspend fun saveUserSession(userId: String, userName: String) {
        dataStore.edit { preferences ->
            preferences[USER_ID] = userId
            preferences[USER_NAME] = userName
        }
    }

    suspend fun getUserSession(): Pair<String?, String?> {
        return dataStore.data.map { preferences ->
            Pair(preferences[USER_ID], preferences[USER_NAME])
        }.first()
    }

    suspend fun clearUserSession() {
        dataStore.edit { preferences ->
            preferences.remove(USER_ID)
            preferences.remove(USER_NAME)
        }
    }

    // ========== Other Utility Functions ==========

    fun isFirstLaunch(): Flow<Boolean> {
        return dataStore.data.map { preferences ->
            preferences[IS_FIRST_LAUNCH] ?: true
        }
    }

    suspend fun setFirstLaunchComplete() {
        dataStore.edit { preferences ->
            preferences[IS_FIRST_LAUNCH] = false
        }
    }

    suspend fun clearAll() {
        dataStore.edit { preferences ->
            preferences.clear()
        }
    }
}


==== commonMain\kotlin\me\onvo\onvo\core\device\DeviceInfoProvider.kt ====
package me.onvo.onvo.core.device

import me.onvo.onvo.domain.model.DeviceInfo

expect class DeviceInfoProvider {
    fun getDeviceInfo(): DeviceInfo
}



==== commonMain\kotlin\me\onvo\onvo\core\network\HttpClientFactory.kt ====
package me.onvo.onvo.core.network

import io.ktor.client.HttpClient

expect class HttpClientFactory() {
    fun create(): HttpClient

}

// Extension for easy access
fun HttpClientFactory.createConfigured(): HttpClient = create()


==== commonMain\kotlin\me\onvo\onvo\core\network\NetworkConstants.kt ====
package me.onvo.onvo.core.network


object NetworkConstants {
    const val HEADER_AUTH = "Authorization"
    const val HEADER_CONTENT_TYPE = "Content-Type"
    const val CONTENT_TYPE_JSON = "application/json"
}


==== commonMain\kotlin\me\onvo\onvo\core\util\CryptoUtil.kt ====
package me.onvo.onvo.core.util

expect object CryptoUtil {
    fun md5(input: String): String
}


==== commonMain\kotlin\me\onvo\onvo\core\util\State.kt ====
package me.onvo.onvo.core.util


sealed class State<out T> {
    data class Success<T>(val data: T) : State<T>()
    data class Error(val exception: Throwable, val message: String? = null) : State<Nothing>()
    data object Loading : State<Nothing>()
}

inline fun <T> State<T>.onSuccess(action: (T) -> Unit): State<T> {
    if (this is State.Success) action(data)
    return this
}

inline fun <T> State<T>.onError(action: (Throwable) -> Unit): State<T> {
    if (this is State.Error) action(exception)
    return this
}


==== commonMain\kotlin\me\onvo\onvo\core\zxzx.kt ====
package me.onvo.onvo.core

object zxzx {
}


==== commonMain\kotlin\me\onvo\onvo\data\network\ApiService.kt ====
package me.onvo.onvo.data.network

import me.onvo.onvo.domain.model.Source


// commonMain
interface ApiService {
    suspend fun fetchItems(): List<Source>
}


==== commonMain\kotlin\me\onvo\onvo\data\network\ApiServiceImpl.kt ====
package me.onvo.onvo.data.network

import io.ktor.client.HttpClient
import io.ktor.client.call.body
import io.ktor.client.request.get
import io.ktor.client.statement.HttpResponse
import io.ktor.client.statement.bodyAsText
import kotlinx.serialization.builtins.ListSerializer
import kotlinx.serialization.json.Json
import me.onvo.onvo.domain.model.Source

class ApiServiceImpl(
    private val client: HttpClient,
    private val baseUrl: String,
    private val json: Json
) : ApiService {
    override suspend fun fetchItems() : List<Source> {
        val raw = client.get("https://yamimanga.me/source").bodyAsText()
        return try {
            val items = json.decodeFromString(ListSerializer(Source.Serializer), raw)
            items
        } catch (e: Exception) {
            println("Ã¢Å’ Error decoding response: ${e.message}\nRaw data: $raw")

            emptyList()
        }
    }
}


==== commonMain\kotlin\me\onvo\onvo\data\network\AuthApiService.kt ====
package me.onvo.onvo.data.network

import me.onvo.onvo.domain.model.CheckInputResponse
import me.onvo.onvo.domain.model.LoginRequest
import me.onvo.onvo.domain.model.LoginResponse
import me.onvo.onvo.domain.model.TokenRequest
import me.onvo.onvo.domain.model.TokenResponse


interface AuthApiService {
    suspend fun getToken(request: TokenRequest): TokenResponse
    suspend fun checkInput(input: String, token: String): CheckInputResponse
    suspend fun login(request: LoginRequest, token: String): LoginResponse
    suspend fun logout(token: String)
}


==== commonMain\kotlin\me\onvo\onvo\data\network\AuthApiServiceImpl.kt ====

// File: commonMain/kotlin/me/onvo/onvo/data/network/AuthApiService.kt
package me.onvo.onvo.data.network

import io.ktor.client.*
import io.ktor.client.call.*
import io.ktor.client.request.*
import io.ktor.http.*
import me.onvo.onvo.domain.model.CheckInputRequest
import me.onvo.onvo.domain.model.CheckInputResponse
import me.onvo.onvo.domain.model.LoginRequest
import me.onvo.onvo.domain.model.LoginResponse
import me.onvo.onvo.domain.model.TokenRequest
import me.onvo.onvo.domain.model.TokenResponse

class AuthApiServiceImpl(
    private val client: HttpClient,
    private val baseUrl: String
) : AuthApiService {

    override suspend fun getToken(request: TokenRequest): TokenResponse {
        return client.post("${baseUrl}token") {
            contentType(ContentType.Application.Json)
            setBody(request)
        }.body()
    }

    override suspend fun checkInput(input: String, token: String): CheckInputResponse {
        return client.post("${baseUrl}v2/auth/check") {
            contentType(ContentType.Application.Json)
            bearerAuth(token)
            setBody(CheckInputRequest(input))
        }.body()
    }

    override suspend fun login(request: LoginRequest, token: String): LoginResponse {
        return client.post("${baseUrl}v2/auth/login") {
            contentType(ContentType.Application.Json)
            bearerAuth(token)
            setBody(request)
        }.body()
    }

    override suspend fun logout(token: String) {
        client.post("${baseUrl}v2/auth/logout") {
            contentType(ContentType.Application.Json)
            bearerAuth(token)
        }
    }
}


==== commonMain\kotlin\me\onvo\onvo\data\network\PasswordResetApiService.kt ====
package me.onvo.onvo.data.network

import me.onvo.onvo.domain.model.*

interface PasswordResetApiService {
    suspend fun requestResetCode(userId: String, token: String): PasswordResetCodeResponse
    suspend fun submitResetCode(code: String, token: String): PasswordResetCodeVerifyResponse
    suspend fun changePassword(newPassword: String, token: String): PasswordChangeResponse
}



==== commonMain\kotlin\me\onvo\onvo\data\network\PasswordResetApiServiceImpl.kt ====
package me.onvo.onvo.data.network

import io.ktor.client.HttpClient
import io.ktor.client.call.body
import io.ktor.client.request.bearerAuth
import io.ktor.client.request.post
import io.ktor.client.request.setBody
import io.ktor.http.ContentType
import io.ktor.http.contentType
import me.onvo.onvo.domain.model.PasswordChangeRequest
import me.onvo.onvo.domain.model.PasswordChangeResponse
import me.onvo.onvo.domain.model.PasswordResetCodeResponse
import me.onvo.onvo.domain.model.PasswordResetCodeSubmit
import me.onvo.onvo.domain.model.PasswordResetCodeVerifyResponse
import me.onvo.onvo.domain.model.PasswordResetRequest


class PasswordResetApiServiceImpl(
    private val client: HttpClient,
    private val baseUrl: String
) : PasswordResetApiService {

    override suspend fun requestResetCode(
        userId: String,
        token: String
    ): PasswordResetCodeResponse {
        return client.post("${baseUrl}v2/auth/reset/request") {
            contentType(ContentType.Application.Json)
            bearerAuth(token)
            setBody(PasswordResetRequest(userId))
        }.body()
    }

    override suspend fun submitResetCode(
        code: String,
        token: String
    ): PasswordResetCodeVerifyResponse {
        return client.post("${baseUrl}v2/auth/reset/submit") {
            contentType(ContentType.Application.Json)
            bearerAuth(token)
            setBody(PasswordResetCodeSubmit(code))
        }.body()
    }

    override suspend fun changePassword(
        newPassword: String,
        token: String
    ): PasswordChangeResponse {
        return client.post("${baseUrl}v2/auth/reset/change") {
            contentType(ContentType.Application.Json)
            bearerAuth(token)
            setBody(PasswordChangeRequest(newPassword))
        }.body()
    }
}


==== commonMain\kotlin\me\onvo\onvo\data\network\ProfileApiService.kt ====
package me.onvo.onvo.data.network

import me.onvo.onvo.domain.model.AuthStatusResponse
import me.onvo.onvo.domain.model.UserProfileResponse

interface ProfileApiService {
    suspend fun getAuthStatus(token: String): AuthStatusResponse
    suspend fun getUserProfile(userId: Int, token: String? = null): UserProfileResponse
}


==== commonMain\kotlin\me\onvo\onvo\data\network\ProfileApiServiceImpl.kt ====
package me.onvo.onvo.data.network

import io.ktor.client.*
import io.ktor.client.call.*
import io.ktor.client.request.*
import io.ktor.client.statement.*
import io.ktor.http.*
import me.onvo.onvo.domain.model.AuthStatusResponse
import me.onvo.onvo.domain.model.UserProfileResponse

class ProfileApiServiceImpl(
    private val client: HttpClient,
    private val baseUrl: String
) : ProfileApiService {

    override suspend fun getAuthStatus(token: String): AuthStatusResponse {
        val response: HttpResponse = client.get("${baseUrl}v2/auth/status") {
            contentType(ContentType.Application.Json)
            bearerAuth(token)
        }

        // Check if unauthorized (401)
        if (response.status == HttpStatusCode.Unauthorized) {
            throw UnauthorizedException("Session expired or invalid token")
        }

        return response.body()
    }

    override suspend fun getUserProfile(userId: Int, token: String?): UserProfileResponse {
        return client.get("${baseUrl}v2/users") {
            contentType(ContentType.Application.Json)
            parameter("id", userId)
            token?.let { bearerAuth(it) }
        }.body()
    }
}

// Custom exception for unauthorized access
class UnauthorizedException(message: String) : Exception(message)


==== commonMain\kotlin\me\onvo\onvo\data\repository\AuthRepositoryImpl.kt ====
// File: commonMain/kotlin/me/onvo/onvo/data/repository/AuthRepositoryImpl.kt
package me.onvo.onvo.data.repository

import me.onvo.onvo.core.datastore.PreferencesManager
import me.onvo.onvo.data.network.AuthApiService
import me.onvo.onvo.domain.repository.AuthRepository
import me.onvo.onvo.core.util.State
import me.onvo.onvo.domain.model.CheckInputResponse
import me.onvo.onvo.domain.model.DeviceInfo
import me.onvo.onvo.domain.model.LoginRequest
import me.onvo.onvo.domain.model.LoginResponse
import me.onvo.onvo.domain.model.TokenRequest
import me.onvo.onvo.domain.model.TokenResponse

class AuthRepositoryImpl(
    private val authApiService: AuthApiService,
    private val preferencesManager: PreferencesManager
) : AuthRepository {

    override suspend fun getToken(deviceInfo: DeviceInfo): State<TokenResponse> {
        return try {
            val response = authApiService.getToken(TokenRequest(deviceInfo))
            State.Success(response)
        } catch (e: Exception) {
            State.Error(e, e.message ?: "Failed to get token")
        }
    }

    override suspend fun checkInput(input: String, token: String): State<CheckInputResponse> {
        return try {
            val response = authApiService.checkInput(input, token)

            // Check if response contains an error
            if (response.isError()) {
                State.Error(
                    exception = Exception(response.error),
                    message = response.message ?: "User not found"
                )
            } else if (response.isSuccess()) {
                State.Success(response)
            } else {
                State.Error(
                    exception = Exception("Invalid response"),
                    message = "Received invalid response from server"
                )
            }
        } catch (e: Exception) {
            State.Error(e, e.message ?: "Failed to check input")
        }
    }

    override suspend fun login(
        id: String,
        password: String,
        token: String
    ): State<LoginResponse> {
        return try {
            val request = LoginRequest(id, password)
            val response = authApiService.login(request, token)

            // Check if response contains an error
            if (response.isError()) {
                State.Error(
                    exception = Exception(response.error),
                    message = response.message ?: "Login failed"
                )
            } else if (response.isSuccess()) {
                State.Success(response)
            } else {
                State.Error(
                    exception = Exception("Invalid credentials"),
                    message = "Login failed. Please check your credentials."
                )
            }
        } catch (e: Exception) {
            State.Error(e, e.message ?: "Login failed")
        }
    }

    override suspend fun logout(token: String): State<Unit> {
        return try {
            authApiService.logout(token)
            State.Success(Unit)
        } catch (e: Exception) {
            State.Error(e, e.message ?: "Logout failed")
        }
    }

    // Local storage methods
    override suspend fun saveAuthToken(token: String) {
        preferencesManager.saveAuthToken(token)
    }

    override suspend fun getAuthToken(): String? {
        return preferencesManager.getAuthToken()
    }

    override suspend fun clearAuthToken() {
        preferencesManager.clearAuthToken()
    }

    override suspend fun saveUserSession(userId: String, userName: String) {
        preferencesManager.saveUserSession(userId, userName)
    }

    override suspend fun getUserSession(): Pair<String?, String?> {
        return preferencesManager.getUserSession()
    }

    override suspend fun clearUserSession() {
        preferencesManager.clearUserSession()
    }
}


==== commonMain\kotlin\me\onvo\onvo\data\repository\ItemsRepositoryImpl.kt ====
package me.onvo.onvo.data.repository


import me.onvo.onvo.data.network.ApiService
import me.onvo.onvo.domain.model.Source
import me.onvo.onvo.domain.repository.ItemsRepository


class ItemsRepositoryImpl(
    private val api: ApiService,

) : ItemsRepository {
    override suspend fun getItems(): List<Source> = api.fetchItems()
}



==== commonMain\kotlin\me\onvo\onvo\data\repository\PasswordResetRepositoryImpl.kt ====
package me.onvo.onvo.data.repository


import me.onvo.onvo.core.util.State
import me.onvo.onvo.data.network.PasswordResetApiService
import me.onvo.onvo.domain.model.*
import me.onvo.onvo.domain.repository.PasswordResetRepository

class PasswordResetRepositoryImpl(
    private val passwordResetApiService: PasswordResetApiService
) : PasswordResetRepository {

    override suspend fun requestResetCode(
        userId: String,
        token: String
    ): State<PasswordResetCodeResponse> {
        return try {
            val response = passwordResetApiService.requestResetCode(userId, token)

            if (response.isSuccess()) {
                State.Success(response)
            } else {
                State.Error(
                    exception = Exception(response.error ?: "Unknown error"),
                    message = response.message ?: "Failed to send reset code"
                )
            }
        } catch (e: Exception) {
            State.Error(e, e.message ?: "Failed to request reset code")
        }
    }

    override suspend fun submitResetCode(
        code: String,
        token: String
    ): State<PasswordResetCodeVerifyResponse> {
        return try {
            val response = passwordResetApiService.submitResetCode(code, token)

            if (response.isSuccess()) {
                State.Success(response)
            } else {
                State.Error(
                    exception = Exception(response.error ?: "Invalid code"),
                    message = response.message ?: "Code verification failed"
                )
            }
        } catch (e: Exception) {
            State.Error(e, e.message ?: "Failed to verify code")
        }
    }

    override suspend fun changePassword(
        newPassword: String,
        token: String
    ): State<PasswordChangeResponse> {
        return try {
            val response = passwordResetApiService.changePassword(newPassword, token)

            if (response.isSuccess()) {
                State.Success(response)
            } else {
                State.Error(
                    exception = Exception(response.error ?: "Failed to change password"),
                    message = "Password change failed"
                )
            }
        } catch (e: Exception) {
            State.Error(e, e.message ?: "Failed to change password")
        }
    }
}


==== commonMain\kotlin\me\onvo\onvo\data\repository\ProfileRepositoryImpl.kt ====
package me.onvo.onvo.data.repository

import me.onvo.onvo.core.datastore.PreferencesManager
import me.onvo.onvo.core.util.State
import me.onvo.onvo.data.network.ProfileApiService
import me.onvo.onvo.data.network.UnauthorizedException
import me.onvo.onvo.domain.model.AuthUserData
import me.onvo.onvo.domain.model.UserProfile
import me.onvo.onvo.domain.repository.ProfileRepository

class ProfileRepositoryImpl(
    private val profileApiService: ProfileApiService,
    private val preferencesManager: PreferencesManager
) : ProfileRepository {

    override suspend fun getCurrentUserStatus(): State<AuthUserData> {
        return try {
            val token = preferencesManager.getAuthToken()
                ?: return State.Error(
                    IllegalStateException("No auth token"),
                    "Please login first"
                )

            val response = profileApiService.getAuthStatus(token)

            if (response.isLoged) {
                State.Success(response.data)
            } else {
                State.Error(
                    IllegalStateException("Not logged in"),
                    "Session expired. Please login again"
                )
            }
        } catch (e: UnauthorizedException) {
            // Clear token on unauthorized
            preferencesManager.clearAuthToken()
            preferencesManager.clearUserSession()
            State.Error(e, "Session expired. Please login again")
        } catch (e: Exception) {
            State.Error(e, e.message ?: "Failed to get user status")
        }
    }

    override suspend fun getUserProfile(userId: Int): State<UserProfile> {
        return try {
            val token = preferencesManager.getAuthToken()
            val response = profileApiService.getUserProfile(userId, token)
            State.Success(response.user)
        } catch (e: Exception) {
            State.Error(e, e.message ?: "Failed to load profile")
        }
    }

    override suspend fun clearSession() {
        preferencesManager.clearAuthToken()
        preferencesManager.clearUserSession()
    }
}


==== commonMain\kotlin\me\onvo\onvo\data\zxczxc.kt ====
package me.onvo.onvo.data

object zxczxc {
}


==== commonMain\kotlin\me\onvo\onvo\di\AppComponent.kt ====
//package me.onvo.onvo.di
//
//
//
//import dev.zacsweers.metro.AppScope
//import dev.zacsweers.metro.DependencyGraph
//import dev.zacsweers.metro.Provides
//import dev.zacsweers.metro.SingleIn
//import dev.zacsweers.metro.createGraph
//import io.ktor.client.HttpClient
//import io.ktor.client.plugins.contentnegotiation.ContentNegotiation
//import io.ktor.serialization.kotlinx.json.json
//import kotlinx.serialization.json.Json
//import me.onvo.onvo.data.network.ApiService
//import me.onvo.onvo.data.network.ApiServiceImpl
//import me.onvo.onvo.data.network.HttpClientFactory
//import me.onvo.onvo.presentation.viewmodel.SourcesViewModel
//
//@DependencyGraph(AppScope::class)
//@SingleIn(AppScope::class)
//abstract class AppGraph {
//
//    // Expose ViewModel to UI
//    abstract val sourcesViewModel: SourcesViewModel
//
//    // Network providers
//    @Provides
//    @SingleIn(AppScope::class)
//    fun provideJson(): Json = Json {
//        ignoreUnknownKeys = true
//        isLenient = true
//        coerceInputValues = true
//        prettyPrint = false
//    }
//
//    @Provides
//    @SingleIn(AppScope::class)
//    fun provideHttpClient(json: Json): HttpClient {
//        return HttpClientFactory().createClient().config {
//            install(ContentNegotiation) {
//                json(json)
//            }
//        }
//    }
//
//    @Provides
//    @SingleIn(AppScope::class)
//    fun provideBaseUrl(): String = "https://yamimanga.me/"
//
//    @Provides
//    @SingleIn(AppScope::class)
//    fun provideApiService(
//        client: HttpClient,
//        baseUrl: String,
//        json: Json
//    ): ApiService = ApiServiceImpl(client, baseUrl, json)
//
//    companion object {
//        fun create(): AppGraph = createGraph<AppGraph>()
//    }
//}


==== commonMain\kotlin\me\onvo\onvo\di\appModule.kt ====
package me.onvo.onvo.di

import me.onvo.onvo.presentation.viewmodel.AuthViewModel
import me.onvo.onvo.presentation.viewmodel.SourcesViewModel
import me.onvo.onvo.theme.ThemeManager
import org.koin.dsl.module


val appModule = module {
    single { ThemeManager() }
    single { SourcesViewModel(get()) }
}


==== commonMain\kotlin\me\onvo\onvo\di\authModule.kt ====
package me.onvo.onvo.di

import me.onvo.onvo.data.network.AuthApiService
import me.onvo.onvo.data.network.AuthApiServiceImpl
import me.onvo.onvo.data.network.PasswordResetApiService
import me.onvo.onvo.data.network.PasswordResetApiServiceImpl
import me.onvo.onvo.data.repository.AuthRepositoryImpl
import me.onvo.onvo.data.repository.PasswordResetRepositoryImpl
import me.onvo.onvo.domain.repository.AuthRepository
import me.onvo.onvo.domain.repository.PasswordResetRepository
import me.onvo.onvo.domain.usecase.auth.*
import me.onvo.onvo.domain.usecase.passwordreset.*
import me.onvo.onvo.presentation.viewmodel.AuthViewModel
import me.onvo.onvo.presentation.viewmodel.PasswordResetViewModel
import org.koin.core.qualifier.named
import org.koin.dsl.module

val authModule = module {
    // Auth API Service
    single<AuthApiService> {
        AuthApiServiceImpl(
            client = get(),
            baseUrl = get(named("baseUrl"))
        )
    }

    // Password Reset API Service
    single<PasswordResetApiService> {
        PasswordResetApiServiceImpl(
            client = get(),
            baseUrl = get(named("baseUrl"))
        )
    }

    // Auth Repository
    single<AuthRepository> {
        AuthRepositoryImpl(
            authApiService = get(),
            preferencesManager = get()
        )
    }

    // Password Reset Repository
    single<PasswordResetRepository> {
        PasswordResetRepositoryImpl(
            passwordResetApiService = get()
        )
    }

    // Auth Use Cases
    factory {
        GetTokenUseCase(
            authRepository = get(),
            deviceInfoProvider = get()
        )
    }

    factory {
        CheckInputUseCase(
            authRepository = get()
        )
    }

    factory {
        LoginUseCase(
            authRepository = get()
        )
    }

    factory {
        LogoutUseCase(
            authRepository = get()
        )
    }

    factory {
        GetUserSessionUseCase(
            authRepository = get()
        )
    }

    // Password Reset Use Cases
    factory {
        RequestResetCodeUseCase(
            passwordResetRepository = get(),
            authRepository = get()
        )
    }

    factory {
        SubmitResetCodeUseCase(
            passwordResetRepository = get(),
            authRepository = get()
        )
    }

    factory {
        ChangePasswordUseCase(
            passwordResetRepository = get(),
            authRepository = get()
        )
    }

    // ViewModels
    single {
        AuthViewModel(
            getTokenUseCase = get(),
            checkInputUseCase = get(),
            loginUseCase = get(),
            logoutUseCase = get(),
            getUserSessionUseCase = get(),
            getCurrentUserStatusUseCase = get()  // Added this dependency
        )
    }

    single {
        PasswordResetViewModel(
            checkInputUseCase = get(),
            requestResetCodeUseCase = get(),
            submitResetCodeUseCase = get(),
            changePasswordUseCase = get(),
            authRepository = get()
        )
    }
}


==== commonMain\kotlin\me\onvo\onvo\di\dataStoreModule.kt ====
package me.onvo.onvo.di


// di module
import me.onvo.onvo.core.datastore.PreferencesManager
import org.koin.dsl.module
import androidx.datastore.core.DataStore

import androidx.datastore.preferences.core.Preferences
import me.onvo.onvo.core.datastore.createPreferencesDataStore

val dataStoreModule = module {
    // make DataStore<Preferences> available
    single<DataStore<Preferences>> { createPreferencesDataStore() }

    // PreferencesManager uses the DataStore
    single { PreferencesManager(get()) }
}



==== commonMain\kotlin\me\onvo\onvo\di\initKoin.kt ====
package me.onvo.onvo.di


import org.koin.core.context.startKoin

fun initKoin() {
    startKoin {
        modules(
            networkModule,
            repositoryModule,
            useCaseModule,
            appModule,
            dataStoreModule,
            viewModelModule,
            authModule,
            platformModule,
            profileModule,

        )
    }
}


==== commonMain\kotlin\me\onvo\onvo\di\networkModule.kt ====
package me.onvo.onvo.di

import io.ktor.client.HttpClient
import io.ktor.client.plugins.contentnegotiation.*
import io.ktor.serialization.kotlinx.json.*
import kotlinx.serialization.json.Json
import me.onvo.onvo.core.config.AppConfig
import me.onvo.onvo.core.network.HttpClientFactory
import me.onvo.onvo.data.network.ApiService
import me.onvo.onvo.data.network.ApiServiceImpl
import org.koin.core.qualifier.named
import org.koin.dsl.module
import io.ktor.client.plugins.*
import io.ktor.client.plugins.logging.*

val networkModule = module {

    single<Json> {
        Json {
            ignoreUnknownKeys = true
            isLenient = true
            coerceInputValues = true
            prettyPrint = false
        }
    }

    // register baseUrl as a named String
    single(named("baseUrl")) { AppConfig.BASE_URL }

    single<HttpClient> {
        HttpClientFactory().create().config {
            install(ContentNegotiation) { json(get()) }
            if (AppConfig.ENABLE_LOGGING) {
                install(Logging) {
                    logger = Logger.SIMPLE
                    level = LogLevel.ALL
                }
            }
            install(HttpTimeout) {
                requestTimeoutMillis = AppConfig.TIMEOUT_MILLIS
            }
            install(HttpRedirect) {
                checkHttpMethod = false // allows POST redirects
                allowHttpsDowngrade = false
            }
            defaultRequest {
                url(AppConfig.BASE_URL)
                headers.append("Content-Type", "application/json")
                // Optional: Accept JSON as well
                headers.append("Accept", "application/json")
            }
        }
    }

    single<ApiService> {
        // get() -> HttpClient, get(named("baseUrl")) -> String, get() -> Json
        ApiServiceImpl(get(), get(named("baseUrl")), json = get())
    }
}




==== commonMain\kotlin\me\onvo\onvo\di\platformModule.kt ====
package me.onvo.onvo.di


import me.onvo.onvo.core.device.DeviceInfoProvider
import org.koin.dsl.module

import org.koin.core.module.Module

expect val platformModule: Module


==== commonMain\kotlin\me\onvo\onvo\di\profileModule.kt ====
package me.onvo.onvo.di

import me.onvo.onvo.data.network.ProfileApiService
import me.onvo.onvo.data.network.ProfileApiServiceImpl
import me.onvo.onvo.data.repository.ProfileRepositoryImpl
import me.onvo.onvo.domain.repository.ProfileRepository
import me.onvo.onvo.domain.usecase.profile.GetCurrentUserStatusUseCase
import me.onvo.onvo.domain.usecase.profile.GetUserProfileUseCase
import me.onvo.onvo.presentation.viewmodel.ProfileViewModel
import org.koin.core.qualifier.named
import org.koin.dsl.module

val profileModule = module {
    // API Service
    single<ProfileApiService> {
        ProfileApiServiceImpl(
            client = get(),
            baseUrl = get(named("baseUrl"))
        )
    }

    // Repository
    single<ProfileRepository> {
        ProfileRepositoryImpl(
            profileApiService = get(),
            preferencesManager = get()
        )
    }

    // Use Cases
    factory {
        GetCurrentUserStatusUseCase(
            profileRepository = get()
        )
    }

    factory {
        GetUserProfileUseCase(
            profileRepository = get()
        )
    }

    // ViewModel
    single {
        ProfileViewModel(
            getCurrentUserStatusUseCase = get(),
            getUserProfileUseCase = get()
        )
    }
}


==== commonMain\kotlin\me\onvo\onvo\di\RepositoryModule.kt ====
package me.onvo.onvo.di

import me.onvo.onvo.data.repository.ItemsRepositoryImpl
import me.onvo.onvo.domain.repository.ItemsRepository
import org.koin.dsl.module

val repositoryModule = module {
    single<ItemsRepository> {
        ItemsRepositoryImpl(api = get())
    }
}


==== commonMain\kotlin\me\onvo\onvo\di\UseCaseModule.kt ====
package me.onvo.onvo.di

import me.onvo.onvo.domain.usecase.GetSourcesUseCase
import org.koin.dsl.module

val useCaseModule = module {
    factory {
        GetSourcesUseCase(repository = get())
    }
}


==== commonMain\kotlin\me\onvo\onvo\di\ViewModelModule.kt ====
package me.onvo.onvo.di

import me.onvo.onvo.data.repository.ItemsRepositoryImpl
import me.onvo.onvo.domain.repository.ItemsRepository
import me.onvo.onvo.presentation.viewmodel.SourcesViewModel
import me.onvo.onvo.theme.ThemeViewModel
import org.koin.dsl.module

val viewModelModule = module {
//    single< SourcesViewModel>  {
//        SourcesViewModel(getSourcesUseCase = get())
//    }
    single<ThemeViewModel> {
        ThemeViewModel(get())
    }

}


==== commonMain\kotlin\me\onvo\onvo\domain\assadsa.kt ====
package me.onvo.onvo.domain

object assadsa {
}


==== commonMain\kotlin\me\onvo\onvo\domain\model\auth.kt ====
// File: commonMain/kotlin/me/onvo/onvo/domain/model/auth.kt
package me.onvo.onvo.domain.model

import kotlinx.serialization.Serializable

@Serializable
data class DeviceInfo(
    val deviceId: String,
    val brand: String,
    val model: String,
    val systemName: String,
    val systemVersion: String,
    val appVersion: String,
    val buildNumber: String,
    val uniqueId: String,
    val deviceName: String,
    val isTablet: Boolean,
    val carrier: String?,
    val timezone: String
)

@Serializable
data class TokenRequest(
    val info: DeviceInfo
)

@Serializable
data class TokenResponse(
    val token: String,
    val vuse: String? = null
)

@Serializable
data class CheckInputRequest(
    val input: String
)

// Updated response model to handle both success and error
@Serializable
data class CheckInputResponse(
    val id: Int? = null,
    val fullname: String? = null,
    val image: String? = null,
    val username: String? = null,
    // Error fields
    val error: String? = null,
    val type: String? = null,
    val message: String? = null
) {
    fun isSuccess(): Boolean = error == null && id != null
    fun isError(): Boolean = error != null
}

@Serializable
data class LoginRequest(
    val id: String,
    val password: String // MD5 hashed
)

@Serializable
data class PlusInfo(
    val status: String? = null,
    val billing_period: String? = null,
    val start_date: String? = null,
    val end_date: String? = null,
    val external_id: String? = null,
    val payment_method: String? = null
)

@Serializable
data class UserCounts(
    val messages: Int = 0,
    val archives: Int = 0,
    val sent: Int = 0,
    val notifications: Int = 0
)

@Serializable
data class UserSettings(
    val theme: String? = null,
    val token: String? = null,
    val them: String? = null,
    val lang: String? = null,
    val ctm: String? = null,
    val aoe: String? = null,
    val reminder: Int? = null
)

@Serializable
data class SessionUser(
    val id: Int,
    val session_id: String,
    val username: String,
    val image: String,
    val fullname: String,
    val firstname: String? = null,
    val bio: String? = null,
    val counts: UserCounts? = null,
    val settings: UserSettings? = null
)

// Updated response model to handle both success and error
@Serializable
data class LoginResponse(
    val status: String? = null,
    val isLoged: Boolean = false,
    val plus: PlusInfo? = null,
    val data: SessionUser? = null,
    // Error fields
    val error: String? = null,
    val type: String? = null,
    val message: String? = null
) {
    fun isSuccess(): Boolean = isLoged && error == null
    fun isError(): Boolean = error != null
}

data class AuthState(
    val isAuthenticated: Boolean = false,
    val userId: String? = null,
    val userName: String? = null,
    val authToken: String? = null
)


==== commonMain\kotlin\me\onvo\onvo\domain\model\PasswordReset.kt ====
// File: commonMain/kotlin/me/onvo/onvo/domain/model/PasswordReset.kt
package me.onvo.onvo.domain.model

import kotlinx.serialization.Serializable

@Serializable
data class PasswordResetRequest(
    val id: String
)

@Serializable
data class PasswordResetCodeResponse(
    val alert: Boolean? = null,
    val code: Int? = null,
    val status: String? = null,
    val type: String? = null,
    val message: String? = null,
    // Error fields
    val error: String? = null
) {
    fun isSuccess(): Boolean = status == "success" && error == null
    fun isError(): Boolean = error != null
}

@Serializable
data class PasswordResetCodeSubmit(
    val code: String
)

@Serializable
data class PasswordResetCodeVerifyResponse(
    val status: String? = null,
    val error: String? = null,
    val type: String? = null,
    val message: String? = null
) {
    fun isSuccess(): Boolean = status == "success" && error == null
    fun isError(): Boolean = error != null
}

@Serializable
data class PasswordChangeRequest(
    val password: String
)

@Serializable
data class PasswordChangeResponse(
    val status: String? = null,
    val isLoged: Boolean = false,
    val plus: PlusInfo? = null,
    val data: SessionUser? = null,
    val error: String? = null
) {
    fun isSuccess(): Boolean = isLoged && error == null
    fun isError(): Boolean = error != null
}

sealed class PasswordResetUiState {
    data object Initial : PasswordResetUiState()
    data object Loading : PasswordResetUiState()
    data class CodeSent(val message: String) : PasswordResetUiState()
    data object CodeVerified : PasswordResetUiState()
    data class PasswordChanged(val userName: String) : PasswordResetUiState()
    data class Error(val message: String, val type: ErrorType = ErrorType.GENERAL) : PasswordResetUiState()

    enum class ErrorType {
        GENERAL,
        NO_EMAIL,
        INVALID_CODE,
        USER_NOT_FOUND
    }
}


==== commonMain\kotlin\me\onvo\onvo\domain\model\Profile.kt ====
// File: commonMain/kotlin/me/onvo/onvo/domain/model/Profile.kt
package me.onvo.onvo.domain.model

import kotlinx.serialization.SerialName
import kotlinx.serialization.Serializable

// ========== Auth Status Response (Simple Profile) ==========
@Serializable
data class AuthStatusResponse(
    val status: String,
    val isLoged: Boolean,
    val plus: PlusInfo,
    val data: AuthUserData
)

@Serializable
data class AuthUserData(
    val id: Int,
    @SerialName("session_id") val sessionId: String,
    val username: String,
    val image: String,
    val fullname: String,
    val firstname: String,
    val bio: String,
    val counts: UserCounts,
    val settings: UserSettings
)

// ========== Full User Profile Response ==========
@Serializable
data class UserProfileResponse(
    val user: UserProfile,
    val links: List<UserLink> = emptyList()
)

@Serializable
data class UserProfile(
    val statue: String? = null,
    val id: Int,
    val usnm: String,
    val username: String,
    val fnme: String,
    val fullname: String,
    val firstname: String,
    val img: String,
    val image: String,
    val bio: String,
    val lnks: List<UserLink> = emptyList(),
    val cnt: UserProfileCounts,
    val vrfy: String,
    @SerialName("is_verified") val isVerified: Boolean,
    val charms: String,
    val flw: String,
    val followed: Boolean,
    @SerialName("followed_back") val followedBack: Boolean,
    val mute: Int,
    val muted: Int,
    val tmp: String,
    val holder: String,
    val story: String? = null
)

@Serializable
data class UserProfileCounts(
    val colls: String,
    val msg: String,
    val likes: String,
    val views: String,
    val followers: String,
    val following: String
)

@Serializable
data class UserLink(
    val t: String,
    val type: String,
    val d: String,  // display text
    val url: String
) {
    // Helper to get icon based on type
    val linkType: LinkType
        get() = when (type.lowercase()) {
            "ln" -> LinkType.LINKEDIN
            "wa" -> LinkType.WHATSAPP
            "sp" -> LinkType.SPOTIFY
            "sc" -> LinkType.SNAPCHAT
            "ig" -> LinkType.INSTAGRAM
            "rd" -> LinkType.REDDIT
            "sn" -> LinkType.SOUND_CLOUD
            "pt" -> LinkType.PINTEREST
            "gh" -> LinkType.GITHUB
            "tw" -> LinkType.TWITTER
            "gm" -> LinkType.GMAIL
            "bh" -> LinkType.BEHANCE
            "yt" -> LinkType.YOUTUBE
            "tk" -> LinkType.TIKTOK
            "an" -> LinkType.ANIME
            "fb" -> LinkType.FACEBOOK
            else -> LinkType.OTHER
        }
}

enum class LinkType(val displayName: String) {
    LINKEDIN("LinkedIn"),
    WHATSAPP("WhatsApp"),
    SPOTIFY("Spotify"),
    SNAPCHAT("Snapchat"),
    INSTAGRAM("Instagram"),
    REDDIT("Reddit"),
    SOUND_CLOUD("SoundCloud"),
    PINTEREST("Pinterest"),
    GITHUB("GitHub"),
    TWITTER("Twitter"),
    GMAIL("Gmail"),
    BEHANCE("Behance"),
    YOUTUBE("YouTube"),
    TIKTOK("TikTok"),
    ANIME("Anime"),
    FACEBOOK("Facebook"),
    OTHER("Link")
}

// ========== UI State Models ==========
sealed class ProfileUiState {
    data object Loading : ProfileUiState()
    data class Success(val profile: UserProfile) : ProfileUiState()
    data class Error(val message: String) : ProfileUiState()
}

sealed class AuthStatusUiState {
    data object Loading : AuthStatusUiState()
    data class Success(val user: AuthUserData) : AuthStatusUiState()
    data class Error(val message: String) : AuthStatusUiState()
}


==== commonMain\kotlin\me\onvo\onvo\domain\model\Source.kt ====
package me.onvo.onvo.domain.model


import kotlinx.serialization.KSerializer
import kotlinx.serialization.Serializable
import kotlinx.serialization.SerializationException
import kotlinx.serialization.descriptors.SerialDescriptor
import kotlinx.serialization.descriptors.buildClassSerialDescriptor
import kotlinx.serialization.encoding.Decoder
import kotlinx.serialization.encoding.Encoder
import kotlinx.serialization.json.JsonDecoder
import kotlinx.serialization.json.JsonEncoder
import kotlinx.serialization.json.JsonObject
import kotlinx.serialization.json.JsonPrimitive
import kotlinx.serialization.json.booleanOrNull
import kotlinx.serialization.json.contentOrNull
import kotlinx.serialization.json.jsonObject
import kotlinx.serialization.json.jsonPrimitive

@Serializable(with = Source.Serializer::class)
data class Source(
    val name: String,
    val api: String,
    val baseUrl: String,
    val baseVersion: Int,
    val state: SourceState,
    val imageBaseUrl: String,
    val imageUrlVersion: Int,
    val shouldDelete: Boolean,

    ) {
    object Serializer : KSerializer<Source> {
        override val descriptor: SerialDescriptor =
            buildClassSerialDescriptor("Source")

        override fun deserialize(decoder: Decoder): Source {
            val jsonDecoder = decoder as? JsonDecoder
                ?: throw SerializationException("This serializer can be used only with Json")
            val element = jsonDecoder.decodeJsonElement()
            val obj = element.jsonObject

            fun JsonObject.getString(key: String, default: String = ""): String =
                this[key]?.jsonPrimitive?.content ?: default

            fun JsonObject.getInt(key: String, default: Int = 0): Int =
                this[key]?.jsonPrimitive?.content?.toIntOrNull() ?: default

            fun JsonObject.getBoolean(key: String, default: Boolean = false): Boolean {
                val el = this[key] ?: return default
                val prim = el.jsonPrimitive
                // Prefer real boolean if present
                prim.booleanOrNull?.let { return it }
                // Otherwise try parsing textual content
                prim.contentOrNull?.let { text ->
                    return when {
                        text.equals("true", ignoreCase = true) -> true
                        text.equals("false", ignoreCase = true) -> false
                        text == "1" -> true
                        text == "0" -> false
                        else -> default
                    }
                }
                return default
            }
            // Resolve state: prefer "state" string, fallback to "isWorking" boolean for backward compatibility
            val state: SourceState = when {
                obj.containsKey("state") -> {
                    val raw = obj["state"]?.jsonPrimitive?.contentOrNull?.trim()?.uppercase()
                    try {
                        if (!raw.isNullOrEmpty()) SourceState.valueOf(raw) else SourceState.STOPPED
                    } catch (e: Exception) {
                        // unknown value -> STOPPED as safe default
                        SourceState.STOPPED
                    }
                }
                obj.containsKey("isWorking") -> {
                    val isWorkingRaw = obj["isWorking"]?.jsonPrimitive?.contentOrNull?.trim()
                    val isWorking = isWorkingRaw?.equals("true", ignoreCase = true) == true
                    if (isWorking) SourceState.WORKING else SourceState.STOPPED
                }
                else -> {
                    // no info -> choose a safe default (STOPPED)
                    SourceState.STOPPED
                }
            }

            return Source(
                name = obj.getString("name"),
                api = obj.getString("api"),
                baseUrl = obj.getString("baseUrl"),
                baseVersion = obj.getInt("baseVersion"),
                state = state,
                imageBaseUrl = obj.getString("imageBaseUrl"),
                imageUrlVersion = obj.getInt("imageUrlVersion"),
                shouldDelete = obj.getBoolean("delate")
            )
        }

        override fun serialize(encoder: Encoder, value: Source) {
            val jsonEncoder = encoder as? JsonEncoder
                ?: throw SerializationException("This serializer can be used only with Json")

            // We write the new "state" string (not the old boolean)
            val jo = buildMap {
                put("name", JsonPrimitive(value.name))
                put("api", JsonPrimitive(value.api))
                put("baseUrl", JsonPrimitive(value.baseUrl))
                put("baseVersion", JsonPrimitive(value.baseVersion))
                put("state", JsonPrimitive(value.state.name))
                put("imageBaseUrl", JsonPrimitive(value.imageBaseUrl))
                put("imageUrlVersion", JsonPrimitive(value.imageUrlVersion))
            }
            jsonEncoder.encodeJsonElement(JsonObject(jo))
        }
    }
}



==== commonMain\kotlin\me\onvo\onvo\domain\model\SourceState.kt ====
package me.onvo.onvo.domain.model

import kotlinx.serialization.Serializable


@Serializable
enum class SourceState {
    WORKING,
    UNDER_MAINTENANCE,
    STOPPED
}


==== commonMain\kotlin\me\onvo\onvo\domain\repository\AuthRepository.kt ====
package me.onvo.onvo.domain.repository

import me.onvo.onvo.domain.model.CheckInputResponse
import me.onvo.onvo.domain.model.DeviceInfo
import me.onvo.onvo.domain.model.LoginResponse
import me.onvo.onvo.domain.model.TokenResponse
import me.onvo.onvo.core.util.State

interface AuthRepository {
    suspend fun getToken(deviceInfo: DeviceInfo): State<TokenResponse>
    suspend fun checkInput(input: String, token: String): State<CheckInputResponse>
    suspend fun login(id: String, password: String, token: String): State<LoginResponse>
    suspend fun logout(token: String): State<Unit>

    // Local storage methods
    suspend fun saveAuthToken(token: String)
    suspend fun getAuthToken(): String?
    suspend fun clearAuthToken()

    suspend fun saveUserSession(userId: String, userName: String)
    suspend fun getUserSession(): Pair<String?, String?>
    suspend fun clearUserSession()
}


==== commonMain\kotlin\me\onvo\onvo\domain\repository\ItemsRepository.kt ====
package me.onvo.onvo.domain.repository

import me.onvo.onvo.domain.model.Source

interface ItemsRepository {
    suspend fun getItems(): List<Source>
}


==== commonMain\kotlin\me\onvo\onvo\domain\repository\PasswordResetRepository.kt ====
// File: commonMain/kotlin/me/onvo/onvo/domain/repository/PasswordResetRepository.kt
package me.onvo.onvo.domain.repository

import me.onvo.onvo.core.util.State
import me.onvo.onvo.domain.model.*

interface PasswordResetRepository {
    suspend fun requestResetCode(userId: String, token: String): State<PasswordResetCodeResponse>
    suspend fun submitResetCode(code: String, token: String): State<PasswordResetCodeVerifyResponse>
    suspend fun changePassword(newPassword: String, token: String): State<PasswordChangeResponse>
}




==== commonMain\kotlin\me\onvo\onvo\domain\repository\ProfileRepository.kt ====
package me.onvo.onvo.domain.repository

import me.onvo.onvo.core.util.State
import me.onvo.onvo.domain.model.AuthUserData
import me.onvo.onvo.domain.model.UserProfile

interface ProfileRepository {
    suspend fun getCurrentUserStatus(): State<AuthUserData>
    suspend fun getUserProfile(userId: Int): State<UserProfile>
    suspend fun clearSession()
}


==== commonMain\kotlin\me\onvo\onvo\domain\usecase\auth\CheckInputUseCase.kt ====
package me.onvo.onvo.domain.usecase.auth

import me.onvo.onvo.core.util.State
import me.onvo.onvo.domain.model.CheckInputResponse
import me.onvo.onvo.domain.repository.AuthRepository

class CheckInputUseCase(
    private val authRepository: AuthRepository
) {
    suspend operator fun invoke(input: String): State<CheckInputResponse> {
        if (input.isBlank()) {
            return State.Error(
                IllegalArgumentException("Input cannot be empty"),
                "Please enter your email, username, or phone number"
            )
        }

        val token = authRepository.getAuthToken()
            ?: return State.Error(
                IllegalStateException("No auth token"),
                "Please restart the app"
            )

        return authRepository.checkInput(input.trim(), token)
    }
}


==== commonMain\kotlin\me\onvo\onvo\domain\usecase\auth\GetTokenUseCase.kt ====
package me.onvo.onvo.domain.usecase.auth

import me.onvo.onvo.core.device.DeviceInfoProvider
import me.onvo.onvo.core.util.State
import me.onvo.onvo.domain.model.TokenResponse
import me.onvo.onvo.domain.repository.AuthRepository

class GetTokenUseCase(
    private val authRepository: AuthRepository,
    private val deviceInfoProvider: DeviceInfoProvider
) {
    suspend operator fun invoke(): State<TokenResponse> {
        val deviceInfo = deviceInfoProvider.getDeviceInfo()
        return when (val result = authRepository.getToken(deviceInfo)) {
            is State.Success -> {
                // Save token for future use
                authRepository.saveAuthToken(result.data.token)
                result
            }
            is State.Error -> result
            is State.Loading -> result
        }
    }
}


==== commonMain\kotlin\me\onvo\onvo\domain\usecase\auth\GetUserSessionUseCase.kt ====
package me.onvo.onvo.domain.usecase.auth

import me.onvo.onvo.domain.model.AuthState
import me.onvo.onvo.domain.repository.AuthRepository

class GetUserSessionUseCase(
    private val authRepository: AuthRepository
) {
    suspend operator fun invoke(): AuthState {
        val (userId, userName) = authRepository.getUserSession()
        val authToken = authRepository.getAuthToken()

        return AuthState(
            isAuthenticated = userId != null && authToken != null,
            userId = userId,
            userName = userName,
            authToken = authToken
        )
    }
}


==== commonMain\kotlin\me\onvo\onvo\domain\usecase\auth\LoginUseCase.kt ====
package me.onvo.onvo.domain.usecase.auth

import me.onvo.onvo.core.util.CryptoUtil
import me.onvo.onvo.core.util.State
import me.onvo.onvo.domain.model.LoginResponse
import me.onvo.onvo.domain.repository.AuthRepository

class LoginUseCase(
    private val authRepository: AuthRepository
) {
    suspend operator fun invoke(id: String, password: String): State<LoginResponse> {
        if (id.isBlank() || password.isBlank()) {
            return State.Error(
                IllegalArgumentException("Invalid credentials"),
                "ID and password cannot be empty"
            )
        }

        val token = authRepository.getAuthToken()
            ?: return State.Error(
                IllegalStateException("No auth token"),
                "Please restart the app"
            )

        // Encrypt password with MD5
        val encryptedPassword = CryptoUtil.md5(password)

        return when (val result = authRepository.login(id, encryptedPassword, token)) {
            is State.Success -> {
                if (result.data.isLoged) {
                    // Save user session
                    result.data.data?.id?.let { userId ->
                        result.data.data.username.let { userName ->
                            authRepository.saveUserSession(userId.toString(), userName.toString())
                        }
                    }
                }
                result
            }
            is State.Error -> result
            is State.Loading -> result
        }
    }
}


==== commonMain\kotlin\me\onvo\onvo\domain\usecase\auth\LogoutUseCase.kt ====
package me.onvo.onvo.domain.usecase.auth

import me.onvo.onvo.domain.repository.AuthRepository
import me.onvo.onvo.core.util.State


class LogoutUseCase(
    private val authRepository: AuthRepository
) {
    suspend operator fun invoke(): State<Unit> {
        val token = authRepository.getAuthToken()
            ?: return State.Error(
                IllegalStateException("No auth token"),
                "Already logged out"
            )

        return when (val result = authRepository.logout(token)) {
            is State.Success -> {
                // Clear local session
                authRepository.clearUserSession()
                result
            }
            is State.Error -> {
                // Clear local session even if API call fails
                authRepository.clearUserSession()
                result
            }
            is State.Loading -> result
        }
    }
}


==== commonMain\kotlin\me\onvo\onvo\domain\usecase\GetSourcesUseCase.kt ====
package me.onvo.onvo.domain.usecase

//import dev.zacsweers.metro.Inject
import me.onvo.onvo.domain.model.Source
import me.onvo.onvo.domain.repository.ItemsRepository

//@Inject
class GetSourcesUseCase(
    private val repository: ItemsRepository
) {
    suspend operator fun invoke(): Result<List<Source>> {
        return try {
            val sources = repository.getItems()
            Result.success(sources)
        } catch (e: Exception) {
            Result.failure(e)
        }
    }
}


==== commonMain\kotlin\me\onvo\onvo\domain\usecase\passwordreset\ChangePasswordUseCase.kt ====
package me.onvo.onvo.domain.usecase.passwordreset


import me.onvo.onvo.core.util.CryptoUtil
import me.onvo.onvo.core.util.State
import me.onvo.onvo.domain.model.PasswordChangeResponse
import me.onvo.onvo.domain.repository.AuthRepository
import me.onvo.onvo.domain.repository.PasswordResetRepository

class ChangePasswordUseCase(
    private val passwordResetRepository: PasswordResetRepository,
    private val authRepository: AuthRepository
) {
    suspend operator fun invoke(newPassword: String): State<PasswordChangeResponse> {
        if (newPassword.isBlank() || newPassword.length < 6) {
            return State.Error(
                IllegalArgumentException("Invalid password"),
                "Password must be at least 6 characters"
            )
        }

        val token = authRepository.getAuthToken()
            ?: return State.Error(
                IllegalStateException("No auth token"),
                "Please restart the app"
            )

        // Encrypt password with MD5
        val encryptedPassword = CryptoUtil.md5(newPassword)

        return when (val result = passwordResetRepository.changePassword(encryptedPassword, token)) {
            is State.Success -> {
                // Update user session with new credentials
                result.data.data?.let { user ->
                    authRepository.saveUserSession(
                        userId = user.id.toString(),
                        userName = user.username
                    )
                }
                result
            }
            is State.Error -> result
            is State.Loading -> result
        }
    }
}


==== commonMain\kotlin\me\onvo\onvo\domain\usecase\passwordreset\RequestResetCodeUseCase.kt ====
package me.onvo.onvo.domain.usecase.passwordreset

import me.onvo.onvo.core.util.State
import me.onvo.onvo.domain.model.PasswordResetCodeResponse
import me.onvo.onvo.domain.repository.AuthRepository
import me.onvo.onvo.domain.repository.PasswordResetRepository

class RequestResetCodeUseCase(
    private val passwordResetRepository: PasswordResetRepository,
    private val authRepository: AuthRepository
) {
    suspend operator fun invoke(userId: String): State<PasswordResetCodeResponse> {
        if (userId.isBlank()) {
            return State.Error(
                IllegalArgumentException("User ID cannot be empty"),
                "Please enter a valid user ID"
            )
        }

        val token = authRepository.getAuthToken()
            ?: return State.Error(
                IllegalStateException("No auth token"),
                "Please restart the app"
            )

        return passwordResetRepository.requestResetCode(userId.trim(), token)
    }
}


==== commonMain\kotlin\me\onvo\onvo\domain\usecase\passwordreset\SubmitResetCodeUseCase.kt ====
package me.onvo.onvo.domain.usecase.passwordreset

import me.onvo.onvo.core.util.State
import me.onvo.onvo.domain.model.PasswordResetCodeVerifyResponse
import me.onvo.onvo.domain.repository.AuthRepository
import me.onvo.onvo.domain.repository.PasswordResetRepository

class SubmitResetCodeUseCase(
    private val passwordResetRepository: PasswordResetRepository,
    private val authRepository: AuthRepository
) {
    suspend operator fun invoke(code: String): State<PasswordResetCodeVerifyResponse> {
        if (code.isBlank() || code.length != 6) {
            return State.Error(
                IllegalArgumentException("Invalid code"),
                "Please enter a valid 6-digit code"
            )
        }

        val token = authRepository.getAuthToken()
            ?: return State.Error(
                IllegalStateException("No auth token"),
                "Please restart the app"
            )

        return passwordResetRepository.submitResetCode(code.trim(), token)
    }
}


==== commonMain\kotlin\me\onvo\onvo\domain\usecase\profile\GetCurrentUserStatusUseCase.kt ====
package me.onvo.onvo.domain.usecase.profile

import me.onvo.onvo.core.util.State
import me.onvo.onvo.domain.model.AuthUserData
import me.onvo.onvo.domain.repository.ProfileRepository

class GetCurrentUserStatusUseCase(
    private val profileRepository: ProfileRepository
) {
    suspend operator fun invoke(): State<AuthUserData> {
        return profileRepository.getCurrentUserStatus()
    }
}


==== commonMain\kotlin\me\onvo\onvo\domain\usecase\profile\GetUserProfileUseCase.kt ====
package me.onvo.onvo.domain.usecase.profile

import me.onvo.onvo.core.util.State
import me.onvo.onvo.domain.model.UserProfile
import me.onvo.onvo.domain.repository.ProfileRepository

class GetUserProfileUseCase(
    private val profileRepository: ProfileRepository
) {
    suspend operator fun invoke(userId: Int): State<UserProfile> {
        if (userId <= 0) {
            return State.Error(
                IllegalArgumentException("Invalid user ID"),
                "Please provide a valid user ID"
            )
        }
        return profileRepository.getUserProfile(userId)
    }
}


==== commonMain\kotlin\me\onvo\onvo\Greeting.kt ====
package me.onvo.onvo

class Greeting {
    private val platform = getPlatform()

    fun greet(): String {
        return "Hello, ${platform.name}!"
    }
}


==== commonMain\kotlin\me\onvo\onvo\navigation\AppNavigation.kt ====
package me.onvo.onvo.navigation

import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.*
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.layout.ContentScale
import androidx.compose.ui.unit.dp
import androidx.navigation.NavHostController
import androidx.navigation.compose.NavHost
import androidx.navigation.compose.composable
import androidx.navigation.compose.currentBackStackEntryAsState
import androidx.navigation.compose.rememberNavController
import androidx.navigation.toRoute
import coil3.compose.AsyncImage
import me.onvo.onvo.presentation.ui.LoginScreen
import me.onvo.onvo.presentation.ui.PasswordResetScreen
import me.onvo.onvo.presentation.ui.ProfileScreen
import me.onvo.onvo.presentation.ui.SourcesScreen
import me.onvo.onvo.presentation.viewmodel.AuthViewModel
import me.onvo.onvo.presentation.viewmodel.PasswordResetViewModel
import me.onvo.onvo.presentation.viewmodel.SourcesViewModel
import me.onvo.onvo.test.*
import me.onvo.onvo.theme.ThemeViewModel
import org.koin.compose.koinInject

@Composable
fun AppNavigation(
    authViewModel: AuthViewModel = koinInject(),
    passwordResetViewModel: PasswordResetViewModel = koinInject(),
    themeViewModel: ThemeViewModel,
    modifier: Modifier = Modifier
) {
    val navController = rememberNavController()
    val sourcesViewModel: SourcesViewModel = koinInject()

    val isUserLoggedIn by authViewModel.isLoggedIn.collectAsState()
    val authState by authViewModel.authState.collectAsState()
    val currentUser by authViewModel.currentUser.collectAsState()
    val isInitialized by authViewModel.isInitialized.collectAsState()

    // Monitor password reset login state
    val isPasswordResetLoggedIn by passwordResetViewModel.isLoggedIn.collectAsState()

    // Show loading screen while initializing
    if (!isInitialized) {
        Box(
            modifier = Modifier.fillMaxSize(),
            contentAlignment = Alignment.Center
        ) {
            Column(
                horizontalAlignment = Alignment.CenterHorizontally,
                verticalArrangement = Arrangement.spacedBy(16.dp)
            ) {
                CircularProgressIndicator()
                Text(
                    text = "Initializing...",
                    style = MaterialTheme.typography.bodyMedium
                )
            }
        }
        return
    }

    // Determine start destination
    val startDestination = if (isUserLoggedIn) Screen.Home else Screen.Login

    Scaffold(
        bottomBar = {
            if (isUserLoggedIn) {
                BottomNavigationBar(
                    navController = navController,
                    currentUserImage = currentUser?.image
                )
            }
        },
        floatingActionButton = {
            if (isUserLoggedIn && shouldShowFab(navController)) {
                FloatingActionButton(
                    onClick = { navController.navigate(Screen.CreatePost) }
                ) {
                    Icon(Icons.Default.Add, contentDescription = "Create Post")
                }
            }
        }
    ) { paddingValues ->
        NavHost(
            navController = navController,
            startDestination = startDestination,
            modifier = modifier.padding(paddingValues)
        ) {
            // Login Screen
            composable<Screen.Login> {
                LoginScreen(
                    viewModel = authViewModel,
                    onLoginSuccess = {
                        navController.navigate(Screen.Home) {
                            popUpTo(Screen.Login) { inclusive = true }
                        }
                    },
                    onForgotPassword = {
                        passwordResetViewModel.reset()
                        navController.navigate(Screen.ForgotPassword)
                    }
                )
            }

            // Forgot Password Screen
            composable<Screen.ForgotPassword> {
                PasswordResetScreen(
                    viewModel = passwordResetViewModel,
                    onBackClick = {
                        passwordResetViewModel.reset()
                        navController.navigateUp()
                    },
                    onPasswordChanged = { isFromSettings ->
                        if (!isFromSettings && isPasswordResetLoggedIn) {
                            authViewModel.refreshSession()
                            navController.navigate(Screen.Home) {
                                popUpTo(0) { inclusive = true }
                            }
                        } else {
                            passwordResetViewModel.reset()
                            navController.navigate(Screen.Login) {
                                popUpTo(0) { inclusive = true }
                            }
                        }
                    },
                    isFromSettings = false,
                    prefilledUserId = null
                )
            }

            // Change Password Screen
            composable<Screen.ChangePassword> {
                LaunchedEffect(Unit) {
                    passwordResetViewModel.reset()
                }

                PasswordResetScreen(
                    viewModel = passwordResetViewModel,
                    onBackClick = {
                        passwordResetViewModel.reset()
                        navController.navigateUp()
                    },
                    onPasswordChanged = { isFromSettings ->
                        if (isFromSettings) {
                            passwordResetViewModel.reset()
                            navController.navigateUp()
                        }
                    },
                    isFromSettings = true,
                    prefilledUserId = authState.userId
                )
            }

            // Home Screen
            composable<Screen.Home> {
                SourcesScreen(sourcesViewModel)
            }

            // Search Screen
            composable<Screen.Search> {
                SearchScreen(
                    onUserClick = { userId ->
                        navController.navigate(Screen.UserProfile(userId))
                    }
                )
            }

            // Discovery Screen
            composable<Screen.Discovery> {
                DiscoveryScreen(
                    onUserClick = { userId ->
                        navController.navigate(Screen.UserProfile(userId))
                    }
                )
            }

            // Profile Screen (Current User)
            composable<Screen.Profile> {
                ProfileScreen()
            }

            // Settings Screen
            composable<Screen.Settings> {
                SettingsScreen(
                    themeViewModel = themeViewModel,
                    onSettingClick = { settingType ->
                        navController.navigate(Screen.SettingsDetail(settingType))
                    },
                    onChangePassword = {
                        navController.navigate(Screen.ChangePassword)
                    },
                    onLogout = {
                        authViewModel.logout()
                        navController.navigate(Screen.Login) {
                            popUpTo(0) { inclusive = true }
                        }
                    }
                )
            }

            // User Profile Screen
            composable<Screen.UserProfile> { backStackEntry ->
                val userProfile: Screen.UserProfile = backStackEntry.toRoute()
                UserProfileScreen(
                    userId = userProfile.userId,
                    onBackClick = { navController.navigateUp() }
                )
            }

            // Settings Detail Screen
            composable<Screen.SettingsDetail> { backStackEntry ->
                val settingsDetail: Screen.SettingsDetail = backStackEntry.toRoute()
                SettingsDetailScreen(
                    settingType = settingsDetail.settingType,
                    onBackClick = { navController.navigateUp() }
                )
            }

            // Create Post Screen
            composable<Screen.CreatePost> {
                CreatePostScreen(
                    onPostCreated = { navController.navigateUp() },
                    onBackClick = { navController.navigateUp() }
                )
            }
        }
    }
}

@Composable
private fun shouldShowFab(navController: NavHostController): Boolean {
    val currentRoute = navController.currentBackStackEntryAsState().value?.destination?.route
    return currentRoute?.contains("Home") == true
}

@Composable
private fun BottomNavigationBar(
    navController: NavHostController,
    currentUserImage: String?
) {
    val items = listOf(
        BottomNavItem("Home", Icons.Default.Home, Screen.Home, false),
        BottomNavItem("Search", Icons.Default.Search, Screen.Search, false),
        BottomNavItem("Discovery", Icons.Default.LocationOn, Screen.Discovery, false),
        BottomNavItem("Profile", Icons.Default.Person, Screen.Profile, true), // Use image
        BottomNavItem("Settings", Icons.Default.Settings, Screen.Settings, false)
    )

    NavigationBar {
        val navBackStackEntry by navController.currentBackStackEntryAsState()
        val currentRoute = navBackStackEntry?.destination?.route

        items.forEach { item ->
            NavigationBarItem(
                icon = {
                    if (item.useProfileImage && !currentUserImage.isNullOrEmpty()) {
                        // Show user profile image
                        AsyncImage(
                            model = currentUserImage,
                            contentDescription = item.label,
                            modifier = Modifier
                                .size(24.dp)
                                .clip(CircleShape),
                            contentScale = ContentScale.Crop
                        )
                    } else {
                        // Show regular icon
                        Icon(item.icon, contentDescription = item.label)
                    }
                },
                label = { Text(item.label) },
                selected = currentRoute?.contains(item.screen::class.simpleName ?: "") == true,
                onClick = {
                    navController.navigate(item.screen) {
                        popUpTo(Screen.Home) { saveState = true }
                        launchSingleTop = true
                        restoreState = true
                    }
                }
            )
        }
    }
}

private data class BottomNavItem(
    val label: String,
    val icon: androidx.compose.ui.graphics.vector.ImageVector,
    val screen: Screen,
    val useProfileImage: Boolean = false
)


==== commonMain\kotlin\me\onvo\onvo\navigation\Screen.kt ====
// File: commonMain/kotlin/me/onvo/onvo/navigation/Screen.kt
package me.onvo.onvo.navigation

import kotlinx.serialization.Serializable

// Sealed interface for type-safe navigation
sealed interface Screen {
    @Serializable
    data object Login : Screen

    @Serializable
    data object ForgotPassword : Screen

    @Serializable
    data object ChangePassword : Screen

    @Serializable
    data object Home : Screen

    @Serializable
    data object Search : Screen

    @Serializable
    data object Discovery : Screen

    @Serializable
    data object Profile : Screen

    @Serializable
    data object Settings : Screen

    @Serializable
    data class UserProfile(val userId: String) : Screen

    @Serializable
    data class SettingsDetail(val settingType: String) : Screen

    @Serializable
    data object CreatePost : Screen
}


==== commonMain\kotlin\me\onvo\onvo\Platform.kt ====
package me.onvo.onvo

interface Platform {
    val name: String
}

expect fun getPlatform(): Platform


==== commonMain\kotlin\me\onvo\onvo\presentation\asdas.kt ====
package me.onvo.onvo.presentation

object asdas {
}


==== commonMain\kotlin\me\onvo\onvo\presentation\AuthUiState.kt ====
package me.onvo.onvo.presentation

sealed class AuthUiState {
    data object Initial : AuthUiState()
    data object Loading : AuthUiState()
    data class CheckInputSuccess(
        val id: String,
        val type: String,
        val imageUrl: String? = null,
        val fullName: String? = null
    ) : AuthUiState()
    data class LoginSuccess(val userName: String) : AuthUiState()
    data class Error(val message: String) : AuthUiState()
}


==== commonMain\kotlin\me\onvo\onvo\presentation\ui\LoginScreen.kt ====
// File: commonMain/kotlin/me/onvo/onvo/presentation/ui/LoginScreen.kt
package me.onvo.onvo.presentation.ui

import androidx.compose.animation.*
import androidx.compose.animation.core.*
import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.rememberScrollState
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.foundation.text.KeyboardActions
import androidx.compose.foundation.text.KeyboardOptions
import androidx.compose.foundation.verticalScroll
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.*
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.draw.shadow
import androidx.compose.ui.graphics.Brush
import androidx.compose.ui.graphics.graphicsLayer
import androidx.compose.ui.layout.ContentScale
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.text.input.ImeAction
import androidx.compose.ui.text.input.KeyboardType
import androidx.compose.ui.text.input.PasswordVisualTransformation
import androidx.compose.ui.text.input.VisualTransformation
import androidx.compose.ui.text.style.TextAlign
import androidx.compose.ui.unit.dp
import coil3.compose.AsyncImage
import me.onvo.onvo.presentation.AuthUiState
import me.onvo.onvo.presentation.viewmodel.AuthViewModel
import org.koin.compose.koinInject

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun LoginScreen(
    viewModel: AuthViewModel = koinInject(),
    onLoginSuccess: () -> Unit,
    onForgotPassword: () -> Unit = {}
) {
    var inputValue by remember { mutableStateOf("") }
    var password by remember { mutableStateOf("") }
    var passwordVisible by remember { mutableStateOf(false) }
    var verifiedId by remember { mutableStateOf<String?>(null) }
    var userImageUrl by remember { mutableStateOf<String?>(null) }
    var userFullName by remember { mutableStateOf<String?>(null) }
    var inputType by remember { mutableStateOf("") }

    val uiState by viewModel.uiState.collectAsState()
    val scrollState = rememberScrollState()

    // Handle login success
    LaunchedEffect(uiState) {
        if (uiState is AuthUiState.LoginSuccess) {
            onLoginSuccess()
        }
    }

    // Handle successful input verification
    LaunchedEffect(uiState) {
        if (uiState is AuthUiState.CheckInputSuccess) {
            val state = uiState as AuthUiState.CheckInputSuccess
            verifiedId = state.id
            inputType = state.type
            userImageUrl = state.imageUrl
            userFullName = state.fullName
        }
    }

    Box(
        modifier = Modifier
            .fillMaxSize()
            .background(
                Brush.verticalGradient(
                    colors = listOf(
                        MaterialTheme.colorScheme.primary.copy(alpha = 0.1f),
                        MaterialTheme.colorScheme.surface
                    )
                )
            )
    ) {
        Column(
            modifier = Modifier
                .fillMaxSize()
                .verticalScroll(scrollState)
                .padding(24.dp),
            horizontalAlignment = Alignment.CenterHorizontally,
            verticalArrangement = Arrangement.Center
        ) {
            Spacer(modifier = Modifier.height(40.dp))

            // App Logo/Title with animation
            AnimatedAppLogo()

            Spacer(modifier = Modifier.height(48.dp))

            // Main Card
            Card(
                modifier = Modifier
                    .fillMaxWidth()
                    .shadow(8.dp, RoundedCornerShape(24.dp)),
                shape = RoundedCornerShape(24.dp),
                colors = CardDefaults.cardColors(
                    containerColor = MaterialTheme.colorScheme.surface
                )
            ) {
                Column(
                    modifier = Modifier
                        .fillMaxWidth()
                        .padding(24.dp),
                    horizontalAlignment = Alignment.CenterHorizontally
                ) {
                    // User Avatar (shown after verification)
                    AnimatedVisibility(
                        visible = verifiedId != null && userImageUrl != null,
                        enter = fadeIn() + expandVertically() + scaleIn(),
                        exit = fadeOut() + shrinkVertically() + scaleOut()
                    ) {
                        Column(
                            horizontalAlignment = Alignment.CenterHorizontally,
                            modifier = Modifier.padding(bottom = 24.dp)
                        ) {
                            AsyncImage(
                                model = userImageUrl,
                                contentDescription = "User Avatar",
                                modifier = Modifier
                                    .size(100.dp)
                                    .clip(CircleShape)
                                    .background(MaterialTheme.colorScheme.primaryContainer),
                                contentScale = ContentScale.Crop
                            )

                            Spacer(modifier = Modifier.height(12.dp))

                            Text(
                                text = userFullName ?: "Welcome",
                                style = MaterialTheme.typography.titleLarge,
                                fontWeight = FontWeight.Bold,
                                color = MaterialTheme.colorScheme.onSurface
                            )

                            if (inputType.isNotEmpty()) {
                                Text(
                                    text = inputType,
                                    style = MaterialTheme.typography.bodyMedium,
                                    color = MaterialTheme.colorScheme.onSurfaceVariant
                                )
                            }
                        }
                    }

                    // Welcome Text (shown initially)
                    AnimatedVisibility(
                        visible = verifiedId == null,
                        enter = fadeIn(),
                        exit = fadeOut()
                    ) {
                        Column(
                            horizontalAlignment = Alignment.CenterHorizontally,
                            modifier = Modifier.padding(bottom = 24.dp)
                        ) {
                            Text(
                                text = "Welcome Back!",
                                style = MaterialTheme.typography.headlineMedium,
                                fontWeight = FontWeight.Bold,
                                color = MaterialTheme.colorScheme.onSurface
                            )
                            Spacer(modifier = Modifier.height(8.dp))
                            Text(
                                text = "Sign in to continue",
                                style = MaterialTheme.typography.bodyLarge,
                                color = MaterialTheme.colorScheme.onSurfaceVariant
                            )
                        }
                    }

                    Spacer(modifier = Modifier.height(8.dp))

                    // Input Field (Email/Username/Phone)
                    OutlinedTextField(
                        value = inputValue,
                        onValueChange = {
                            inputValue = it
                            if (verifiedId != null) {
                                verifiedId = null
                                userImageUrl = null
                                userFullName = null
                                password = ""
                                viewModel.resetUiState()
                            }
                        },
                        label = { Text("Email, Username, or Phone") },
                        leadingIcon = {
                            Icon(
                                Icons.Default.Person,
                                contentDescription = null,
                                tint = MaterialTheme.colorScheme.primary
                            )
                        },
                        trailingIcon = {
                            when (uiState) {
                                is AuthUiState.CheckInputSuccess -> {
                                    Icon(
                                        Icons.Default.CheckCircle,
                                        contentDescription = "Verified",
                                        tint = MaterialTheme.colorScheme.primary
                                    )
                                }
                                is AuthUiState.Loading -> {
                                    if (verifiedId == null) {
                                        CircularProgressIndicator(
                                            modifier = Modifier.size(24.dp),
                                            strokeWidth = 2.dp
                                        )
                                    }
                                }
                                else -> {}
                            }
                        },
                        modifier = Modifier.fillMaxWidth(),
                        singleLine = true,
                        enabled = verifiedId == null && uiState !is AuthUiState.Loading,
                        keyboardOptions = KeyboardOptions(
                            keyboardType = KeyboardType.Text,
                            imeAction = ImeAction.Next
                        ),
                        shape = RoundedCornerShape(16.dp),
                        colors = OutlinedTextFieldDefaults.colors(
                            focusedBorderColor = MaterialTheme.colorScheme.primary,
                            unfocusedBorderColor = MaterialTheme.colorScheme.outline.copy(alpha = 0.5f)
                        ),
                        isError = uiState is AuthUiState.Error && verifiedId == null
                    )

                    // Error message for input
                    if (uiState is AuthUiState.Error && verifiedId == null) {
                        Spacer(modifier = Modifier.height(4.dp))
                        Text(
                            text = (uiState as AuthUiState.Error).message,
                            color = MaterialTheme.colorScheme.error,
                            style = MaterialTheme.typography.bodySmall,
                            modifier = Modifier.fillMaxWidth()
                        )
                    }

                    Spacer(modifier = Modifier.height(16.dp))

                    // Password Field (animated entry)
                    AnimatedVisibility(
                        visible = verifiedId != null,
                        enter = fadeIn() + expandVertically() + slideInVertically(),
                        exit = fadeOut() + shrinkVertically() + slideOutVertically()
                    ) {
                        Column {
                            OutlinedTextField(
                                value = password,
                                onValueChange = { password = it },
                                label = { Text("Password") },
                                leadingIcon = {
                                    Icon(
                                        Icons.Default.Lock,
                                        contentDescription = null,
                                        tint = MaterialTheme.colorScheme.primary
                                    )
                                },
                                trailingIcon = {
                                    Row(verticalAlignment = Alignment.CenterVertically) {
                                        if (uiState is AuthUiState.Loading) {
                                            CircularProgressIndicator(
                                                modifier = Modifier
                                                    .size(24.dp)
                                                    .padding(end = 8.dp),
                                                strokeWidth = 2.dp
                                            )
                                        }
                                        IconButton(
                                            onClick = { passwordVisible = !passwordVisible }
                                        ) {
                                            Icon(
                                                if (passwordVisible) Icons.Default.Visibility
                                                else Icons.Default.VisibilityOff,
                                                contentDescription = if (passwordVisible)
                                                    "Hide password" else "Show password",
                                                tint = MaterialTheme.colorScheme.onSurfaceVariant
                                            )
                                        }
                                    }
                                },
                                visualTransformation = if (passwordVisible)
                                    VisualTransformation.None
                                else
                                    PasswordVisualTransformation(),
                                modifier = Modifier.fillMaxWidth(),
                                singleLine = true,
                                enabled = uiState !is AuthUiState.Loading,
                                keyboardOptions = KeyboardOptions(
                                    keyboardType = KeyboardType.Password,
                                    imeAction = ImeAction.Done
                                ),
                                keyboardActions = KeyboardActions(
                                    onDone = {
                                        if (password.isNotEmpty() && verifiedId != null) {
                                            viewModel.login(verifiedId!!, password)
                                        }
                                    }
                                ),
                                shape = RoundedCornerShape(16.dp),
                                colors = OutlinedTextFieldDefaults.colors(
                                    focusedBorderColor = MaterialTheme.colorScheme.primary,
                                    unfocusedBorderColor = MaterialTheme.colorScheme.outline.copy(alpha = 0.5f)
                                ),
                                isError = uiState is AuthUiState.Error && verifiedId != null
                            )

                            // Error message for password
                            if (uiState is AuthUiState.Error && verifiedId != null) {
                                Spacer(modifier = Modifier.height(4.dp))
                                Text(
                                    text = (uiState as AuthUiState.Error).message,
                                    color = MaterialTheme.colorScheme.error,
                                    style = MaterialTheme.typography.bodySmall,
                                    modifier = Modifier.fillMaxWidth()
                                )
                            }
                        }
                    }

                    Spacer(modifier = Modifier.height(24.dp))

                    // Action Buttons
                    if (verifiedId == null) {
                        Button(
                            onClick = {
                                if (inputValue.isNotEmpty()) {
                                    viewModel.checkInput(inputValue)
                                }
                            },
                            modifier = Modifier
                                .fillMaxWidth()
                                .height(56.dp),
                            enabled = inputValue.isNotEmpty() && uiState !is AuthUiState.Loading,
                            shape = RoundedCornerShape(16.dp),
                            colors = ButtonDefaults.buttonColors(
                                containerColor = MaterialTheme.colorScheme.primary
                            )
                        ) {
                            if (uiState is AuthUiState.Loading) {
                                CircularProgressIndicator(
                                    modifier = Modifier.size(24.dp),
                                    color = MaterialTheme.colorScheme.onPrimary,
                                    strokeWidth = 2.dp
                                )
                            } else {
                                Row(
                                    horizontalArrangement = Arrangement.Center,
                                    verticalAlignment = Alignment.CenterVertically
                                ) {
                                    Text(
                                        "Continue",
                                        style = MaterialTheme.typography.titleMedium,
                                        fontWeight = FontWeight.SemiBold
                                    )
                                    Spacer(modifier = Modifier.width(8.dp))
                                    Icon(
                                        Icons.Default.ArrowForward,
                                        contentDescription = null,
                                        modifier = Modifier.size(20.dp)
                                    )
                                }
                            }
                        }
                    } else {
                        Row(
                            modifier = Modifier.fillMaxWidth(),
                            horizontalArrangement = Arrangement.spacedBy(12.dp)
                        ) {
                            OutlinedButton(
                                onClick = {
                                    verifiedId = null
                                    userImageUrl = null
                                    userFullName = null
                                    password = ""
                                    inputValue = ""
                                    viewModel.resetUiState()
                                },
                                modifier = Modifier
                                    .weight(1f)
                                    .height(56.dp),
                                enabled = uiState !is AuthUiState.Loading,
                                shape = RoundedCornerShape(16.dp)
                            ) {
                                Icon(
                                    Icons.Default.ArrowBack,
                                    contentDescription = null,
                                    modifier = Modifier.size(20.dp)
                                )
                                Spacer(modifier = Modifier.width(8.dp))
                                Text(
                                    "Change",
                                    style = MaterialTheme.typography.titleMedium
                                )
                            }

                            Button(
                                onClick = {
                                    if (password.isNotEmpty() && verifiedId != null) {
                                        viewModel.login(verifiedId!!, password)
                                    }
                                },
                                modifier = Modifier
                                    .weight(1f)
                                    .height(56.dp),
                                enabled = password.isNotEmpty() && uiState !is AuthUiState.Loading,
                                shape = RoundedCornerShape(16.dp)
                            ) {
                                if (uiState is AuthUiState.Loading) {
                                    CircularProgressIndicator(
                                        modifier = Modifier.size(24.dp),
                                        color = MaterialTheme.colorScheme.onPrimary,
                                        strokeWidth = 2.dp
                                    )
                                } else {
                                    Text(
                                        "Login",
                                        style = MaterialTheme.typography.titleMedium,
                                        fontWeight = FontWeight.SemiBold
                                    )
                                    Spacer(modifier = Modifier.width(8.dp))
                                    Icon(
                                        Icons.Default.Login,
                                        contentDescription = null,
                                        modifier = Modifier.size(20.dp)
                                    )
                                }
                            }
                        }
                    }

                    Spacer(modifier = Modifier.height(16.dp))

                    // Forgot Password Link
                    TextButton(
                        onClick = onForgotPassword,
                        enabled = uiState !is AuthUiState.Loading
                    ) {
                        Text(
                            "Forgot password?",
                            style = MaterialTheme.typography.bodyLarge,
                            color = MaterialTheme.colorScheme.primary
                        )
                    }
                }
            }

            Spacer(modifier = Modifier.height(24.dp))

            // Retry button for initialization errors
            if (uiState is AuthUiState.Error && verifiedId == null && inputValue.isEmpty()) {
                OutlinedButton(
                    onClick = { viewModel.retry() },
                    modifier = Modifier.fillMaxWidth(),
                    shape = RoundedCornerShape(16.dp)
                ) {
                    Icon(Icons.Default.Refresh, contentDescription = null)
                    Spacer(modifier = Modifier.width(8.dp))
                    Text("Retry")
                }
            }

            Spacer(modifier = Modifier.height(40.dp))
        }
    }
}

@Composable
private fun AnimatedAppLogo() {
    val infiniteTransition = rememberInfiniteTransition()
    val scale by infiniteTransition.animateFloat(
        initialValue = 0.95f,
        targetValue = 1.05f,
        animationSpec = infiniteRepeatable(
            animation = tween(2000, easing = LinearEasing),
            repeatMode = RepeatMode.Reverse
        )
    )

    Column(
        horizontalAlignment = Alignment.CenterHorizontally
    ) {
        Surface(
            modifier = Modifier
                .size(100.dp)
                .shadow(8.dp, CircleShape),
            shape = CircleShape,
            color = MaterialTheme.colorScheme.primaryContainer
        ) {
            Box(
                contentAlignment = Alignment.Center,
                modifier = Modifier.padding(20.dp)
            ) {
                Icon(
                    imageVector = Icons.Default.Lock,
                    contentDescription = null,
                    modifier = Modifier
                        .fillMaxSize()
                        .graphicsLayer(scaleX = scale, scaleY = scale),
                    tint = MaterialTheme.colorScheme.primary
                )
            }
        }

        Spacer(modifier = Modifier.height(16.dp))

        Text(
            text = "ONVO",
            style = MaterialTheme.typography.displaySmall,
            fontWeight = FontWeight.Bold,
            color = MaterialTheme.colorScheme.primary
        )
    }
}


==== commonMain\kotlin\me\onvo\onvo\presentation\ui\PasswordResetScreen.kt ====
// File: commonMain/kotlin/me/onvo/onvo/presentation/ui/PasswordResetScreen.kt
package me.onvo.onvo.presentation.ui

import androidx.compose.animation.*
import androidx.compose.animation.core.*
import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.rememberScrollState
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.foundation.text.KeyboardActions
import androidx.compose.foundation.text.KeyboardOptions
import androidx.compose.foundation.verticalScroll
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.automirrored.filled.ArrowBack
import androidx.compose.material.icons.filled.*
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.draw.shadow
import androidx.compose.ui.graphics.Brush
import androidx.compose.ui.graphics.graphicsLayer
import androidx.compose.ui.graphics.vector.ImageVector
import androidx.compose.ui.layout.ContentScale
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.text.input.ImeAction
import androidx.compose.ui.text.input.KeyboardType
import androidx.compose.ui.text.input.PasswordVisualTransformation
import androidx.compose.ui.text.input.VisualTransformation
import androidx.compose.ui.text.style.TextAlign
import androidx.compose.ui.unit.dp
import coil3.compose.AsyncImage
import me.onvo.onvo.presentation.viewmodel.PasswordResetStep
import me.onvo.onvo.presentation.viewmodel.PasswordResetViewModel
import org.koin.compose.koinInject

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun PasswordResetScreen(
    viewModel: PasswordResetViewModel = koinInject(),
    onBackClick: () -> Unit,
    onPasswordChanged: (isFromSettings: Boolean) -> Unit,
    isFromSettings: Boolean = false,
    prefilledUserId: String? = null
) {
    val state by viewModel.state.collectAsState()
    val scrollState = rememberScrollState()

    // Initialize from settings if applicable
    LaunchedEffect(prefilledUserId) {
        if (isFromSettings && !prefilledUserId.isNullOrEmpty()) {
            viewModel.initializeFromSettings(prefilledUserId)
        }
    }

    // Handle success - pass isFromSettings flag to callback
    LaunchedEffect(state.currentStep) {
        if (state.currentStep is PasswordResetStep.Success) {
            val successStep = state.currentStep as PasswordResetStep.Success
            onPasswordChanged(successStep.isFromSettings)
        }
    }

    Scaffold(
        topBar = {
            TopAppBar(
                title = {
                    Text(
                        if (isFromSettings) "Change Password" else "Reset Password",
                        fontWeight = FontWeight.SemiBold
                    )
                },
                navigationIcon = {
                    IconButton(onClick = onBackClick) {
                        Icon(Icons.AutoMirrored.Filled.ArrowBack, "Back")
                    }
                },
                colors = TopAppBarDefaults.topAppBarColors(
                    containerColor = MaterialTheme.colorScheme.surface,
                    titleContentColor = MaterialTheme.colorScheme.onSurface
                )
            )
        }
    ) { paddingValues ->
        Box(
            modifier = Modifier
                .fillMaxSize()
                .padding(paddingValues)
                .background(
                    Brush.verticalGradient(
                        colors = listOf(
                            MaterialTheme.colorScheme.primary.copy(alpha = 0.05f),
                            MaterialTheme.colorScheme.surface
                        )
                    )
                )
        ) {
            Column(
                modifier = Modifier
                    .fillMaxSize()
                    .verticalScroll(scrollState)
                    .padding(24.dp),
                horizontalAlignment = Alignment.CenterHorizontally
            ) {
                Spacer(modifier = Modifier.height(20.dp))

                // Step indicator (only if not from settings)
                if (!isFromSettings) {
                    EnhancedStepIndicator(currentStep = state.currentStep)
                    Spacer(modifier = Modifier.height(32.dp))
                }

                // Main Card
                Card(
                    modifier = Modifier
                        .fillMaxWidth()
                        .shadow(8.dp, RoundedCornerShape(24.dp)),
                    shape = RoundedCornerShape(24.dp),
                    colors = CardDefaults.cardColors(
                        containerColor = MaterialTheme.colorScheme.surface
                    )
                ) {
                    Box(
                        modifier = Modifier
                            .fillMaxWidth()
                            .padding(24.dp)
                    ) {
                        // Show loading overlay
                        if (state.isLoading) {
                            Column(
                                horizontalAlignment = Alignment.CenterHorizontally,
                                verticalArrangement = Arrangement.Center,
                                modifier = Modifier.fillMaxWidth()
                            ) {
                                CircularProgressIndicator(
                                    modifier = Modifier.size(48.dp),
                                    strokeWidth = 4.dp
                                )
                                Spacer(modifier = Modifier.height(16.dp))
                                Text(
                                    "Processing...",
                                    style = MaterialTheme.typography.bodyLarge,
                                    color = MaterialTheme.colorScheme.onSurfaceVariant
                                )
                            }
                        } else {
                            // Show appropriate step content
                            AnimatedContent(
                                targetState = state.currentStep,
                                transitionSpec = {
                                    fadeIn() + slideInVertically() togetherWith
                                            fadeOut() + slideOutVertically()
                                }
                            ) { step ->
                                when (step) {
                                    is PasswordResetStep.EnterUserId -> {
                                        UserInputStep(
                                            viewModel = viewModel,
                                            error = state.error
                                        )
                                    }
                                    is PasswordResetStep.EnterCode -> {
                                        CodeStep(
                                            viewModel = viewModel,
                                            message = step.message,
                                            error = state.error
                                        )
                                    }
                                    is PasswordResetStep.EnterNewPassword -> {
                                        PasswordStep(
                                            viewModel = viewModel,
                                            error = state.error
                                        )
                                    }
                                    is PasswordResetStep.Success -> {
                                        SuccessStep(
                                            userName = step.userName,
                                            isFromSettings = step.isFromSettings
                                        )
                                    }
                                }
                            }
                        }
                    }
                }

                Spacer(modifier = Modifier.height(40.dp))
            }
        }
    }
}

@Composable
private fun EnhancedStepIndicator(currentStep: PasswordResetStep) {
    val stepNumber = when (currentStep) {
        is PasswordResetStep.EnterUserId -> 1
        is PasswordResetStep.EnterCode -> 2
        is PasswordResetStep.EnterNewPassword -> 3
        is PasswordResetStep.Success -> 3
    }

    Row(
        modifier = Modifier.fillMaxWidth(),
        horizontalArrangement = Arrangement.SpaceEvenly,
        verticalAlignment = Alignment.CenterVertically
    ) {
        EnhancedStepCircle(
            number = 1,
            label = "Verify",
            icon = Icons.Default.Person,
            isActive = stepNumber >= 1,
            isComplete = stepNumber > 1
        )
        AnimatedStepLine(isActive = stepNumber > 1)
        EnhancedStepCircle(
            number = 2,
            label = "Code",
            icon = Icons.Default.Email,
            isActive = stepNumber >= 2,
            isComplete = stepNumber > 2
        )
        AnimatedStepLine(isActive = stepNumber > 2)
        EnhancedStepCircle(
            number = 3,
            label = "Password",
            icon = Icons.Default.Lock,
            isActive = stepNumber >= 3,
            isComplete = false
        )
    }
}

@Composable
private fun EnhancedStepCircle(
    number: Int,
    label: String,
    icon: ImageVector,
    isActive: Boolean,
    isComplete: Boolean
) {
    Column(
        horizontalAlignment = Alignment.CenterHorizontally,
        verticalArrangement = Arrangement.spacedBy(8.dp)
    ) {
        Surface(
            modifier = Modifier.size(56.dp),
            shape = CircleShape,
            color = when {
                isComplete -> MaterialTheme.colorScheme.primary
                isActive -> MaterialTheme.colorScheme.primaryContainer
                else -> MaterialTheme.colorScheme.surfaceVariant
            },
            shadowElevation = if (isActive) 4.dp else 0.dp
        ) {
            Box(contentAlignment = Alignment.Center) {
                Icon(
                    imageVector = if (isComplete) Icons.Default.Check else icon,
                    contentDescription = null,
                    tint = when {
                        isComplete -> MaterialTheme.colorScheme.onPrimary
                        isActive -> MaterialTheme.colorScheme.onPrimaryContainer
                        else -> MaterialTheme.colorScheme.onSurfaceVariant
                    },
                    modifier = Modifier.size(24.dp)
                )
            }
        }
        Text(
            text = label,
            style = MaterialTheme.typography.labelSmall,
            color = if (isActive)
                MaterialTheme.colorScheme.primary
            else
                MaterialTheme.colorScheme.onSurfaceVariant
        )
    }
}

@Composable
private fun AnimatedStepLine(isActive: Boolean) {
    val animatedProgress by animateFloatAsState(
        targetValue = if (isActive) 1f else 0f,
        animationSpec = tween(500)
    )

    Box(
        modifier = Modifier
            .width(48.dp)
            .height(4.dp)
            .clip(RoundedCornerShape(2.dp))
            .background(MaterialTheme.colorScheme.surfaceVariant)
    ) {
        Box(
            modifier = Modifier
                .fillMaxHeight()
                .fillMaxWidth(animatedProgress)
                .background(MaterialTheme.colorScheme.primary)
        )
    }
}

@Composable
private fun SuccessStep(userName: String, isFromSettings: Boolean) {
    val infiniteTransition = rememberInfiniteTransition()
    val scale by infiniteTransition.animateFloat(
        initialValue = 0.9f,
        targetValue = 1.1f,
        animationSpec = infiniteRepeatable(
            animation = tween(1000, easing = FastOutSlowInEasing),
            repeatMode = RepeatMode.Reverse
        )
    )

    Column(
        modifier = Modifier.fillMaxWidth(),
        horizontalAlignment = Alignment.CenterHorizontally,
        verticalArrangement = Arrangement.spacedBy(16.dp)
    ) {
        Surface(
            modifier = Modifier.size(100.dp),
            shape = CircleShape,
            color = MaterialTheme.colorScheme.primaryContainer.copy(alpha = 0.2f)
        ) {
            Box(contentAlignment = Alignment.Center) {
                Icon(
                    imageVector = Icons.Default.CheckCircle,
                    contentDescription = null,
                    modifier = Modifier
                        .size(60.dp)
                        .graphicsLayer(scaleX = scale, scaleY = scale),
                    tint = MaterialTheme.colorScheme.primary
                )
            }
        }

        Text(
            text = "Success!",
            style = MaterialTheme.typography.headlineMedium,
            fontWeight = FontWeight.Bold,
            color = MaterialTheme.colorScheme.primary,
            textAlign = TextAlign.Center
        )

        Text(
            text = if (isFromSettings) {
                "Your password has been changed successfully"
            } else {
                "Welcome back, $userName!\nRedirecting to home..."
            },
            style = MaterialTheme.typography.bodyLarge,
            textAlign = TextAlign.Center,
            color = MaterialTheme.colorScheme.onSurfaceVariant
        )
    }
}

@Composable
private fun UserInputStep(
    viewModel: PasswordResetViewModel,
    error: String?
) {
    var userInput by remember { mutableStateOf("") }

    Column(
        modifier = Modifier.fillMaxWidth(),
        horizontalAlignment = Alignment.CenterHorizontally,
        verticalArrangement = Arrangement.spacedBy(16.dp)
    ) {
        StepHeader(
            icon = Icons.Default.Person,
            title = "Enter Your Information",
            subtitle = "We'll send a reset code to your registered email"
        )

        OutlinedTextField(
            value = userInput,
            onValueChange = {
                userInput = it
                viewModel.clearError()
            },
            label = { Text("Username, Email, or Phone") },
            leadingIcon = {
                Icon(
                    Icons.Default.Person,
                    null,
                    tint = MaterialTheme.colorScheme.primary
                )
            },
            modifier = Modifier.fillMaxWidth(),
            singleLine = true,
            shape = RoundedCornerShape(16.dp),
            keyboardOptions = KeyboardOptions(
                keyboardType = KeyboardType.Text,
                imeAction = ImeAction.Done
            ),
            keyboardActions = KeyboardActions(
                onDone = { if (userInput.isNotEmpty()) viewModel.requestCodeByInput(userInput) }
            ),
            isError = error != null
        )

        if (error != null) {
            ErrorMessage(error)
        }

        Button(
            onClick = { viewModel.requestCodeByInput(userInput) },
            modifier = Modifier
                .fillMaxWidth()
                .height(56.dp),
            enabled = userInput.isNotEmpty(),
            shape = RoundedCornerShape(16.dp)
        ) {
            Icon(Icons.Default.Send, null, modifier = Modifier.size(20.dp))
            Spacer(modifier = Modifier.width(8.dp))
            Text(
                "Send Reset Code",
                style = MaterialTheme.typography.titleMedium,
                fontWeight = FontWeight.SemiBold
            )
        }
    }
}

@Composable
private fun CodeStep(
    viewModel: PasswordResetViewModel,
    message: String?,
    error: String?
) {
    var code by remember { mutableStateOf("") }

    Column(
        modifier = Modifier.fillMaxWidth(),
        horizontalAlignment = Alignment.CenterHorizontally,
        verticalArrangement = Arrangement.spacedBy(16.dp)
    ) {
        StepHeader(
            icon = Icons.Default.Email,
            title = "Enter Reset Code",
            subtitle = message ?: "Enter the 6-digit code sent to your email"
        )

        OutlinedTextField(
            value = code,
            onValueChange = {
                if (it.length <= 6 && it.all { char -> char.isDigit() }) {
                    code = it
                    viewModel.clearError()
                }
            },
            label = { Text("6-Digit Code") },
            leadingIcon = {
                Icon(
                    Icons.Default.Lock,
                    null,
                    tint = MaterialTheme.colorScheme.primary
                )
            },
            modifier = Modifier.fillMaxWidth(),
            singleLine = true,
            shape = RoundedCornerShape(16.dp),
            keyboardOptions = KeyboardOptions(
                keyboardType = KeyboardType.Number,
                imeAction = ImeAction.Done
            ),
            keyboardActions = KeyboardActions(
                onDone = { if (code.length == 6) viewModel.submitCode(code) }
            ),
            isError = error != null
        )

        if (error != null) {
            ErrorMessage(error)
        }

        Button(
            onClick = { viewModel.submitCode(code) },
            modifier = Modifier
                .fillMaxWidth()
                .height(56.dp),
            enabled = code.length == 6,
            shape = RoundedCornerShape(16.dp)
        ) {
            Icon(Icons.Default.VerifiedUser, null, modifier = Modifier.size(20.dp))
            Spacer(modifier = Modifier.width(8.dp))
            Text(
                "Verify Code",
                style = MaterialTheme.typography.titleMedium,
                fontWeight = FontWeight.SemiBold
            )
        }

        TextButton(
            onClick = { viewModel.resendCode() }
        ) {
            Icon(Icons.Default.Refresh, null, modifier = Modifier.size(18.dp))
            Spacer(modifier = Modifier.width(8.dp))
            Text("Resend Code")
        }
    }
}

@Composable
private fun PasswordStep(
    viewModel: PasswordResetViewModel,
    error: String?
) {
    var newPassword by remember { mutableStateOf("") }
    var confirmPassword by remember { mutableStateOf("") }
    var showPassword by remember { mutableStateOf(false) }
    var showConfirmPassword by remember { mutableStateOf(false) }

    Column(
        modifier = Modifier.fillMaxWidth(),
        horizontalAlignment = Alignment.CenterHorizontally,
        verticalArrangement = Arrangement.spacedBy(16.dp)
    ) {
        StepHeader(
            icon = Icons.Default.Key,
            title = "Create New Password",
            subtitle = "Password must be at least 6 characters"
        )

        OutlinedTextField(
            value = newPassword,
            onValueChange = {
                newPassword = it
                viewModel.clearError()
            },
            label = { Text("New Password") },
            leadingIcon = {
                Icon(
                    Icons.Default.Lock,
                    null,
                    tint = MaterialTheme.colorScheme.primary
                )
            },
            trailingIcon = {
                IconButton(onClick = { showPassword = !showPassword }) {
                    Icon(
                        if (showPassword) Icons.Default.Visibility else Icons.Default.VisibilityOff,
                        contentDescription = if (showPassword) "Hide" else "Show"
                    )
                }
            },
            visualTransformation = if (showPassword)
                VisualTransformation.None
            else
                PasswordVisualTransformation(),
            modifier = Modifier.fillMaxWidth(),
            singleLine = true,
            shape = RoundedCornerShape(16.dp),
            keyboardOptions = KeyboardOptions(
                keyboardType = KeyboardType.Password,
                imeAction = ImeAction.Next
            )
        )

        OutlinedTextField(
            value = confirmPassword,
            onValueChange = {
                confirmPassword = it
                viewModel.clearError()
            },
            label = { Text("Confirm Password") },
            leadingIcon = {
                Icon(
                    Icons.Default.Lock,
                    null,
                    tint = MaterialTheme.colorScheme.primary
                )
            },
            trailingIcon = {
                IconButton(onClick = { showConfirmPassword = !showConfirmPassword }) {
                    Icon(
                        if (showConfirmPassword) Icons.Default.Visibility else Icons.Default.VisibilityOff,
                        contentDescription = if (showConfirmPassword) "Hide" else "Show"
                    )
                }
            },
            visualTransformation = if (showConfirmPassword)
                VisualTransformation.None
            else
                PasswordVisualTransformation(),
            modifier = Modifier.fillMaxWidth(),
            singleLine = true,
            shape = RoundedCornerShape(16.dp),
            keyboardOptions = KeyboardOptions(
                keyboardType = KeyboardType.Password,
                imeAction = ImeAction.Done
            ),
            keyboardActions = KeyboardActions(
                onDone = {
                    if (newPassword.isNotEmpty() && confirmPassword.isNotEmpty())
                        viewModel.changePassword(newPassword, confirmPassword)
                }
            ),
            isError = error != null
        )

        if (error != null) {
            ErrorMessage(error)
        }

        Button(
            onClick = { viewModel.changePassword(newPassword, confirmPassword) },
            modifier = Modifier
                .fillMaxWidth()
                .height(56.dp),
            enabled = newPassword.isNotEmpty() && confirmPassword.isNotEmpty(),
            shape = RoundedCornerShape(16.dp)
        ) {
            Icon(Icons.Default.Check, null, modifier = Modifier.size(20.dp))
            Spacer(modifier = Modifier.width(8.dp))
            Text(
                "Change Password",
                style = MaterialTheme.typography.titleMedium,
                fontWeight = FontWeight.SemiBold
            )
        }
    }
}

@Composable
private fun StepHeader(
    icon: ImageVector,
    title: String,
    subtitle: String
) {
    Column(
        horizontalAlignment = Alignment.CenterHorizontally,
        verticalArrangement = Arrangement.spacedBy(12.dp),
        modifier = Modifier.padding(bottom = 8.dp)
    ) {
        Surface(
            modifier = Modifier.size(72.dp),
            shape = CircleShape,
            color = MaterialTheme.colorScheme.primaryContainer.copy(alpha = 0.3f)
        ) {
            Box(contentAlignment = Alignment.Center) {
                Icon(
                    imageVector = icon,
                    contentDescription = null,
                    modifier = Modifier.size(36.dp),
                    tint = MaterialTheme.colorScheme.primary
                )
            }
        }

        Text(
            text = title,
            style = MaterialTheme.typography.headlineSmall,
            fontWeight = FontWeight.Bold,
            textAlign = TextAlign.Center,
            color = MaterialTheme.colorScheme.onSurface
        )

        Text(
            text = subtitle,
            style = MaterialTheme.typography.bodyMedium,
            color = MaterialTheme.colorScheme.onSurfaceVariant,
            textAlign = TextAlign.Center
        )
    }
}

@Composable
private fun ErrorMessage(message: String) {
    Surface(
        modifier = Modifier.fillMaxWidth(),
        shape = RoundedCornerShape(12.dp),
        color = MaterialTheme.colorScheme.errorContainer
    ) {
        Row(
            modifier = Modifier.padding(12.dp),
            horizontalArrangement = Arrangement.spacedBy(8.dp),
            verticalAlignment = Alignment.CenterVertically
        ) {
            Icon(
                Icons.Default.Error,
                contentDescription = null,
                tint = MaterialTheme.colorScheme.error,
                modifier = Modifier.size(20.dp)
            )
            Text(
                text = message,
                style = MaterialTheme.typography.bodySmall,
                color = MaterialTheme.colorScheme.onErrorContainer
            )
        }
    }
}


==== commonMain\kotlin\me\onvo\onvo\presentation\ui\ProfileScreen.kt ====
// File: commonMain/kotlin/me/onvo/onvo/presentation/ui/ProfileScreen.kt
package me.onvo.onvo.presentation.ui

import androidx.compose.animation.*
import androidx.compose.animation.core.*
import androidx.compose.foundation.background
import androidx.compose.foundation.border
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.rememberLazyListState
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.automirrored.filled.ArrowBack
import androidx.compose.material.icons.filled.*
import androidx.compose.material3.*
import androidx.compose.material3.TabRowDefaults.tabIndicatorOffset
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.graphics.Brush
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.graphics.vector.ImageVector
import androidx.compose.ui.layout.ContentScale
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.text.style.TextAlign
import androidx.compose.ui.text.style.TextOverflow
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import coil3.compose.AsyncImage
import me.onvo.onvo.domain.model.*
import me.onvo.onvo.presentation.viewmodel.ProfileViewModel
import org.koin.compose.koinInject
import kotlin.math.min

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun ProfileScreen(
    userId: Int? = null,
    onBackClick: (() -> Unit)? = null,
    viewModel: ProfileViewModel = koinInject()
) {
    val isOwnProfile = userId == null
    val scrollState = rememberLazyListState()

    // Load profile data
    LaunchedEffect(userId) {
        if (isOwnProfile) {
            viewModel.loadCurrentUserStatus()
        } else {
            viewModel.loadUserProfile(userId)
        }
    }

    val currentUserState by viewModel.currentUserState.collectAsState()
    val profileState by viewModel.profileState.collectAsState()
    val isRefreshing by viewModel.isRefreshing.collectAsState()

    // Load full profile when auth status is ready
    LaunchedEffect(currentUserState) {
        if (isOwnProfile && currentUserState is AuthStatusUiState.Success) {
            val userData = (currentUserState as AuthStatusUiState.Success).user
            viewModel.loadUserProfile(userData.id)
        }
    }

    // Calculate scroll progress for animations
    val scrollOffset = remember {
        derivedStateOf {
            val firstVisibleItem = scrollState.firstVisibleItemIndex
            val firstVisibleOffset = scrollState.firstVisibleItemScrollOffset

            if (firstVisibleItem == 0) {
                min(firstVisibleOffset / 300f, 1f)
            } else {
                1f
            }
        }
    }

    Box(modifier = Modifier.fillMaxSize()) {
        when (val state = profileState) {
            is ProfileUiState.Loading -> LoadingScreen()
            is ProfileUiState.Success -> {
                ProfileContent(
                    profile = state.profile,
                    isOwnProfile = isOwnProfile,
                    scrollState = scrollState,
                    scrollProgress = scrollOffset.value,
                    onRefresh = {
                        if (isOwnProfile) {
                            (currentUserState as? AuthStatusUiState.Success)?.user?.id?.let {
                                viewModel.refreshProfile(it)
                            }
                        } else {
                            userId?.let { viewModel.refreshProfile(it) }
                        }
                    }
                )
            }
            is ProfileUiState.Error -> {
                ErrorScreen(
                    message = state.message,
                    onRetry = {
                        if (isOwnProfile) {
                            viewModel.loadCurrentUserStatus()
                        } else {
                            userId?.let { viewModel.retry(it) }
                        }
                    }
                )
            }
        }

        // Animated Top App Bar
        if (profileState is ProfileUiState.Success) {
            AnimatedTopAppBar(
                profile = (profileState as ProfileUiState.Success).profile,
                scrollProgress = scrollOffset.value,
                isOwnProfile = isOwnProfile,
                onBackClick = onBackClick
            )
        }
    }
}

@OptIn(ExperimentalMaterial3Api::class)
@Composable
private fun AnimatedTopAppBar(
    profile: UserProfile,
    scrollProgress: Float,
    isOwnProfile: Boolean,
    onBackClick: (() -> Unit)?
) {
    TopAppBar(
        title = {
            AnimatedVisibility(
                visible = scrollProgress > 0.7f,
                enter = fadeIn() + expandHorizontally(),
                exit = fadeOut() + shrinkHorizontally()
            ) {
                Row(
                    verticalAlignment = Alignment.CenterVertically,
                    horizontalArrangement = Arrangement.Center,
                    modifier = Modifier.fillMaxWidth()
                ) {
                    AsyncImage(
                        model = profile.image,
                        contentDescription = null,
                        modifier = Modifier
                            .size(32.dp)
                            .clip(CircleShape)
                            .border(2.dp, MaterialTheme.colorScheme.primary, CircleShape),
                        contentScale = ContentScale.Crop
                    )
                    Spacer(modifier = Modifier.width(8.dp))
                    Text(
                        text = profile.fullname,
                        style = MaterialTheme.typography.titleMedium,
                        fontWeight = FontWeight.Bold,
                        maxLines = 1,
                        overflow = TextOverflow.Ellipsis
                    )
                }
            }
        },
        navigationIcon = {
            if (!isOwnProfile) {
                IconButton(onClick = { onBackClick?.invoke() }) {
                    Icon(
                        Icons.AutoMirrored.Filled.ArrowBack,
                        contentDescription = "Back",
                        tint = MaterialTheme.colorScheme.onSurface
                    )
                }
            }
        },
        actions = {
            IconButton(onClick = { /* More options */ }) {
                Icon(
                    Icons.Default.MoreVert,
                    contentDescription = "More",
                    tint = MaterialTheme.colorScheme.onSurface
                )
            }
        },
        colors = TopAppBarDefaults.topAppBarColors(
            containerColor = MaterialTheme.colorScheme.surface.copy(
                alpha = scrollProgress
            )
        )
    )
}

@Composable
private fun ProfileContent(
    profile: UserProfile,
    isOwnProfile: Boolean,
    scrollState: androidx.compose.foundation.lazy.LazyListState,
    scrollProgress: Float,
    onRefresh: () -> Unit
) {
    var selectedTab by remember { mutableStateOf(0) }
    val tabs = listOf("Threads", "Collections", "Posts")

    LazyColumn(
        state = scrollState,
        modifier = Modifier.fillMaxSize()
    ) {
        // Cover & Profile Header Section
        item {
            Box(modifier = Modifier.fillMaxWidth()) {
                // Cover Image with Gradient
                Box(
                    modifier = Modifier
                        .fillMaxWidth()
                        .height(180.dp)
                ) {
                    AsyncImage(
                        model = profile.image, // Use cover image if available
                        contentDescription = "Cover",
                        modifier = Modifier.fillMaxSize(),
                        contentScale = ContentScale.Crop
                    )
                    // Gradient overlay
                    Box(
                        modifier = Modifier
                            .fillMaxSize()
                            .background(
                                Brush.verticalGradient(
                                    colors = listOf(
                                        Color.Transparent,
                                        MaterialTheme.colorScheme.surface.copy(alpha = 0.3f)
                                    )
                                )
                            )
                    )
                }

                // Profile Image - Positioned to overlap cover
                Column(
                    modifier = Modifier
                        .fillMaxWidth()
                        .padding(top = 120.dp),
                    horizontalAlignment = Alignment.CenterHorizontally
                ) {
                    // Animated Profile Image
                    val imageSize by animateDpAsState(
                        targetValue = if (scrollProgress > 0.5f) 64.dp else 100.dp,
                        animationSpec = tween(durationMillis = 300)
                    )

                    val borderWidth by animateDpAsState(
                        targetValue = if (scrollProgress > 0.5f) 2.dp else 4.dp,
                        animationSpec = tween(durationMillis = 300)
                    )

                    Box(
                        modifier = Modifier
                            .size(imageSize)
                            .border(
                                borderWidth,
                                MaterialTheme.colorScheme.primary,
                                CircleShape
                            )
                            .padding(4.dp)
                    ) {
                        AsyncImage(
                            model = profile.image,
                            contentDescription = "Profile Picture",
                            modifier = Modifier
                                .fillMaxSize()
                                .clip(CircleShape)
                                .background(MaterialTheme.colorScheme.surfaceVariant),
                            contentScale = ContentScale.Crop
                        )
                    }

                    Spacer(modifier = Modifier.height(12.dp))

                    // Name with verification badge
                    Row(
                        verticalAlignment = Alignment.CenterVertically,
                        horizontalArrangement = Arrangement.Center
                    ) {
                        Text(
                            text = profile.fullname,
                            style = MaterialTheme.typography.titleLarge,
                            fontWeight = FontWeight.Bold,
                            fontSize = 22.sp
                        )
                        if (profile.isVerified) {
                            Spacer(modifier = Modifier.width(6.dp))
                            Icon(
                                Icons.Default.Verified,
                                contentDescription = "Verified",
                                tint = Color(0xFF6B7FED),
                                modifier = Modifier.size(22.dp)
                            )
                        }
                    }

                    // Username
                    Text(
                        text = "@${profile.username}",
                        style = MaterialTheme.typography.bodyMedium,
                        color = MaterialTheme.colorScheme.onSurfaceVariant,
                        fontSize = 15.sp
                    )

                    // Bio
                    if (profile.bio.isNotBlank()) {
                        Spacer(modifier = Modifier.height(12.dp))
                        Text(
                            text = profile.bio,
                            style = MaterialTheme.typography.bodyMedium,
                            color = MaterialTheme.colorScheme.onSurface,
                            textAlign = TextAlign.Center,
                            fontSize = 15.sp,
                            modifier = Modifier.padding(horizontal = 32.dp)
                        )
                    }

                    // Followers/Following
                    Spacer(modifier = Modifier.height(12.dp))
                    Row(
                        horizontalArrangement = Arrangement.Center,
                        verticalAlignment = Alignment.CenterVertically
                    ) {
                        Text(
                            text = "${profile.cnt.followers} Followers",
                            style = MaterialTheme.typography.bodyMedium,
                            color = MaterialTheme.colorScheme.onSurface,
                            fontWeight = FontWeight.Medium
                        )
                        Spacer(modifier = Modifier.width(24.dp))
                        Text(
                            text = "${profile.cnt.following} Following",
                            style = MaterialTheme.typography.bodyMedium,
                            color = MaterialTheme.colorScheme.onSurface,
                            fontWeight = FontWeight.Medium
                        )
                    }

                    Spacer(modifier = Modifier.height(16.dp))
                }
            }
        }

        // Social Links Row
        item {
            SocialLinksRow(links = profile.lnks)
        }

        // Action Buttons
        item {
            ActionButtonsRow(
                isOwnProfile = isOwnProfile,
                followed = profile.followed,
                onPostClick = { /* TODO */ },
                onShareClick = { /* TODO */ },
                onFollowClick = { /* TODO */ }
            )
        }

        // Tabs
        item {
            TabRow(
                selectedTabIndex = selectedTab,
                modifier = Modifier.fillMaxWidth(),
                containerColor = MaterialTheme.colorScheme.surface,
                contentColor = MaterialTheme.colorScheme.onSurface,
                indicator = { tabPositions ->
                    Box(
                        Modifier
                            .tabIndicatorOffset(tabPositions[selectedTab])
                            .height(3.dp)
                            .background(
                                MaterialTheme.colorScheme.primary,
                                RoundedCornerShape(topStart = 3.dp, topEnd = 3.dp)
                            )
                    )
                }
            ) {
                tabs.forEachIndexed { index, title ->
                    Tab(
                        selected = selectedTab == index,
                        onClick = { selectedTab = index },
                        text = {
                            Text(
                                text = title,
                                fontWeight = if (selectedTab == index) FontWeight.Bold else FontWeight.Normal,
                                fontSize = 15.sp
                            )
                        }
                    )
                }
            }
        }

        // Content Area (Posts will be added later)
        item {
            Box(
                modifier = Modifier
                    .fillMaxWidth()
                    .height(400.dp),
                contentAlignment = Alignment.Center
            ) {
                Text(
                    text = "Posts will appear here",
                    style = MaterialTheme.typography.bodyLarge,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )
            }
        }
    }
}

@Composable
private fun SocialLinksRow(links: List<UserLink>) {
    // Filter and sort links
    val validLinks = links
        .filter {
            it.d.isNotBlank() &&
                    !it.d.trim().equals("Test", ignoreCase = true) &&
                    it.d.trim() != "Test "
        }
        .sortedBy { it.linkType.ordinal } // Sort by enum order
        .take(10)

    if (validLinks.isNotEmpty()) {
        Column(
            modifier = Modifier
                .fillMaxWidth()
                .padding(vertical = 12.dp)
        ) {
            // Social Media Title
            Text(
                text = "Connect",
                style = MaterialTheme.typography.labelMedium,
                color = MaterialTheme.colorScheme.onSurfaceVariant,
                modifier = Modifier.padding(start = 16.dp, bottom = 8.dp),
                fontWeight = FontWeight.SemiBold
            )

            // Social Icons in scrollable row
            Row(
                modifier = Modifier
                    .fillMaxWidth()
                    .padding(horizontal = 16.dp),
                horizontalArrangement = Arrangement.spacedBy(12.dp),
                verticalAlignment = Alignment.CenterVertically
            ) {
                validLinks.forEach { link ->
                    SocialIconButton(link = link)
                }
            }
        }
    }
}

@Composable
private fun SocialIconButton(link: UserLink) {
    val (icon, color) = getSocialIconWithColor(link.linkType)

    Surface(
        onClick = { /* TODO: Open link */ },
        modifier = Modifier.size(44.dp),
        shape = CircleShape,
        color = color.copy(alpha = 0.1f)
    ) {
        Box(
            contentAlignment = Alignment.Center,
            modifier = Modifier.fillMaxSize()
        ) {
            Icon(
                imageVector = icon,
                contentDescription = link.linkType.displayName,
                tint = color,
                modifier = Modifier.size(22.dp)
            )
        }
    }
}

@Composable
private fun ActionButtonsRow(
    isOwnProfile: Boolean,
    followed: Boolean,
    onPostClick: () -> Unit,
    onShareClick: () -> Unit,
    onFollowClick: () -> Unit
) {
    Row(
        modifier = Modifier
            .fillMaxWidth()
            .padding(horizontal = 16.dp, vertical = 12.dp),
        horizontalArrangement = Arrangement.spacedBy(8.dp)
    ) {
        if (isOwnProfile) {
            // Post something button
            Button(
                onClick = onPostClick,
                modifier = Modifier.weight(1f),
                shape = RoundedCornerShape(12.dp),
                colors = ButtonDefaults.buttonColors(
                    containerColor = MaterialTheme.colorScheme.primary
                )
            ) {
                Icon(
                    Icons.Default.Edit,
                    contentDescription = null,
                    modifier = Modifier.size(18.dp)
                )
                Spacer(modifier = Modifier.width(8.dp))
                Text("Post something", fontSize = 15.sp, fontWeight = FontWeight.SemiBold)
            }

            // Share button
            OutlinedButton(
                onClick = onShareClick,
                modifier = Modifier.size(48.dp),
                shape = RoundedCornerShape(12.dp),
                contentPadding = PaddingValues(0.dp),
                colors = ButtonDefaults.outlinedButtonColors(
                    contentColor = MaterialTheme.colorScheme.onSurface
                )
            ) {
                Icon(
                    Icons.Default.Share,
                    contentDescription = "Share",
                    modifier = Modifier.size(20.dp)
                )
            }
        } else {
            // Follow button
            Button(
                onClick = onFollowClick,
                modifier = Modifier.weight(1f),
                shape = RoundedCornerShape(12.dp),
                colors = if (followed) {
                    ButtonDefaults.outlinedButtonColors(
                        contentColor = MaterialTheme.colorScheme.onSurface
                    )
                } else {
                    ButtonDefaults.buttonColors(
                        containerColor = MaterialTheme.colorScheme.primary
                    )
                }
            ) {
                Text(
                    if (followed) "Following" else "Follow",
                    fontWeight = FontWeight.SemiBold,
                    fontSize = 15.sp
                )
            }

            // Share button
            OutlinedButton(
                onClick = onShareClick,
                modifier = Modifier.size(48.dp),
                shape = RoundedCornerShape(12.dp),
                contentPadding = PaddingValues(0.dp)
            ) {
                Icon(
                    Icons.Default.Share,
                    contentDescription = "Share",
                    modifier = Modifier.size(20.dp)
                )
            }
        }
    }
}

@Composable
private fun LoadingScreen() {
    Box(
        modifier = Modifier.fillMaxSize(),
        contentAlignment = Alignment.Center
    ) {
        Column(
            horizontalAlignment = Alignment.CenterHorizontally,
            verticalArrangement = Arrangement.spacedBy(16.dp)
        ) {
            CircularProgressIndicator()
            Text(
                "Loading profile...",
                style = MaterialTheme.typography.bodyMedium,
                color = MaterialTheme.colorScheme.onSurfaceVariant
            )
        }
    }
}

@Composable
private fun ErrorScreen(message: String, onRetry: () -> Unit) {
    Box(
        modifier = Modifier.fillMaxSize(),
        contentAlignment = Alignment.Center
    ) {
        Column(
            horizontalAlignment = Alignment.CenterHorizontally,
            verticalArrangement = Arrangement.spacedBy(16.dp),
            modifier = Modifier.padding(24.dp)
        ) {
            Icon(
                Icons.Default.Error,
                contentDescription = null,
                modifier = Modifier.size(64.dp),
                tint = MaterialTheme.colorScheme.error
            )
            Text(
                text = "Oops!",
                style = MaterialTheme.typography.headlineMedium,
                fontWeight = FontWeight.Bold
            )
            Text(
                text = message,
                style = MaterialTheme.typography.bodyMedium,
                color = MaterialTheme.colorScheme.onSurfaceVariant,
                textAlign = TextAlign.Center
            )
            Button(
                onClick = onRetry,
                shape = RoundedCornerShape(12.dp)
            ) {
                Icon(Icons.Default.Refresh, null)
                Spacer(modifier = Modifier.width(8.dp))
                Text("Retry")
            }
        }
    }
}

private fun getSocialIconWithColor(linkType: LinkType): Pair<ImageVector, Color> {
    return when (linkType) {
        LinkType.LINKEDIN -> Icons.Default.Work to Color(0xFF0A66C2)
        LinkType.WHATSAPP -> Icons.Default.Phone to Color(0xFF25D366)
        LinkType.SPOTIFY -> Icons.Default.MusicNote to Color(0xFF1DB954)
        LinkType.SNAPCHAT -> Icons.Default.Camera to Color(0xFFFFFC00)
        LinkType.INSTAGRAM -> Icons.Default.CameraAlt to Color(0xFFE4405F)
        LinkType.REDDIT -> Icons.Default.Forum to Color(0xFFFF4500)
        LinkType.SOUND_CLOUD -> Icons.Default.Cloud to Color(0xFFFF5500)
        LinkType.PINTEREST -> Icons.Default.PushPin to Color(0xFFE60023)
        LinkType.GITHUB -> Icons.Default.Code to Color(0xFF181717)
        LinkType.TWITTER -> Icons.Default.Tag to Color(0xFF1DA1F2)
        LinkType.GMAIL -> Icons.Default.Email to Color(0xFFEA4335)
        LinkType.BEHANCE -> Icons.Default.Palette to Color(0xFF1769FF)
        LinkType.YOUTUBE -> Icons.Default.PlayArrow to Color(0xFFFF0000)
        LinkType.TIKTOK -> Icons.Default.MusicNote to Color(0xFF000000)
        LinkType.ANIME -> Icons.Default.Theaters to Color(0xFFFF6B9D)
        LinkType.FACEBOOK -> Icons.Default.ThumbUp to Color(0xFF1877F2)
        LinkType.OTHER -> Icons.Default.Link to Color(0xFF6B7280)
    }
}


==== commonMain\kotlin\me\onvo\onvo\presentation\ui\SourcesScreen.kt ====
// presentation/ui/SourcesScreen.kt
package me.onvo.onvo.presentation.ui

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.items
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.*
import androidx.compose.runtime.Composable
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import me.onvo.onvo.domain.model.Source
import me.onvo.onvo.domain.model.SourceState
import me.onvo.onvo.presentation.viewmodel.SourcesUiState
import me.onvo.onvo.presentation.viewmodel.SourcesViewModel

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun SourcesScreen(
    viewModel: SourcesViewModel,
    modifier: Modifier = Modifier
) {
    val uiState by viewModel.uiState.collectAsState()

    Scaffold(
        topBar = {
            TopAppBar(
                title = { Text("Sources") },
                colors = TopAppBarDefaults.topAppBarColors(
                    containerColor = MaterialTheme.colorScheme.primaryContainer,
                    titleContentColor = MaterialTheme.colorScheme.onPrimaryContainer
                )
            )
        }
    ) { paddingValues ->
        Box(
            modifier = modifier
                .fillMaxSize()
                .padding(paddingValues)
        ) {
            when (val state = uiState) {
                is SourcesUiState.Loading -> {
                    LoadingContent()
                }
                is SourcesUiState.Success -> {
                    if (state.sources.isEmpty()) {
                        EmptyContent()
                    } else {
                        SourcesList(sources = state.sources)
                    }
                }
                is SourcesUiState.Error -> {
                    ErrorContent(
                        message = state.message,
                        onRetry = { viewModel.retry() }
                    )
                }
            }
        }
    }
}

@Composable
private fun LoadingContent() {
    Box(
        modifier = Modifier.fillMaxSize(),
        contentAlignment = Alignment.Center
    ) {
        Column(
            horizontalAlignment = Alignment.CenterHorizontally,
            verticalArrangement = Arrangement.spacedBy(16.dp)
        ) {
            CircularProgressIndicator()
            Text(
                text = "Loading sources...",
                style = MaterialTheme.typography.bodyMedium
            )
        }
    }
}

@Composable
private fun EmptyContent() {
    Box(
        modifier = Modifier.fillMaxSize(),
        contentAlignment = Alignment.Center
    ) {
        Text(
            text = "No sources available",
            style = MaterialTheme.typography.bodyLarge,
            color = MaterialTheme.colorScheme.onSurfaceVariant
        )
    }
}

@Composable
private fun ErrorContent(
    message: String,
    onRetry: () -> Unit
) {
    Box(
        modifier = Modifier.fillMaxSize(),
        contentAlignment = Alignment.Center
    ) {
        Column(
            horizontalAlignment = Alignment.CenterHorizontally,
            verticalArrangement = Arrangement.spacedBy(16.dp),
            modifier = Modifier.padding(16.dp)
        ) {
            Text(
                text = "Error",
                style = MaterialTheme.typography.headlineSmall,
                color = MaterialTheme.colorScheme.error
            )
            Text(
                text = message,
                style = MaterialTheme.typography.bodyMedium,
                color = MaterialTheme.colorScheme.onSurfaceVariant
            )
            Button(onClick = onRetry) {
                Text("Retry")
            }
        }
    }
}

@Composable
private fun SourcesList(sources: List<Source>) {
    LazyColumn(
        modifier = Modifier.fillMaxSize(),
        contentPadding = PaddingValues(16.dp),
        verticalArrangement = Arrangement.spacedBy(12.dp)
    ) {
        items(sources) { source ->
            SourceItem(source = source)
        }
    }
}

@Composable
private fun SourceItem(source: Source) {
    Card(
        modifier = Modifier.fillMaxWidth(),
        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp),
        shape = RoundedCornerShape(12.dp)
    ) {
        Column(
            modifier = Modifier
                .fillMaxWidth()
                .padding(16.dp),
            verticalArrangement = Arrangement.spacedBy(8.dp)
        ) {
            // Header with name and state
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.SpaceBetween,
                verticalAlignment = Alignment.CenterVertically
            ) {
                Text(
                    text = source.name,
                    style = MaterialTheme.typography.titleLarge,
                    fontWeight = FontWeight.Bold,
                    modifier = Modifier.weight(1f)
                )
                SourceStateChip(state = source.state)
            }

            // API info
            InfoRow(label = "API", value = source.api)

            // Base URL
            InfoRow(label = "Base URL", value = source.baseUrl)

            // Version info
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.SpaceBetween
            ) {
                InfoRow(
                    label = "Version",
                    value = source.baseVersion.toString(),
                    modifier = Modifier.weight(1f)
                )
                InfoRow(
                    label = "Image Ver.",
                    value = source.imageUrlVersion.toString(),
                    modifier = Modifier.weight(1f)
                )
            }

            // Image Base URL
            if (source.imageBaseUrl.isNotEmpty()) {
                InfoRow(label = "Image URL", value = source.imageBaseUrl)
            }

            // Delete flag
            if (source.shouldDelete) {
                Text(
                    text = "Ã¢Å¡Â Ã¯Â¸ Marked for deletion",
                    style = MaterialTheme.typography.bodySmall,
                    color = MaterialTheme.colorScheme.error,
                    modifier = Modifier
                        .fillMaxWidth()
                        .background(
                            MaterialTheme.colorScheme.errorContainer,
                            RoundedCornerShape(4.dp)
                        )
                        .padding(8.dp)
                )
            }
        }
    }
}

@Composable
private fun InfoRow(
    label: String,
    value: String,
    modifier: Modifier = Modifier
) {
    Column(modifier = modifier) {
        Text(
            text = label,
            style = MaterialTheme.typography.labelSmall,
            color = MaterialTheme.colorScheme.onSurfaceVariant
        )
        Text(
            text = value,
            style = MaterialTheme.typography.bodyMedium
        )
    }
}

@Composable
private fun SourceStateChip(state: SourceState) {
    val (color, text) = when (state) {
        SourceState.WORKING -> MaterialTheme.colorScheme.primary to "Working"
        SourceState.UNDER_MAINTENANCE -> MaterialTheme.colorScheme.tertiary to "Maintenance"
        SourceState.STOPPED -> MaterialTheme.colorScheme.error to "Stopped"
    }

    Surface(
        color = color.copy(alpha = 0.2f),
        shape = RoundedCornerShape(16.dp)
    ) {
        Text(
            text = text,
            style = MaterialTheme.typography.labelMedium,
            color = color,
            modifier = Modifier.padding(horizontal = 12.dp, vertical = 6.dp)
        )
    }
}


==== commonMain\kotlin\me\onvo\onvo\presentation\viewmodel\AuthViewModel.kt ====
package me.onvo.onvo.presentation.viewmodel

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.launch
import me.onvo.onvo.core.util.State
import me.onvo.onvo.domain.model.AuthState
import me.onvo.onvo.domain.model.AuthUserData
import me.onvo.onvo.domain.usecase.auth.*
import me.onvo.onvo.domain.usecase.profile.GetCurrentUserStatusUseCase
import me.onvo.onvo.presentation.AuthUiState

class AuthViewModel(
    private val getTokenUseCase: GetTokenUseCase,
    private val checkInputUseCase: CheckInputUseCase,
    private val loginUseCase: LoginUseCase,
    private val logoutUseCase: LogoutUseCase,
    private val getUserSessionUseCase: GetUserSessionUseCase,
    private val getCurrentUserStatusUseCase: GetCurrentUserStatusUseCase
) : ViewModel() {

    private val _uiState = MutableStateFlow<AuthUiState>(AuthUiState.Loading)
    val uiState: StateFlow<AuthUiState> = _uiState.asStateFlow()

    private val _authState = MutableStateFlow(AuthState())
    val authState: StateFlow<AuthState> = _authState.asStateFlow()

    private val _isLoggedIn = MutableStateFlow(false)
    val isLoggedIn: StateFlow<Boolean> = _isLoggedIn.asStateFlow()

    private val _isInitialized = MutableStateFlow(false)
    val isInitialized: StateFlow<Boolean> = _isInitialized.asStateFlow()

    // Store current user data for navigation bar
    private val _currentUser = MutableStateFlow<AuthUserData?>(null)
    val currentUser: StateFlow<AuthUserData?> = _currentUser.asStateFlow()

    init {
        initializeAuth()
    }

    private fun initializeAuth() {
        viewModelScope.launch {
            _uiState.value = AuthUiState.Loading

            // First, check if we have an existing valid session
            val existingSession = getUserSessionUseCase()

            if (existingSession.isAuthenticated && existingSession.authToken != null) {
                // We have a token, verify it with the server
                when (val statusResult = getCurrentUserStatusUseCase()) {
                    is State.Success -> {
                        // Valid session confirmed by server
                        _currentUser.value = statusResult.data
                        _authState.value = AuthState(
                            isAuthenticated = true,
                            userId = statusResult.data.id.toString(),
                            userName = statusResult.data.username,
                            authToken = existingSession.authToken
                        )
                        _isLoggedIn.value = true
                        _uiState.value = AuthUiState.Initial
                        _isInitialized.value = true
                    }
                    is State.Error -> {
                        // Token is invalid or session expired
                        // The repository already cleared the session
                        _currentUser.value = null
                        _isLoggedIn.value = false

                        // Get a new token for login
                        getNewToken()
                    }
                    is State.Loading -> {
                        _uiState.value = AuthUiState.Loading
                    }
                }
            } else {
                // No valid session, get a new token
                getNewToken()
            }
        }
    }

    private suspend fun getNewToken() {
        when (val tokenResult = getTokenUseCase()) {
            is State.Success -> {
                _uiState.value = AuthUiState.Initial
                _isInitialized.value = true
            }
            is State.Error -> {
                _uiState.value = AuthUiState.Error(
                    "Failed to initialize. Please check your internet connection and restart the app."
                )
                _isInitialized.value = true
            }
            is State.Loading -> {
                _uiState.value = AuthUiState.Loading
            }
        }
    }

    fun checkInput(input: String) {
        if (input.isBlank()) {
            _uiState.value = AuthUiState.Error("Please enter your username, email, or phone number")
            return
        }

        viewModelScope.launch {
            _uiState.value = AuthUiState.Loading

            when (val result = checkInputUseCase(input.trim())) {
                is State.Success -> {
                    val data = result.data
                    if (data.isSuccess()) {
                        _uiState.value = AuthUiState.CheckInputSuccess(
                            id = data.id.toString(),
                            type = data.username ?: "user",
                            imageUrl = data.image,
                            fullName = data.fullname
                        )
                    } else {
                        _uiState.value = AuthUiState.Error(
                            data.message ?: "User not found"
                        )
                    }
                }
                is State.Error -> {
                    _uiState.value = AuthUiState.Error(
                        result.message ?: "Failed to verify input. Please try again."
                    )
                }
                is State.Loading -> {
                    _uiState.value = AuthUiState.Loading
                }
            }
        }
    }

    fun login(id: String, password: String) {
        if (password.isBlank()) {
            _uiState.value = AuthUiState.Error("Please enter your password")
            return
        }

        viewModelScope.launch {
            _uiState.value = AuthUiState.Loading

            when (val result = loginUseCase(id, password)) {
                is State.Success -> {
                    val response = result.data
                    if (response.isSuccess() && response.data != null) {
                        val userName = response.data.username

                        // Get fresh user status after login
                        refreshUserStatus()

                        _isLoggedIn.value = true
                        _uiState.value = AuthUiState.LoginSuccess(userName)

                        // Update auth state
                        val session = getUserSessionUseCase()
                        _authState.value = session
                    } else {
                        _uiState.value = AuthUiState.Error(
                            response.message ?: "Login failed. Please check your credentials."
                        )
                    }
                }
                is State.Error -> {
                    _uiState.value = AuthUiState.Error(
                        result.message ?: "Login failed. Please try again."
                    )
                }
                is State.Loading -> {
                    _uiState.value = AuthUiState.Loading
                }
            }
        }
    }

    fun logout() {
        viewModelScope.launch {
            when (logoutUseCase()) {
                is State.Success -> {
                    _isLoggedIn.value = false
                    _authState.value = AuthState()
                    _currentUser.value = null
                    _uiState.value = AuthUiState.Initial

                    // Get a new token for next login
                    getTokenUseCase()
                }
                is State.Error -> {
                    // Still clear local state even if API fails
                    _isLoggedIn.value = false
                    _authState.value = AuthState()
                    _currentUser.value = null
                    _uiState.value = AuthUiState.Initial

                    // Get a new token for next login
                    getTokenUseCase()
                }
                is State.Loading -> {}
            }
        }
    }

    /**
     * Refresh session state and user data
     */
    fun refreshSession() {
        viewModelScope.launch {
            refreshUserStatus()
            val session = getUserSessionUseCase()
            if (session.isAuthenticated) {
                _authState.value = session
                _isLoggedIn.value = true
                _uiState.value = AuthUiState.LoginSuccess(session.userName ?: "User")
            }
        }
    }

    /**
     * Refresh current user status from server
     */
    private suspend fun refreshUserStatus() {
        when (val result = getCurrentUserStatusUseCase()) {
            is State.Success -> {
                _currentUser.value = result.data
            }
            is State.Error -> {
                // If unauthorized, logout
                if (result.message?.contains("expired", ignoreCase = true) == true ||
                    result.message?.contains("unauthorized", ignoreCase = true) == true) {
                    logout()
                }
            }
            is State.Loading -> {}
        }
    }

    fun resetUiState() {
        _uiState.value = AuthUiState.Initial
    }

    fun retry() {
        initializeAuth()
    }
}


==== commonMain\kotlin\me\onvo\onvo\presentation\viewmodel\PasswordResetViewModel.kt ====
// File: commonMain/kotlin/me/onvo/onvo/presentation/viewmodel/PasswordResetViewModel.kt
package me.onvo.onvo.presentation.viewmodel

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.launch
import me.onvo.onvo.core.util.State
import me.onvo.onvo.domain.model.PasswordResetUiState
import me.onvo.onvo.domain.repository.AuthRepository
import me.onvo.onvo.domain.usecase.auth.CheckInputUseCase
import me.onvo.onvo.domain.usecase.passwordreset.*

// Enhanced UI State with explicit step tracking
sealed class PasswordResetStep {
    data object EnterUserId : PasswordResetStep()
    data class EnterCode(val userId: String, val message: String?) : PasswordResetStep()
    data class EnterNewPassword(val userId: String) : PasswordResetStep()
    data class Success(val userName: String, val isFromSettings: Boolean) : PasswordResetStep()
}

data class PasswordResetState(
    val currentStep: PasswordResetStep = PasswordResetStep.EnterUserId,
    val isLoading: Boolean = false,
    val error: String? = null,
    val errorType: PasswordResetUiState.ErrorType = PasswordResetUiState.ErrorType.GENERAL,
    val isFromSettings: Boolean = false
)

class PasswordResetViewModel(
    private val checkInputUseCase: CheckInputUseCase,
    private val requestResetCodeUseCase: RequestResetCodeUseCase,
    private val submitResetCodeUseCase: SubmitResetCodeUseCase,
    private val changePasswordUseCase: ChangePasswordUseCase,
    private val authRepository: AuthRepository
) : ViewModel() {

    private val _state = MutableStateFlow(PasswordResetState())
    val state: StateFlow<PasswordResetState> = _state.asStateFlow()

    private val _isLoggedIn = MutableStateFlow(false)
    val isLoggedIn: StateFlow<Boolean> = _isLoggedIn.asStateFlow()

    /**
     * Initialize from settings with known user ID
     * User is already logged in, just changing password
     */
    fun initializeFromSettings(userId: String) {
        viewModelScope.launch {
            _state.value = _state.value.copy(
                currentStep = PasswordResetStep.EnterCode(userId, null),
                isLoading = true,
                error = null,
                isFromSettings = true  // Mark as settings flow
            )

            when (val result = requestResetCodeUseCase(userId)) {
                is State.Success -> {
                    val response = result.data
                    if (response.error == "email_not_found") {
                        _state.value = _state.value.copy(
                            isLoading = false,
                            error = response.message ?: "This account does not have a recovery email.",
                            errorType = PasswordResetUiState.ErrorType.NO_EMAIL
                        )
                    } else if (response.isSuccess()) {
                        _state.value = _state.value.copy(
                            currentStep = PasswordResetStep.EnterCode(
                                userId = userId,
                                message = response.message
                            ),
                            isLoading = false,
                            error = null
                        )
                    } else {
                        _state.value = _state.value.copy(
                            isLoading = false,
                            error = response.message ?: "Failed to send reset code"
                        )
                    }
                }
                is State.Error -> {
                    _state.value = _state.value.copy(
                        isLoading = false,
                        error = result.message ?: "Failed to send reset code. Please try again."
                    )
                }
                is State.Loading -> {}
            }
        }
    }

    /**
     * Step 1: Check user input and request code
     * This is for forgot password flow (user not logged in)
     */
    fun requestCodeByInput(input: String) {
        if (input.isBlank()) {
            _state.value = _state.value.copy(
                error = "Please enter your username, email, or phone number",
                errorType = PasswordResetUiState.ErrorType.GENERAL
            )
            return
        }

        viewModelScope.launch {
            _state.value = _state.value.copy(
                isLoading = true,
                error = null,
                isFromSettings = false  // Mark as forgot password flow
            )

            // First, check the input to get user ID
            when (val checkResult = checkInputUseCase(input)) {
                is State.Success -> {
                    val userId = checkResult.data.id.toString()
                    // Now request the reset code
                    requestCode(userId)
                }
                is State.Error -> {
                    _state.value = _state.value.copy(
                        isLoading = false,
                        error = checkResult.message ?: "User not found. Please check your input.",
                        errorType = PasswordResetUiState.ErrorType.USER_NOT_FOUND
                    )
                }
                is State.Loading -> {}
            }
        }
    }

    /**
     * Request reset code with user ID
     */
    private suspend fun requestCode(userId: String) {
        when (val result = requestResetCodeUseCase(userId)) {
            is State.Success -> {
                val response = result.data
                when {
                    response.error == "email_not_found" -> {
                        _state.value = _state.value.copy(
                            isLoading = false,
                            error = response.message ?: "This account does not have a recovery email.",
                            errorType = PasswordResetUiState.ErrorType.NO_EMAIL
                        )
                    }
                    response.isSuccess() -> {
                        // Successfully sent code - move to next step
                        _state.value = _state.value.copy(
                            currentStep = PasswordResetStep.EnterCode(
                                userId = userId,
                                message = response.message
                            ),
                            isLoading = false,
                            error = null
                        )
                    }
                    else -> {
                        _state.value = _state.value.copy(
                            isLoading = false,
                            error = response.message ?: "Failed to send reset code"
                        )
                    }
                }
            }
            is State.Error -> {
                _state.value = _state.value.copy(
                    isLoading = false,
                    error = result.message ?: "Failed to send reset code. Please try again."
                )
            }
            is State.Loading -> {}
        }
    }

    /**
     * Step 2: Submit verification code
     */
    fun submitCode(code: String) {
        val currentStep = _state.value.currentStep
        if (currentStep !is PasswordResetStep.EnterCode) return

        if (code.length != 6) {
            _state.value = _state.value.copy(
                error = "Please enter a valid 6-digit code",
                errorType = PasswordResetUiState.ErrorType.INVALID_CODE
            )
            return
        }

        viewModelScope.launch {
            _state.value = _state.value.copy(isLoading = true, error = null)

            when (val result = submitResetCodeUseCase(code)) {
                is State.Success -> {
                    // Code verified - move to password entry
                    _state.value = _state.value.copy(
                        currentStep = PasswordResetStep.EnterNewPassword(currentStep.userId),
                        isLoading = false,
                        error = null
                    )
                }
                is State.Error -> {
                    // Stay on code step but show error
                    _state.value = _state.value.copy(
                        isLoading = false,
                        error = result.message ?: "Invalid code. Please try again.",
                        errorType = PasswordResetUiState.ErrorType.INVALID_CODE
                    )
                }
                is State.Loading -> {}
            }
        }
    }

    /**
     * Step 3: Change password
     * Behavior differs based on isFromSettings:
     * - Forgot Password: Auto-login after success
     * - Change Password: Stay logged in
     */
    fun changePassword(newPassword: String, confirmPassword: String) {
        when {
            newPassword.isBlank() -> {
                _state.value = _state.value.copy(
                    error = "Please enter a new password"
                )
                return
            }
            newPassword.length < 6 -> {
                _state.value = _state.value.copy(
                    error = "Password must be at least 6 characters"
                )
                return
            }
            newPassword != confirmPassword -> {
                _state.value = _state.value.copy(
                    error = "Passwords do not match"
                )
                return
            }
        }

        viewModelScope.launch {
            _state.value = _state.value.copy(isLoading = true, error = null)

            when (val result = changePasswordUseCase(newPassword)) {
                is State.Success -> {
                    val userName = result.data.data?.username ?: "User"
                    val isFromSettings = _state.value.isFromSettings

                    // If from forgot password flow, the user is now logged in
                    if (!isFromSettings) {
                        _isLoggedIn.value = true
                    }

                    _state.value = _state.value.copy(
                        currentStep = PasswordResetStep.Success(userName, isFromSettings),
                        isLoading = false,
                        error = null
                    )
                }
                is State.Error -> {
                    // Stay on password step but show error
                    _state.value = _state.value.copy(
                        isLoading = false,
                        error = result.message ?: "Failed to change password. Please try again."
                    )
                }
                is State.Loading -> {}
            }
        }
    }

    /**
     * Resend code (from code entry step)
     */
    fun resendCode() {
        val currentStep = _state.value.currentStep
        if (currentStep !is PasswordResetStep.EnterCode) return

        viewModelScope.launch {
            _state.value = _state.value.copy(isLoading = true, error = null)
            requestCode(currentStep.userId)
        }
    }

    /**
     * Go back to previous step
     */
    fun goBack() {
        val currentStep = _state.value.currentStep
        _state.value = when (currentStep) {
            is PasswordResetStep.EnterCode -> {
                _state.value.copy(
                    currentStep = PasswordResetStep.EnterUserId,
                    error = null
                )
            }
            is PasswordResetStep.EnterNewPassword -> {
                _state.value.copy(
                    currentStep = PasswordResetStep.EnterCode(currentStep.userId, null),
                    error = null
                )
            }
            else -> _state.value
        }
    }

    /**
     * Clear error
     */
    fun clearError() {
        _state.value = _state.value.copy(error = null)
    }

    /**
     * Reset to initial state
     */
    fun reset() {
        _state.value = PasswordResetState()
        _isLoggedIn.value = false
    }
}


==== commonMain\kotlin\me\onvo\onvo\presentation\viewmodel\ProfileViewModel.kt ====
package me.onvo.onvo.presentation.viewmodel


import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.launch
import me.onvo.onvo.core.util.State
import me.onvo.onvo.domain.model.ProfileUiState
import me.onvo.onvo.domain.model.AuthStatusUiState
import me.onvo.onvo.domain.usecase.profile.GetCurrentUserStatusUseCase
import me.onvo.onvo.domain.usecase.profile.GetUserProfileUseCase

class ProfileViewModel(
    private val getCurrentUserStatusUseCase: GetCurrentUserStatusUseCase,
    private val getUserProfileUseCase: GetUserProfileUseCase
) : ViewModel() {

    private val _currentUserState = MutableStateFlow<AuthStatusUiState>(AuthStatusUiState.Loading)
    val currentUserState: StateFlow<AuthStatusUiState> = _currentUserState.asStateFlow()

    private val _profileState = MutableStateFlow<ProfileUiState>(ProfileUiState.Loading)
    val profileState: StateFlow<ProfileUiState> = _profileState.asStateFlow()

    private val _isRefreshing = MutableStateFlow(false)
    val isRefreshing: StateFlow<Boolean> = _isRefreshing.asStateFlow()

    init {
        loadCurrentUserStatus()
    }

    fun loadCurrentUserStatus() {
        viewModelScope.launch {
            _currentUserState.value = AuthStatusUiState.Loading

            when (val result = getCurrentUserStatusUseCase()) {
                is State.Success -> {
                    _currentUserState.value = AuthStatusUiState.Success(result.data)
                }
                is State.Error -> {
                    _currentUserState.value = AuthStatusUiState.Error(
                        result.message ?: "Failed to load user status"
                    )
                }
                is State.Loading -> {
                    _currentUserState.value = AuthStatusUiState.Loading
                }
            }
        }
    }

    fun loadUserProfile(userId: Int) {
        viewModelScope.launch {
            _profileState.value = ProfileUiState.Loading

            when (val result = getUserProfileUseCase(userId)) {
                is State.Success -> {
                    _profileState.value = ProfileUiState.Success(result.data)
                }
                is State.Error -> {
                    _profileState.value = ProfileUiState.Error(
                        result.message ?: "Failed to load profile"
                    )
                }
                is State.Loading -> {
                    _profileState.value = ProfileUiState.Loading
                }
            }
        }
    }

    fun refreshProfile(userId: Int) {
        viewModelScope.launch {
            _isRefreshing.value = true

            when (val result = getUserProfileUseCase(userId)) {
                is State.Success -> {
                    _profileState.value = ProfileUiState.Success(result.data)
                }
                is State.Error -> {
                    _profileState.value = ProfileUiState.Error(
                        result.message ?: "Failed to refresh profile"
                    )
                }
                is State.Loading -> {}
            }

            _isRefreshing.value = false
        }
    }

    fun retry(userId: Int? = null) {
        if (userId != null) {
            loadUserProfile(userId)
        } else {
            loadCurrentUserStatus()
        }
    }
}


==== commonMain\kotlin\me\onvo\onvo\presentation\viewmodel\SourcesViewModel.kt ====
// presentation/viewmodel/SourcesViewModel.kt
package me.onvo.onvo.presentation.viewmodel

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
//import dev.zacsweers.metro.AppScope
//import dev.zacsweers.metro.Inject
//import dev.zacsweers.metro.SingleIn
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.launch
import me.onvo.onvo.domain.model.Source
import me.onvo.onvo.domain.usecase.GetSourcesUseCase

sealed class SourcesUiState {
    data object Loading : SourcesUiState()
    data class Success(val sources: List<Source>) : SourcesUiState()
    data class Error(val message: String) : SourcesUiState()
}

//@Inject
//@SingleIn(AppScope::class)
class SourcesViewModel(
    private val getSourcesUseCase: GetSourcesUseCase
) : ViewModel() {

    private val _uiState = MutableStateFlow<SourcesUiState>(SourcesUiState.Loading)
    val uiState: StateFlow<SourcesUiState> = _uiState.asStateFlow()

    init {
        loadSources()
    }

    fun loadSources() {
        viewModelScope.launch {
            _uiState.value = SourcesUiState.Loading
            getSourcesUseCase()
                .onSuccess { sources ->
                    _uiState.value = SourcesUiState.Success(sources)
                }
                .onFailure { error ->
                    _uiState.value = SourcesUiState.Error(
                        error.message ?: "Unknown error occurred"
                    )
                }
        }
    }

    fun retry() {
        loadSources()
    }
}


==== commonMain\kotlin\me\onvo\onvo\test\screens.kt ====
// File: commonMain/kotlin/me/onvo/onvo/test/screens.kt
package me.onvo.onvo.test

import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.items
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.automirrored.filled.ArrowBack
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.unit.dp
import me.onvo.onvo.presentation.ui.ProfileScreen

// Home Screen
@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun HomeScreen(
    onUserClick: (String) -> Unit
) {
    Scaffold(
        topBar = {
            TopAppBar(title = { Text("Home") })
        }
    ) { padding ->
        LazyColumn(
            modifier = Modifier
                .fillMaxSize()
                .padding(padding)
        ) {
            items(10) { index ->
                PostCard(
                    userId = "user_$index",
                    userName = "User $index",
                    content = "This is post content from user $index",
                    onUserClick = onUserClick
                )
            }
        }
    }
}

// Search Screen
@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun SearchScreen(
    onUserClick: (String) -> Unit
) {
    var searchQuery by remember { mutableStateOf("") }

    Scaffold(
        topBar = {
            TopAppBar(title = { Text("Search") })
        }
    ) { padding ->
        Column(
            modifier = Modifier
                .fillMaxSize()
                .padding(padding)
        ) {
            OutlinedTextField(
                value = searchQuery,
                onValueChange = { searchQuery = it },
                label = { Text("Search users...") },
                modifier = Modifier
                    .fillMaxWidth()
                    .padding(16.dp)
            )
            LazyColumn {
                items(5) { index ->
                    UserListItem(
                        userId = "search_user_$index",
                        userName = "Search User $index",
                        onClick = onUserClick
                    )
                }
            }
        }
    }
}

// Discovery Screen
@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun DiscoveryScreen(
    onUserClick: (String) -> Unit
) {
    Scaffold(
        topBar = {
            TopAppBar(title = { Text("Discovery") })
        }
    ) { padding ->
        LazyColumn(
            modifier = Modifier
                .fillMaxSize()
                .padding(padding)
        ) {
            items(8) { index ->
                PostCard(
                    userId = "discovery_user_$index",
                    userName = "Discovery User $index",
                    content = "Trending post content $index",
                    onUserClick = onUserClick
                )
            }
        }
    }
}

// User Profile Screen (Other Users) - Now uses real ProfileScreen
@Composable
fun UserProfileScreen(
    userId: String,
    onBackClick: () -> Unit
) {
    // Convert string userId to Int
    val userIdInt = userId.removePrefix("user_").toIntOrNull() ?: 1452

    ProfileScreen(
        userId = userIdInt,
        onBackClick = onBackClick
    )
}

// Settings Detail Screen
@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun SettingsDetailScreen(
    settingType: String,
    onBackClick: () -> Unit
) {
    Scaffold(
        topBar = {
            TopAppBar(
                title = { Text(settingType) },
                navigationIcon = {
                    IconButton(onClick = onBackClick) {
                        Icon(Icons.AutoMirrored.Filled.ArrowBack, "Back")
                    }
                }
            )
        }
    ) { padding ->
        Column(
            modifier = Modifier
                .fillMaxSize()
                .padding(padding)
                .padding(16.dp)
        ) {
            Text("Settings for: $settingType")
            Spacer(modifier = Modifier.height(16.dp))
            Text("Configure your $settingType settings here")
        }
    }
}

// Create Post Screen
@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun CreatePostScreen(
    onPostCreated: () -> Unit,
    onBackClick: () -> Unit
) {
    var postContent by remember { mutableStateOf("") }

    Scaffold(
        topBar = {
            TopAppBar(
                title = { Text("Create Post") },
                navigationIcon = {
                    IconButton(onClick = onBackClick) {
                        Icon(Icons.AutoMirrored.Filled.ArrowBack, "Back")
                    }
                }
            )
        }
    ) { padding ->
        Column(
            modifier = Modifier
                .fillMaxSize()
                .padding(padding)
                .padding(16.dp)
        ) {
            OutlinedTextField(
                value = postContent,
                onValueChange = { postContent = it },
                label = { Text("What's on your mind?") },
                modifier = Modifier
                    .fillMaxWidth()
                    .height(200.dp)
            )
            Spacer(modifier = Modifier.height(16.dp))
            Button(
                onClick = onPostCreated,
                modifier = Modifier.fillMaxWidth()
            ) {
                Text("Post")
            }
        }
    }
}

// Helper Composables
@Composable
private fun PostCard(
    userId: String,
    userName: String,
    content: String,
    onUserClick: (String) -> Unit
) {
    Card(
        modifier = Modifier
            .fillMaxWidth()
            .padding(8.dp)
    ) {
        Column(modifier = Modifier.padding(16.dp)) {
            Text(
                text = userName,
                style = MaterialTheme.typography.titleMedium,
                modifier = Modifier.clickable { onUserClick(userId) }
            )
            Spacer(modifier = Modifier.height(8.dp))
            Text(text = content)
        }
    }
}

@Composable
private fun UserListItem(
    userId: String,
    userName: String,
    onClick: (String) -> Unit
) {
    ListItem(
        headlineContent = { Text(userName) },
        modifier = Modifier.clickable { onClick(userId) }
    )
}

@Composable
private fun SettingItem(
    title: String,
    onClick: () -> Unit
) {
    ListItem(
        headlineContent = { Text(title) },
        modifier = Modifier.clickable(onClick = onClick)
    )
}


==== commonMain\kotlin\me\onvo\onvo\test\SettingsScreen.kt ====
// File: commonMain/kotlin/me/onvo/onvo/test/SettingsScreen.kt
package me.onvo.onvo.test

import androidx.compose.foundation.Image
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.items
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.*
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.unit.dp
import co.touchlab.kermit.Logger
import me.onvo.onvo.theme.ThemeManager
import me.onvo.onvo.theme.ThemeMode
import me.onvo.onvo.theme.ThemeViewModel
import onvo.composeapp.generated.resources.Res
import onvo.composeapp.generated.resources.compose_multiplatform
import org.jetbrains.compose.resources.painterResource

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun SettingsScreen(
    themeViewModel: ThemeViewModel,
    onSettingClick: (String) -> Unit,
    onLogout: () -> Unit,
    onChangePassword: () -> Unit
) {
    val currentTheme by themeViewModel.themeMode.collectAsState()
    var showThemeDialog by remember { mutableStateOf(false) }

    Logger.a("SettingsScreen") { "hi loggg 111111" }

    Scaffold(
        topBar = {
            TopAppBar(title = { Text("Settings") })
        }
    ) { padding ->
        LazyColumn(
            modifier = Modifier
                .fillMaxSize()
                .padding(padding)
        ) {
            item {
                Image(painterResource(Res.drawable.compose_multiplatform), null)
            }

            // Theme Setting
            item {
                ThemeSettingItem(
                    currentTheme = currentTheme,
                    onClick = { showThemeDialog = true }
                )
            }

            item {
                HorizontalDivider(modifier = Modifier.padding(vertical = 8.dp))
            }

            // Security Section
            item {
                SectionHeader(title = "Security")
            }

            item {
                SettingItemWithIcon(
                    title = "Change Password",
                    icon = Icons.Default.Lock,
                    onClick = onChangePassword
                )
            }

            item {
                HorizontalDivider(modifier = Modifier.padding(vertical = 8.dp))
            }

            // General Settings Section
            item {
                SectionHeader(title = "General")
            }

            items(listOf("Account", "Privacy", "Notifications", "Appearance", "Help")) { setting ->
                SettingItem(
                    title = setting,
                    onClick = { onSettingClick(setting) }
                )
            }

            item {
                HorizontalDivider(modifier = Modifier.padding(vertical = 8.dp))
            }

            item {
                SettingItemWithIcon(
                    title = "Logout",
                    icon = Icons.Default.ExitToApp,
                    textColor = MaterialTheme.colorScheme.error,
                    onClick = onLogout
                )
            }
        }
    }

    if (showThemeDialog) {
        ThemeSelectionDialog(
            currentTheme = currentTheme,
            onThemeSelected = { theme ->
                themeViewModel.setThemeMode(theme)
                showThemeDialog = false
            },
            onDismiss = { showThemeDialog = false }
        )
    }
}

@Composable
private fun SectionHeader(title: String) {
    Text(
        text = title,
        style = MaterialTheme.typography.titleMedium,
        color = MaterialTheme.colorScheme.primary,
        modifier = Modifier.padding(horizontal = 16.dp, vertical = 8.dp)
    )
}

@Composable
private fun ThemeSettingItem(
    currentTheme: ThemeMode,
    onClick: () -> Unit
) {
    ListItem(
        headlineContent = { Text("Theme") },
        supportingContent = {
            Text(
                when (currentTheme) {
                    ThemeMode.LIGHT -> "Light"
                    ThemeMode.DARK -> "Dark"
                    ThemeMode.SYSTEM -> "System Default"
                }
            )
        },
        leadingContent = {
            Icon(
                imageVector = when (currentTheme) {
                    ThemeMode.LIGHT -> Icons.Default.LightMode
                    ThemeMode.DARK -> Icons.Default.DarkMode
                    ThemeMode.SYSTEM -> Icons.Default.Brightness4
                },
                contentDescription = "Theme"
            )
        },
        modifier = Modifier.clickable(onClick = onClick)
    )
}

@Composable
private fun SettingItemWithIcon(
    title: String,
    icon: androidx.compose.ui.graphics.vector.ImageVector,
    textColor: androidx.compose.ui.graphics.Color = MaterialTheme.colorScheme.onSurface,
    onClick: () -> Unit
) {
    ListItem(
        headlineContent = {
            Text(
                text = title,
                color = textColor
            )
        },
        leadingContent = {
            Icon(
                imageVector = icon,
                contentDescription = title,
                tint = textColor
            )
        },
        modifier = Modifier.clickable(onClick = onClick)
    )
}

@Composable
private fun ThemeSelectionDialog(
    currentTheme: ThemeMode,
    onThemeSelected: (ThemeMode) -> Unit,
    onDismiss: () -> Unit
) {
    AlertDialog(
        onDismissRequest = onDismiss,
        title = { Text("Select Theme") },
        text = {
            Column {
                ThemeMode.entries.forEach { mode ->
                    Row(
                        modifier = Modifier
                            .fillMaxWidth()
                            .clickable { onThemeSelected(mode) }
                            .padding(vertical = 12.dp),
                        verticalAlignment = Alignment.CenterVertically
                    ) {
                        RadioButton(
                            selected = currentTheme == mode,
                            onClick = { onThemeSelected(mode) }
                        )
                        Spacer(modifier = Modifier.width(8.dp))
                        Text(
                            text = when (mode) {
                                ThemeMode.LIGHT -> "Light"
                                ThemeMode.DARK -> "Dark"
                                ThemeMode.SYSTEM -> "System Default"
                            }
                        )
                    }
                }
            }
        },
        confirmButton = {
            TextButton(onClick = onDismiss) {
                Text("Close")
            }
        }
    )
}

@Composable
private fun SettingItem(
    title: String,
    onClick: () -> Unit
) {
    ListItem(
        headlineContent = { Text(title) },
        modifier = Modifier.clickable(onClick = onClick)
    )
}


==== commonMain\kotlin\me\onvo\onvo\theme\splash_screen\shouldShowSplash.kt ====
package me.onvo.onvo.theme.splash_screen

expect val shouldShowSplash : Boolean


==== commonMain\kotlin\me\onvo\onvo\theme\splash_screen\SplashScreen.kt ====
package me.onvo.onvo.theme.splash_screen

import androidx.compose.animation.core.*
import androidx.compose.foundation.Image
import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.Text
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.alpha
import androidx.compose.ui.draw.scale
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import kotlinx.coroutines.delay
import org.jetbrains.compose.resources.painterResource
import onvo.composeapp.generated.resources.Res
import onvo.composeapp.generated.resources.compose_multiplatform

@Composable
fun SplashScreen(
    onSplashFinished: () -> Unit
) {
    var startAnimation by remember { mutableStateOf(false) }

    // Scale animation
    val scale by animateFloatAsState(
        targetValue = if (startAnimation) 1f else 0.5f,
        animationSpec = tween(
            durationMillis = 800,
            easing = FastOutSlowInEasing
        )
    )

    // Alpha animation
    val alpha by animateFloatAsState(
        targetValue = if (startAnimation) 1f else 0f,
        animationSpec = tween(
            durationMillis = 800,
            easing = FastOutSlowInEasing
        )
    )

    LaunchedEffect(Unit) {
        startAnimation = true
        delay(2500) // Show splash for 2.5 seconds
        onSplashFinished()
    }

    Box(
        modifier = Modifier
            .fillMaxSize()
            .background(MaterialTheme.colorScheme.primary),
        contentAlignment = Alignment.Center
    ) {
        Column(
            horizontalAlignment = Alignment.CenterHorizontally,
            verticalArrangement = Arrangement.Center,
            modifier = Modifier
                .scale(scale)
                .alpha(alpha)
        ) {
            // App Logo
            Image(
                painter = painterResource(Res.drawable.compose_multiplatform),
                contentDescription = "App Logo",
                modifier = Modifier
                    .size(120.dp)
            )

            Spacer(modifier = Modifier.height(24.dp))

            // App Name
            Text(
                text = "ONVO",
                fontSize = 42.sp,
                fontWeight = FontWeight.Bold,
                color = MaterialTheme.colorScheme.onPrimary
            )

            Spacer(modifier = Modifier.height(8.dp))

            // Tagline
            Text(
                text = "Your Multiplatform Experience",
                fontSize = 16.sp,
                color = MaterialTheme.colorScheme.onPrimary.copy(alpha = 0.8f)
            )
        }
    }
}


==== commonMain\kotlin\me\onvo\onvo\theme\ThemeManager.kt ====
package me.onvo.onvo.theme

import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow

enum class ThemeMode {
    LIGHT,
    DARK,
    SYSTEM
}

class ThemeManager {
    private val _themeMode = MutableStateFlow(ThemeMode.SYSTEM)
    val themeMode: StateFlow<ThemeMode> = _themeMode.asStateFlow()

    fun setThemeMode(mode: ThemeMode) {
        _themeMode.value = mode
    }

    fun toggleTheme() {
        _themeMode.value = when (_themeMode.value) {
            ThemeMode.LIGHT -> ThemeMode.DARK
            ThemeMode.DARK -> ThemeMode.LIGHT
            ThemeMode.SYSTEM -> ThemeMode.LIGHT
        }
    }
}


==== commonMain\kotlin\me\onvo\onvo\theme\Themes.kt ====
package me.onvo.onvo.theme


import androidx.compose.foundation.isSystemInDarkTheme
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.darkColorScheme
import androidx.compose.material3.lightColorScheme
import androidx.compose.runtime.Composable
import androidx.compose.ui.graphics.Color

// Light Theme Colors
private val LightPrimary = Color(0xFF6200EE)
private val LightOnPrimary = Color(0xFFFFFFFF)
private val LightPrimaryContainer = Color(0xFFBB86FC)
private val LightOnPrimaryContainer = Color(0xFF3700B3)
private val LightSecondary = Color(0xFF03DAC6)
private val LightOnSecondary = Color(0xFF000000)
private val LightSecondaryContainer = Color(0xFF018786)
private val LightOnSecondaryContainer = Color(0xFFFFFFFF)
private val LightTertiary = Color(0xFF03DAC6)
private val LightOnTertiary = Color(0xFF000000)
private val LightError = Color(0xFFB00020)
private val LightOnError = Color(0xFFFFFFFF)
private val LightBackground = Color(0xFFFFFBFE)
private val LightOnBackground = Color(0xFF1C1B1F)
private val LightSurface = Color(0xFFFFFBFE)
private val LightOnSurface = Color(0xFF1C1B1F)
private val LightSurfaceVariant = Color(0xFFE7E0EC)
private val LightOnSurfaceVariant = Color(0xFF49454F)

// Dark Theme Colors
private val DarkPrimary = Color(0xFFBB86FC)
private val DarkOnPrimary = Color(0xFF3700B3)
private val DarkPrimaryContainer = Color(0xFF6200EE)
private val DarkOnPrimaryContainer = Color(0xFFFFFFFF)
private val DarkSecondary = Color(0xFF03DAC6)
private val DarkOnSecondary = Color(0xFF000000)
private val DarkSecondaryContainer = Color(0xFF018786)
private val DarkOnSecondaryContainer = Color(0xFFFFFFFF)
private val DarkTertiary = Color(0xFF03DAC6)
private val DarkOnTertiary = Color(0xFF000000)
private val DarkError = Color(0xFFCF6679)
private val DarkOnError = Color(0xFF000000)
private val DarkBackground = Color(0xFF1C1B1F)
private val DarkOnBackground = Color(0xFFE6E1E5)
private val DarkSurface = Color(0xFF1C1B1F)
private val DarkOnSurface = Color(0xFFE6E1E5)
private val DarkSurfaceVariant = Color(0xFF49454F)
private val DarkOnSurfaceVariant = Color(0xFFCAC4D0)

private val LightColorScheme = lightColorScheme(
    primary = LightPrimary,
    onPrimary = LightOnPrimary,
    primaryContainer = LightPrimaryContainer,
    onPrimaryContainer = LightOnPrimaryContainer,
    secondary = LightSecondary,
    onSecondary = LightOnSecondary,
    secondaryContainer = LightSecondaryContainer,
    onSecondaryContainer = LightOnSecondaryContainer,
    tertiary = LightTertiary,
    onTertiary = LightOnTertiary,
    error = LightError,
    onError = LightOnError,
    background = LightBackground,
    onBackground = LightOnBackground,
    surface = LightSurface,
    onSurface = LightOnSurface,
    surfaceVariant = LightSurfaceVariant,
    onSurfaceVariant = LightOnSurfaceVariant
)

private val DarkColorScheme = darkColorScheme(
    primary = DarkPrimary,
    onPrimary = DarkOnPrimary,
    primaryContainer = DarkPrimaryContainer,
    onPrimaryContainer = DarkOnPrimaryContainer,
    secondary = DarkSecondary,
    onSecondary = DarkOnSecondary,
    secondaryContainer = DarkSecondaryContainer,
    onSecondaryContainer = DarkOnSecondaryContainer,
    tertiary = DarkTertiary,
    onTertiary = DarkOnTertiary,
    error = DarkError,
    onError = DarkOnError,
    background = DarkBackground,
    onBackground = DarkOnBackground,
    surface = DarkSurface,
    onSurface = DarkOnSurface,
    surfaceVariant = DarkSurfaceVariant,
    onSurfaceVariant = DarkOnSurfaceVariant
)

@Composable
fun AppTheme(
    darkTheme: Boolean = isSystemInDarkTheme(),
    content: @Composable () -> Unit
) {
    val colorScheme = if (darkTheme) DarkColorScheme else LightColorScheme

    MaterialTheme(
        colorScheme = colorScheme,
        content = content
    )
}


==== commonMain\kotlin\me\onvo\onvo\theme\ThemeViewModel.kt ====
package me.onvo.onvo.theme


import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.launch
import me.onvo.onvo.core.datastore.PreferencesManager

class ThemeViewModel(
    private val preferencesManager: PreferencesManager
) : ViewModel() {

    private val _themeMode = MutableStateFlow(ThemeMode.SYSTEM)
    val themeMode: StateFlow<ThemeMode> = _themeMode.asStateFlow()

    private val _isDarkMode = MutableStateFlow(false)
    val isDarkMode: StateFlow<Boolean> = _isDarkMode.asStateFlow()

    init {
        loadThemePreferences()
    }

    private fun loadThemePreferences() {
        viewModelScope.launch {
            preferencesManager.getThemeMode().collect { mode ->
                _themeMode.value = mode
            }
        }

        viewModelScope.launch {
            preferencesManager.isDarkMode().collect { isDark ->
                _isDarkMode.value = isDark
            }
        }
    }

    fun toggleTheme() {
        viewModelScope.launch {
            val newDarkMode = !_isDarkMode.value
            preferencesManager.setDarkMode(newDarkMode)
        }
    }

    fun setThemeMode(mode: ThemeMode) {
        viewModelScope.launch {
            preferencesManager.setThemeMode(mode)
        }
    }
}


==== iosMain\kotlin\me\onvo\onvo\core\device\DeviceInfoProvider.ios.kt ====
package me.onvo.onvo.core.device

import me.onvo.onvo.domain.model.DeviceInfo


import platform.UIKit.*
import platform.Foundation.*

actual class DeviceInfoProvider {

    actual fun getDeviceInfo(): DeviceInfo {
        val device = UIDevice.currentDevice

        return DeviceInfo(
            deviceId = device.identifierForVendor?.UUIDString ?: "",
            brand = "Apple",
            model = device.model?: "Unknown",
            systemName = device.systemName ?: "iOS",
            systemVersion = device.systemVersion?: "Unknown",
            appVersion = getAppVersion(),
            buildNumber = getBuildNumber(),
            uniqueId = device.identifierForVendor?.UUIDString ?: "",
            deviceName = device.name ?: "Unknown",
            isTablet = device.userInterfaceIdiom == UIUserInterfaceIdiomPad,
            carrier = getCarrier(),
            timezone = NSTimeZone.localTimeZone.name
        )
    }

    private fun getAppVersion(): String {
        return NSBundle.mainBundle.infoDictionary
            ?.get("CFBundleShortVersionString") as? String ?: "1.0.0"
    }

    private fun getBuildNumber(): String {
        return NSBundle.mainBundle.infoDictionary
            ?.get("CFBundleVersion") as? String ?: "1"
    }

    private fun getCarrier(): String? {
        // iOS carrier info requires CoreTelephony framework
        return null
    }
}


==== iosMain\kotlin\me\onvo\onvo\core\util\CryptoUtil.ios.kt ====
package me.onvo.onvo.core.util

import kotlinx.cinterop.*
import platform.CoreCrypto.CC_MD5
import platform.CoreCrypto.CC_MD5_DIGEST_LENGTH
import platform.Foundation.*

@OptIn(ExperimentalForeignApi::class)
actual object CryptoUtil {

    actual fun md5(input: String): String {
        // Convert input String Ã¢â€ â€™ NSData
        val nsData = input.toNSData() ?: return ""

        // Allocate buffer for MD5 result
        val digest = UByteArray(CC_MD5_DIGEST_LENGTH)

        // Compute MD5
        nsData.bytes?.let { bytes ->
            digest.usePinned { pinned ->
                CC_MD5(bytes, nsData.length.toUInt(), pinned.addressOf(0))
            }
        } ?: return ""

        // Convert digest bytes to lowercase hex string
        return buildString(CC_MD5_DIGEST_LENGTH) {
            digest.forEach { append(it.toString(16).padStart(2, '0')) }
        }
    }
}

// Ã¢Å“â€¦ Helper extension for UTF-8 conversion
private fun String.toNSData(): NSData? =
    (this as NSString).dataUsingEncoding(NSUTF8StringEncoding)



==== iosMain\kotlin\me\onvo\onvo\di\platformModule.ios.kt ====
package me.onvo.onvo.di

import me.onvo.onvo.core.device.DeviceInfoProvider
import org.koin.dsl.module


actual val platformModule = module {
    single { DeviceInfoProvider() }
}


==== iosMain\kotlin\me\onvo\onvo\MainViewController.kt ====
package me.onvo.onvo

import androidx.compose.ui.window.ComposeUIViewController

fun MainViewController() = ComposeUIViewController { App() }


==== iosMain\kotlin\me\onvo\onvo\Platform.ios.kt ====
package me.onvo.onvo

import platform.UIKit.UIDevice

class IOSPlatform: Platform {
    override val name: String = UIDevice.currentDevice.systemName() + " " + UIDevice.currentDevice.systemVersion
}

actual fun getPlatform(): Platform = IOSPlatform()


==== iosMain\kotlin\me\onvo\onvo\theme\splash_screen\shouldShowSplash.ios.kt ====
package me.onvo.onvo.theme.splash_screen

actual val shouldShowSplash: Boolean
    get() = false


==== jvmMain\kotlin\me\onvo\onvo\core\datastore\DataStoreFactory.jvm.kt ====
package me.onvo.onvo.core.datastore

// File: composeApp/src/jvmMain/kotlin/me/onvo/onvo/core/datastore/DataStoreFactory.jvm.kt

import androidx.datastore.core.DataStore
import androidx.datastore.preferences.core.Preferences
import java.io.File
import okio.Path
import okio.Path.Companion.toPath


    actual fun createPreferencesDataStore(): DataStore<Preferences> {
        return androidx.datastore.preferences.core.PreferenceDataStoreFactory.createWithPath(
            produceFile = {
                val userHome = System.getProperty("user.home")
                val appDir = File(userHome, ".onvo")
                if (!appDir.exists()) {
                    appDir.mkdirs()
                }
                // Return an okio.Path
                (appDir.absolutePath.toPath() / dataStoreFileName)
            }
        )
    }





==== jvmMain\kotlin\me\onvo\onvo\core\device\DeviceInfoProvider.jvm.kt ====
package me.onvo.onvo.core.device

import me.onvo.onvo.domain.model.DeviceInfo

import java.net.InetAddress
import java.util.*

actual class DeviceInfoProvider {
    actual fun getDeviceInfo(): DeviceInfo {
        val osName = System.getProperty("os.name") ?: "Unknown"
        val osVersion = System.getProperty("os.version") ?: "Unknown"
        val hostName = try {
            InetAddress.getLocalHost().hostName
        } catch (e: Exception) {
            "Desktop"
        }

        return DeviceInfo(
            deviceId = hostName,
            brand = "Desktop",
            model = osName,
            systemName = osName,
            systemVersion = osVersion,
            appVersion = "1.0.0",
            buildNumber = "1",
            uniqueId = hostName,
            deviceName = hostName,
            isTablet = false,
            carrier = null,
            timezone = TimeZone.getDefault().id
        )
    }
}


==== jvmMain\kotlin\me\onvo\onvo\core\network\HttpClientFactory.jvm.kt ====
package me.onvo.onvo.core.network

import io.ktor.client.HttpClient
import io.ktor.client.engine.cio.CIO

actual class HttpClientFactory {
    actual fun create(): HttpClient = HttpClient(CIO) {
        // same plugins
    }
}


==== jvmMain\kotlin\me\onvo\onvo\core\util\CryptoUtil.jvm.kt ====
package me.onvo.onvo.core.util


import java.security.MessageDigest

actual object CryptoUtil {
    actual fun md5(input: String): String {
        val md = MessageDigest.getInstance("MD5")
        val digest = md.digest(input.toByteArray())
        return digest.joinToString("") { "%02x".format(it) }
    }
}


==== jvmMain\kotlin\me\onvo\onvo\di\platformModule.jvm.kt ====
package me.onvo.onvo.di

import me.onvo.onvo.core.device.DeviceInfoProvider
import org.koin.dsl.module


actual val platformModule = module {
    single { DeviceInfoProvider() }
}



==== jvmMain\kotlin\me\onvo\onvo\main.kt ====
package me.onvo.onvo

import androidx.compose.ui.window.Window
import androidx.compose.ui.window.application
import me.onvo.onvo.di.initKoin

fun main()  {
    initKoin() // start Koin for desktop
     application {
    Window(
        onCloseRequest = ::exitApplication,
        title = "ONVO",
    ) {
        App()
    }
}}


==== jvmMain\kotlin\me\onvo\onvo\Platform.jvm.kt ====
package me.onvo.onvo

class JVMPlatform: Platform {
    override val name: String = "Java ${System.getProperty("java.version")}"
}

actual fun getPlatform(): Platform = JVMPlatform()


==== jvmMain\kotlin\me\onvo\onvo\theme\splash_screen\shouldShowSplash.jvm.kt ====
package me.onvo.onvo.theme.splash_screen

actual val shouldShowSplash: Boolean
    get() = true


==== nativeMain\kotlin\me\onvo\onvo\core\datastore\DataStoreFactory.native.kt ====
package me.onvo.onvo.core.datastore


import androidx.datastore.core.DataStore
import androidx.datastore.preferences.core.Preferences
import kotlinx.cinterop.ExperimentalForeignApi
import platform.Foundation.NSDocumentDirectory
import platform.Foundation.NSFileManager
import platform.Foundation.NSUserDomainMask

@OptIn(ExperimentalForeignApi::class)
fun getPreferencesDataStorePath(): String {
    val documentDirectory = NSFileManager.defaultManager.URLForDirectory(
        directory = NSDocumentDirectory,
        inDomain = NSUserDomainMask,
        appropriateForURL = null,
        create = false,
        error = null
    )
    return requireNotNull(documentDirectory).path + "/$dataStoreFileName"
}

actual fun createPreferencesDataStore(): DataStore<Preferences> {
    val path = getPreferencesDataStorePath()
    return getPreferencesDataStore(path)
}


==== nativeMain\kotlin\me\onvo\onvo\core\network\HttpClientFactory.native.kt ====
package me.onvo.onvo.core.network



import io.ktor.client.HttpClient
import io.ktor.client.engine.darwin.Darwin
import io.ktor.client.plugins.contentnegotiation.ContentNegotiation
import io.ktor.client.plugins.HttpTimeout
import io.ktor.serialization.kotlinx.json.*
import kotlinx.serialization.json.Json
import io.ktor.client.plugins.logging.*


actual class HttpClientFactory {
    actual fun create(): HttpClient = HttpClient(Darwin) {
        install(ContentNegotiation) {
            json(Json { ignoreUnknownKeys = true })
        }
        install(Logging) { logger = Logger.SIMPLE; level = LogLevel.INFO }
        install(HttpTimeout) { requestTimeoutMillis = 15000 }
        engine {
            configureRequest { // optional: configure darwin-specific things
            }
        }
    }


}



==== repo_viewer.py ====
from pathlib import Path
from jinja2 import Template
from pygments import highlight
from pygments.lexers import guess_lexer_for_filename
from pygments.formatters import HtmlFormatter

# Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
# CONFIG
# Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
SKIP_EXTS = {
    ".png", ".jpg", ".jpeg", ".gif", ".bmp", ".svg",
    ".mp4", ".mov", ".avi", ".mkv", ".webm",
    ".mp3", ".wav", ".ogg", ".flac",
    ".ico", ".pdf", ".zip", ".rar", ".7z", ".tar", ".gz",
    ".exe", ".dll", ".so", ".bin", ".dat"
}

repo = Path(".")
files = [f for f in repo.rglob("*") if f.is_file() and f.suffix.lower() not in SKIP_EXTS]
formatter = HtmlFormatter(style="monokai", full=False)

# Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
# BUILD FOLDER TREE
# Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
def generate_tree(start_path: Path, prefix=""):
    entries = sorted(list(start_path.iterdir()), key=lambda x: (x.is_file(), x.name.lower()))
    lines = []
    for i, entry in enumerate(entries):
        connector = "Ã¢â€â€Ã¢â€â‚¬Ã¢â€â‚¬ " if i == len(entries) - 1 else "Ã¢â€Å“Ã¢â€â‚¬Ã¢â€â‚¬ "
        if entry.is_dir():
            lines.append(f"{prefix}{connector}{entry.name}")
            new_prefix = prefix + ("    " if i == len(entries) - 1 else "Ã¢â€â€š   ")
            lines.extend(generate_tree(entry, new_prefix))
        elif entry.suffix.lower() not in SKIP_EXTS:
            lines.append(f"{prefix}{connector}{entry.name}")
    return lines

tree_text = "\n".join(generate_tree(repo))

# Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
# BUILD CODE CONTENTS
# Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
text_dump = [f"Ã°Å¸â€œ Repository Structure\n{tree_text}\n\nÃ°Å¸â€œâ€ Code Contents\n"]
code_blocks_html = []
for f in sorted(files):
    rel_path = f.relative_to(repo)
    file_id = str(rel_path).replace("/", "_").replace("\\", "_")
    try:
        code = f.read_text(errors="ignore")
    except Exception:
        continue

    # Add to plain text dump
    text_dump.append(f"==== {rel_path} ====\n{code}\n\n")

    # Highlight for HTML
    try:
        lexer = guess_lexer_for_filename(f.name, code)
    except Exception:
        from pygments.lexers import TextLexer
        lexer = TextLexer()
    highlighted = highlight(code, lexer, formatter)
    code_blocks_html.append(f"<h2 id='{file_id}'>{rel_path}</h2>{highlighted}")

# Write plain text file
dump_path = Path("repo_dump.txt")
dump_path.write_text("\n".join(text_dump), encoding="utf-8")

# Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
# TEMPLATE
# Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
template = Template("""
<html>
<head>
<meta charset="utf-8">
<title>Repo Viewer</title>
<style>
body {
  background: #272822; color: #f8f8f2;
  font-family: monospace; padding: 20px;
}
pre.tree {
  background: #1e1f1c; padding: 15px;
  border-radius: 6px; color: #a6e22e;
  overflow-x: auto; line-height: 1.4;
}
h1 { color: #a6e22e; }
h2 {
  margin-top: 40px;
  border-bottom: 1px solid #444;
  color: #66d9ef;
  font-size: 1.1rem;
}
button {
  background: #66d9ef; color: #272822;
  border: none; padding: 10px 15px;
  margin-right: 10px; border-radius: 4px;
  cursor: pointer; font-weight: bold;
}
button:hover { background: #5cb6cf; }
#buttons { margin-bottom: 20px; }
{{ formatter.get_style_defs('.highlight') }}
</style>
</head>
<body>
<h1>Ã°Å¸â€œ Repository Structure</h1>

<div id="buttons">
  <button onclick="copyAll()">Ã°Å¸â€œâ€¹ Copy All Text</button>
  <button onclick="downloadText()">Ã°Å¸â€™Â¾ Download as .txt</button>
</div>

<pre id="tree" class="tree">{{ tree_text }}</pre>

<h1>Ã°Å¸â€œâ€ Code Contents</h1>
<div id="code">{{ code_blocks|safe }}</div>

<script>
function copyAll() {
  const text = document.getElementById("tree").innerText + "\\n\\n" + document.getElementById("code").innerText;
  navigator.clipboard.writeText(text)
    .then(() => alert("Ã¢Å“â€¦ All text copied to clipboard!"))
    .catch(err => alert("Ã¢Å’ Failed to copy: " + err));
}

function downloadText() {
  const text = document.getElementById("tree").innerText + "\\n\\n" + document.getElementById("code").innerText;
  const blob = new Blob([text], {type: "text/plain"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "repo_dump.txt";
  a.click();
  URL.revokeObjectURL(url);
}
</script>
</body>
</html>
""")

# Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
# RENDER OUTPUT
# Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
html_output = template.render(
    tree_text=tree_text,
    code_blocks="".join(code_blocks_html),
    formatter=formatter
)
Path("repo_view.html").write_text(html_output, encoding="utf-8")

print("Ã¢Å“â€¦ Generated repo_view.html and repo_dump.txt (with copy/download buttons)")


